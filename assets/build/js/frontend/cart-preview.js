(()=>{var e={651:(e,t,r)=>{var i=r(8151);i&&i.__esModule&&(i=i.default),e.exports="string"==typeof i?i:i.toString()},1601:e=>{"use strict";e.exports=function(e){return e[1]}},1669:e=>{"use strict";e.exports=jQuery},6314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r="",i=void 0!==t[5];return t[4]&&(r+="@supports (".concat(t[4],") {")),t[2]&&(r+="@media ".concat(t[2]," {")),i&&(r+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),r+=e(t),i&&(r+="}"),t[2]&&(r+="}"),t[4]&&(r+="}"),r})).join("")},t.i=function(e,r,i,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var n={};if(i)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(n[d]=!0)}for(var c=0;c<e.length;c++){var l=[].concat(e[c]);i&&n[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),r&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=r):l[2]=r),a&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=a):l[4]="".concat(a)),t.push(l))}},t}},8151:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var i=r(1601),a=r.n(i),o=r(6314),n=r.n(o)()(a());n.push([e.id,'@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes slideDown{from{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}@keyframes slideOut{from{transform:translateX(0)}to{transform:translateX(100%)}}@keyframes slideInRTL{from{transform:translateX(-100%)}to{transform:translateX(0)}}@keyframes slideOutRTL{from{transform:translateX(0)}to{transform:translateX(-100%)}}@keyframes bounce{0%,20%,50%,80%,100%{transform:translateX(-50%) translateY(0)}40%{transform:translateX(-50%) translateY(-8px)}60%{transform:translateX(-50%) translateY(-4px)}}:host{--edd-cart-preview-font-family: inherit;--edd-cart-preview-font-size-base: 16px;--edd-cart-preview-font-size-small: 14px;--edd-cart-preview-font-size-medium: 15px;--edd-cart-preview-font-size-large: 18px;--edd-cart-preview-font-size-xlarge: 20px;--edd-cart-preview-line-height: 1.5;--edd-cart-preview-color-text: #333;--edd-cart-preview-color-text-muted: #666;--edd-cart-preview-color-danger: #cc1818;--edd-cart-preview-color-danger-light: #cc181819;--edd-cart-preview-color-danger-lighter: #cc18184d;--edd-cart-preview-color-border: #e0e0e0;--edd-cart-preview-color-background: #ffffff;--edd-cart-preview-color-background-dimmed: #ffffff80;--edd-cart-preview-color-backdrop: #00000080;--edd-cart-preview-color-message: #0073aa;--edd-cart-preview-color-message-light: #0073aa19;--edd-cart-preview-color-link: var(--edd-cart-preview-color-text);--edd-cart-preview-color-link-hover: var(--edd-cart-preview-color-primary-hover);--edd-cart-preview-border-radius: 4px;--edd-cart-preview-dialog-width: 400px;--edd-cart-preview-spacing-sm: 12px;--edd-cart-preview-spacing-md: 16px;--edd-cart-preview-spacing-lg: 24px;--edd-cart-preview-spacing-xl: 48px;--edd-cart-preview-shadow-dialog: -2px 0 8px #0000001a;--edd-cart-preview-shadow-button: 0 4px 12px #00000026;direction:inherit}.cart-preview__dialog,.cart-preview__button--trigger{font-family:var(--edd-cart-preview-font-family);font-size:var(--edd-cart-preview-font-size-base);line-height:var(--edd-cart-preview-line-height);font-weight:400;font-style:normal;text-align:left;text-transform:none;letter-spacing:normal;word-spacing:normal;color:var(--edd-cart-preview-color-text);text-decoration:none;text-shadow:none}.cart-preview__dialog a,.cart-preview__button--trigger a{color:var(--edd-cart-preview-color-link);text-decoration:none}.cart-preview__dialog a:hover,.cart-preview__button--trigger a:hover{color:var(--edd-cart-preview-color-link-hover)}*{box-sizing:border-box}.cart-preview__dialog{border:none;padding:0;margin:0;max-width:none;max-height:none}.cart-preview__dialog[open]{position:fixed;bottom:0;left:0;right:0;top:90px;margin:0;width:100%;height:auto;max-height:calc(100vh - 90px);background:var(--edd-cart-preview-color-background);box-shadow:0 -2px 8px rgba(0,0,0,.1019607843);border-radius:var(--edd-cart-preview-spacing-sm) var(--edd-cart-preview-spacing-sm) 0 0;display:flex;flex-direction:column;transform:translateY(100%);animation:slideUp .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog[open]{top:0;right:0;bottom:0;left:auto;max-width:var(--edd-cart-preview-dialog-width);height:100%;max-height:none;box-shadow:var(--edd-cart-preview-shadow-dialog);border-radius:var(--edd-cart-preview-spacing-sm) 0 0 var(--edd-cart-preview-spacing-sm);transform:translateX(100%);animation:slideIn .4s ease forwards}}.cart-preview__dialog.closing{animation:slideDown .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog.closing{animation:slideOut .4s ease forwards}}.cart-preview__dialog::backdrop{background:var(--edd-cart-preview-color-backdrop);transition:opacity .4s ease}@media(min-width: 782px){:host([dir=rtl]) .cart-preview__dialog[open]{left:0;right:auto;border-radius:0 var(--edd-cart-preview-spacing-md) var(--edd-cart-preview-spacing-md) 0;box-shadow:2px 0 8px rgba(0,0,0,.1019607843);transform:translateX(-100%);animation:slideInRTL .4s ease forwards}:host([dir=rtl]) .cart-preview__dialog.closing{animation:slideOutRTL .4s ease forwards}}.cart-preview__header{display:flex;align-items:center;justify-content:space-between;padding:var(--edd-cart-preview-spacing-md);border-bottom:1px solid var(--edd-cart-preview-color-border);flex-shrink:0}@media(min-width: 782px){.cart-preview__header{padding:var(--edd-cart-preview-spacing-lg)}}.cart-preview__title{margin:0;font-size:var(--edd-cart-preview-font-size-large);font-weight:600}@media(min-width: 782px){.cart-preview__title{font-size:var(--edd-cart-preview-font-size-xlarge)}}.cart-preview__close{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:24px;line-height:1;padding:.5rem;color:var(--edd-cart-preview-color-text-muted);transition:color .2s ease}.cart-preview__close svg{width:24px;height:24px;display:block}.cart-preview__close .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__close:hover,.cart-preview__close:focus{color:var(--edd-cart-preview-color-text)}.cart-preview__close:focus{outline:2px solid var(--edd-cart-preview-color-primary);outline-offset:2px}.cart-preview__content{flex:1;overflow-y:auto;overflow-x:hidden;padding:var(--edd-cart-preview-spacing-md);-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;position:relative}@media(min-width: 782px){.cart-preview__content{padding:var(--edd-cart-preview-spacing-lg)}}.cart-preview__scroll-indicator{position:fixed;bottom:calc(60px + var(--edd-cart-preview-spacing-md));left:50%;transform:translateX(-50%);display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:var(--edd-cart-preview-color-background);border:1px solid var(--edd-cart-preview-color-border);border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,.0784313725);pointer-events:none;z-index:10;animation:bounce 2s infinite}@media(min-width: 782px){.cart-preview__scroll-indicator{bottom:calc(60px + var(--edd-cart-preview-spacing-lg))}}.cart-preview__scroll-indicator-icon{display:flex;align-items:center;justify-content:center;color:var(--edd-cart-preview-color-text-muted)}.cart-preview__scroll-indicator-icon svg{width:20px;height:20px;display:block}.cart-preview__loading{display:flex;align-items:center;justify-content:center;padding:var(--edd-cart-preview-spacing-lg);color:var(--edd-cart-preview-color-text-muted);position:fixed;top:0;left:0;right:0;bottom:0;z-index:999999;background:var(--edd-cart-preview-color-background-dimmed)}@media(min-width: 782px){.cart-preview__loading{padding:var(--edd-cart-preview-spacing-xl) var(--edd-cart-preview-spacing-lg)}}.cart-preview__error{padding:var(--edd-cart-preview-spacing-md);margin-bottom:var(--edd-cart-preview-spacing-md);background:var(--edd-cart-preview-color-danger-light);border:1px solid var(--edd-cart-preview-color-danger-lighter);color:var(--edd-cart-preview-color-danger);display:flex;align-items:center;justify-content:space-between;gap:var(--edd-cart-preview-spacing-md)}.cart-preview__error--dismiss{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:20px;line-height:1;padding:0 .5rem}.cart-preview__empty{text-align:center;padding:var(--edd-cart-preview-spacing-lg);color:var(--edd-cart-preview-color-text-muted)}@media(min-width: 782px){.cart-preview__empty{padding:var(--edd-cart-preview-spacing-xl) var(--edd-cart-preview-spacing-lg)}}.cart-preview__items{display:flex;flex-direction:column;gap:var(--edd-cart-preview-spacing-lg);flex-grow:1}.cart-preview__items-list{display:flex;flex-direction:column;gap:var(--edd-cart-preview-spacing-md)}.cart-preview__item{display:flex;gap:var(--edd-cart-preview-spacing-md);padding:var(--edd-cart-preview-spacing-md);border:1px solid var(--edd-cart-preview-color-border);border-radius:var(--edd-cart-preview-border-radius);flex-wrap:wrap}.cart-preview__item__messages{flex-basis:100%;display:flex;flex-direction:column;margin-top:8px;overflow-x:hidden;word-wrap:break-word;font-size:var(--edd-cart-preview-font-size-small);color:var(--edd-cart-preview-color-text-muted);line-height:1.5}.cart-preview__item__message{font-style:italic;padding:6px 10px;background-color:var(--edd-cart-preview-color-message-light);border-left:3px solid var(--edd-cart-preview-color-message)}.cart-preview__item__message--error{border-left-color:var(--edd-cart-preview-color-danger);background-color:var(--edd-cart-preview-color-danger-light)}.cart-preview__item-fees{font-size:var(--edd-cart-preview-font-size-small);color:var(--edd-cart-preview-color-text-muted);margin-left:var(--edd-cart-preview-spacing-md)}.cart-preview__item-image{width:60px;height:60px;object-fit:cover;border-radius:var(--edd-cart-preview-border-radius);flex-shrink:0}.cart-preview__item-details{flex:1;min-width:0}.cart-preview__item-name{font-weight:600;margin:0 0 .5rem 0;font-size:var(--edd-cart-preview-font-size-medium);overflow-wrap:break-word;word-wrap:break-word}.cart-preview__item-price{color:var(--edd-cart-preview-color-text-muted);font-size:var(--edd-cart-preview-font-size-small)}.cart-preview__item-quantity{margin-top:.5rem}.cart-preview__item-remove{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;color:#999;font-size:20px;line-height:1;padding:.25rem .5rem;flex-shrink:0;transition:color .2s ease;align-self:center}.cart-preview__item-remove svg{width:20px;height:20px;display:block}.cart-preview__item-remove .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__item-remove:hover,.cart-preview__item-remove:focus{color:var(--edd-cart-preview-color-danger)}.cart-preview__item-remove:focus{outline:2px solid var(--edd-cart-preview-color-primary);outline-offset:2px}.cart-preview__summary{border-top:2px solid var(--edd-cart-preview-color-border);padding-top:var(--edd-cart-preview-spacing-lg);margin-top:auto;display:flex;flex-direction:column;gap:var(--edd-cart-preview-spacing-md)}.cart-preview__summary--taxes{font-size:13px;font-style:italic;color:var(--edd-cart-preview-color-text-muted);margin:0}.cart-preview__summary-row{display:flex;justify-content:space-between;margin:0;font-size:var(--edd-cart-preview-font-size-small)}@media(min-width: 782px){.cart-preview__summary-row{font-size:var(--edd-cart-preview-font-size-base)}}.cart-preview__summary-label{font-weight:600}.cart-preview__footer{padding:var(--edd-cart-preview-spacing-md);border-top:1px solid var(--edd-cart-preview-color-border);display:flex;justify-content:space-between;align-items:center;gap:.75rem;flex-shrink:0}@media(min-width: 782px){.cart-preview__footer{padding:var(--edd-cart-preview-spacing-lg)}}.cart-preview__button{padding:.75rem var(--edd-cart-preview-spacing-md);border:none;border-radius:var(--edd-cart-preview-border-radius);font-size:var(--edd-cart-preview-font-size-medium);font-weight:600;cursor:pointer;transition:all .2s ease;text-align:center;text-decoration:none;display:block}@media(min-width: 782px){.cart-preview__button{padding:.75rem var(--edd-cart-preview-spacing-lg);font-size:var(--edd-cart-preview-font-size-base)}}.cart-preview__button:focus{outline:2px solid var(--edd-cart-preview-color-primary);outline-offset:2px}.cart-preview__button.cart-preview__button--primary{background:var(--edd-cart-preview-color-primary);color:var(--edd-cart-preview-color-primary-text);flex-grow:1}.cart-preview__button.cart-preview__button--primary:hover,.cart-preview__button.cart-preview__button--primary:focus{background:var(--edd-cart-preview-color-primary-hover);color:var(--edd-cart-preview-color-primary-text)}.cart-preview__button.cart-preview__button--secondary{background:rgba(0,0,0,0);color:var(--edd-cart-preview-color-primary);border:1px solid var(--edd-cart-preview-color-primary)}.cart-preview__button.cart-preview__button--secondary:hover,.cart-preview__button.cart-preview__button--secondary:focus{background:#f0f0f0}.cart-preview__spinner{animation:1.5s linear infinite edd-spinning;animation-play-state:inherit;border:2px solid #f3f3f3;border-bottom-color:#666;border-radius:100%;content:"";width:20px;height:20px;transform:translate3d(-50%, -50%, 0);will-change:transform}.screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__button--trigger{position:fixed;bottom:20px;left:20px;width:60px;height:60px;border-radius:50%;background:var(--edd-cart-preview-color-background);border:none;box-shadow:var(--edd-cart-preview-shadow-button);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:999998;transition:all .2s ease}@media(min-width: 782px){.cart-preview__button--trigger{width:80px;height:80px}}.cart-preview__button--trigger svg{width:28px;height:28px;stroke:var(--edd-cart-preview-color-text);color:var(--edd-cart-preview-color-text)}@media(min-width: 782px){.cart-preview__button--trigger svg{width:32px;height:32px}}.cart-preview__button--trigger--small{width:48px;height:48px}.cart-preview__button--trigger--small svg{width:20px;height:20px}.cart-preview__button--trigger--right{right:20px;left:auto}.cart-preview__button--trigger:hover{box-shadow:0 6px 16px rgba(0,0,0,.2);transform:scale(1.05)}.cart-preview__button--trigger:focus{outline:2px solid var(--edd-cart-preview-color-primary);outline-offset:2px}:host([dir=rtl]) .cart-preview__button--trigger{left:auto;right:20px}.cart-preview__quantity-control{display:inline-flex;align-items:center;gap:4px;border:1px solid var(--edd-cart-preview-color-border);border-radius:var(--edd-cart-preview-border-radius);padding:4px}.cart-preview__quantity-button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;font-size:var(--edd-cart-preview-font-size-base);color:var(--edd-cart-preview-color-text);border-radius:3px;transition:all .2s ease}.cart-preview__quantity-button svg{width:16px;height:16px}.cart-preview__quantity-button .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__quantity-button:hover:not(:disabled){background:#f3f4f6;color:var(--edd-cart-preview-color-text)}.cart-preview__quantity-button:disabled{opacity:.4;cursor:not-allowed}.cart-preview__quantity-button:focus{outline:2px solid var(--edd-cart-preview-color-primary);outline-offset:2px}.cart-preview__quantity-display{min-width:2ch;text-align:center;font-size:var(--edd-cart-preview-font-size-small);font-weight:500;color:var(--edd-cart-preview-color-text)}.hidden.hidden{display:none}',""]);const s=n}},t={};function r(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=r(651),t=r.n(e);class i{constructor(){this.filters={},this.actions={}}addFilter(e,t,r=10){this.filters[e]||(this.filters[e]=[]),this.filters[e].push({callback:t,priority:r}),this.filters[e].sort(((e,t)=>e.priority-t.priority))}applyFilters(e,t,...r){return this.filters[e]?this.filters[e].reduce(((e,{callback:t})=>t(e,...r)),t):t}addAction(e,t,r=10){this.actions[e]||(this.actions[e]=[]),this.actions[e].push({callback:t,priority:r}),this.actions[e].sort(((e,t)=>e.priority-t.priority))}doAction(e,...t){if(this.actions[e])for(const{callback:r}of this.actions[e])r(...t)}removeFilter(e,t){if(!this.filters[e])return!1;const r=this.filters[e].length;return this.filters[e]=this.filters[e].filter((e=>e.callback!==t)),this.filters[e].length<r}removeAction(e,t){if(!this.actions[e])return!1;const r=this.actions[e].length;return this.actions[e]=this.actions[e].filter((e=>e.callback!==t)),this.actions[e].length<r}getFilters(e){return e?this.filters[e]||[]:this.filters}getActions(e){return e?this.actions[e]||[]:this.actions}clear(){this.filters={},this.actions={}}clearHook(e,t){t&&"filter"!==t||delete this.filters[e],t&&"action"!==t||delete this.actions[e]}hasHook(e,t){return"filter"===t?!!this.filters[e]&&this.filters[e].length>0:"action"===t?!!this.actions[e]&&this.actions[e].length>0:this.filters[e]&&this.filters[e].length>0||this.actions[e]&&this.actions[e].length>0}}const a=e=>n[e]||"",o=(e=document)=>{const t=e.querySelectorAll("[data-edd-icon]");let r=0;for(const e of t){const t=e.dataset.eddIcon;if(!t)continue;const i=a(t);i&&(e.innerHTML=i,r++)}return r},n={cart:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />\n\t</svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />\n\t</svg>',"x-mark":'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />\n\t</svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />\n\t</svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />\n\t</svg>',down:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />\n\t</svg>'};var s=r(1669);class d{constructor(e){this.config=e,this.hooks=new i,this.state={isOpen:!1,isLoading:!1,items:[],subtotal:"0.00",hasItems:!1,itemCount:0,error:null,token:e.token||""},this.fetchController=null,this.operationController=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.init()}init(){this.createShadowDOM(),this.attachEventListeners(),this.setupGlobalAPI(),this.setupEDDIntegration(),this.fetchCartContents()}createShadowDOM(){this.hostElement=document.createElement("edd-cart-preview"),document.body.appendChild(this.hostElement),this.shadow=this.hostElement.attachShadow({mode:"open"}),this.injectStyles(),this.render(),this.createFloatingButton()}injectStyles(){const e=document.createElement("style");e.textContent=this.generateCSSVariables()+t(),this.shadow.appendChild(e)}generateCSSVariables(){const e=this.config.buttonColors||{};return`\n\t\t\t:host {\n\t\t\t\t--edd-cart-preview-color-primary: ${e.buttonColor||"#2271b1"};\n\t\t\t\t--edd-cart-preview-color-primary-hover: ${e.buttonHoverColor||"#135e96"};\n\t\t\t\t--edd-cart-preview-color-primary-text: ${e.buttonTextColor||"#ffffff"};\n\t\t\t}\n\t\t`}render(){const e=document.getElementById("edd-cart-preview-dialog-template");if(!e)return void console.error("EDD Cart Preview: Dialog template not found. Ensure dialog.php is loaded.");const t=document.importNode(e.content,!0);this.shadow.appendChild(t);const r=document.getElementById("edd-cart-preview-item-template");r?this.itemTemplate=r:this.log("EDD Cart Preview: Item template not found."),this.cacheElements(),o(this.shadow)}createFloatingButton(){if("none"===this.config.buttonSize)return;const e=document.createElement("button");e.className=`cart-preview__button--trigger cart-preview__button--trigger--${this.config.buttonSize}`,this.config.buttonPosition&&(e.className+=` cart-preview__button--trigger--${this.config.buttonPosition}`),e.setAttribute("aria-label","Open cart"),e.setAttribute("part","cart-preview-button-trigger"),e.innerHTML=a("cart"),e.addEventListener("click",this.open),this.shadow.appendChild(e),this.elements.floatingButton=e}cacheElements(){this.elements={dialog:this.shadow.querySelector(".cart-preview__dialog"),closeBtn:this.shadow.querySelector(".cart-preview__close"),continueBtn:this.shadow.querySelector(".cart-preview__continue"),content:this.shadow.querySelector(".cart-preview__content"),scrollIndicator:this.shadow.querySelector(".cart-preview__scroll-indicator"),loading:this.shadow.querySelector(".cart-preview__loading"),error:this.shadow.querySelector(".cart-preview__error"),errorMessage:this.shadow.querySelector(".cart-preview__error--message"),errorDismiss:this.shadow.querySelector(".cart-preview__error--dismiss"),empty:this.shadow.querySelector(".cart-preview__empty"),items:this.shadow.querySelector(".cart-preview__items"),itemsList:this.shadow.querySelector(".cart-preview__items-list"),summaryValue:this.shadow.querySelector(".cart-preview__summary-value"),footer:this.shadow.querySelector(".cart-preview__footer"),status:this.shadow.querySelector("[data-edd-cart-status]")}}attachEventListeners(){this.elements.closeBtn.addEventListener("click",this.close),this.elements.continueBtn.addEventListener("click",this.close),this.elements.dialog.addEventListener("close",(()=>{this.state.isOpen=!1,document.body.style.overflow="",document.dispatchEvent(new CustomEvent("edd:cart-preview:closed"))})),this.elements.dialog.addEventListener("click",this.handleBackdropClick),this.elements.errorDismiss.addEventListener("click",(()=>this.clearError())),this.elements.content.addEventListener("scroll",(()=>this.updateScrollIndicator()))}setupGlobalAPI(){globalThis.eddSlideoutCart={open:this.open,close:this.close,toggle:this.toggle,refresh:()=>this.fetchCartContents(),getState:()=>({...this.state}),hooks:this.hooks},document.dispatchEvent(new CustomEvent("edd:cart-preview:ready",{detail:{api:globalThis.eddSlideoutCart}}))}setupEDDIntegration(){const e=()=>{if(void 0===s)return;const e=s;e(document.body).on("edd_cart_item_added",(async(e,t)=>{this.log("EDD Cart: Item added",t),await this.fetchCartContents(),this.elements.status&&t?.addedToCart&&(this.elements.status.textContent=t.addedToCart),this.config.autoOpenOnAdd&&this.open()})),e(document.body).on("edd_cart_item_removed",(async(e,t)=>{this.log("EDD Cart: Item removed",t),await this.fetchCartContents()})),e(document.body).on("edd_quantity_updated",(async(e,t)=>{this.log("EDD Cart: Quantity updated",t),await this.fetchCartContents()}))};if(void 0!==s)e();else{const t=setInterval((()=>{void 0!==s&&(clearInterval(t),e())}),100);setTimeout((()=>clearInterval(t)),5e3)}}open(){this.state.isOpen=!0,this.elements.dialog.showModal(),document.body.style.overflow="hidden",document.dispatchEvent(new CustomEvent("edd:cart-preview:opened"))}close(){this.elements.dialog.classList.add("closing"),setTimeout((()=>{this.elements.dialog.close(),this.elements.dialog.classList.remove("closing")}),400)}toggle(){this.state.isOpen?this.close():this.open()}handleBackdropClick(e){if(e.target===this.elements.dialog){const t=this.elements.dialog.getBoundingClientRect();e.clientX>=t.left&&e.clientX<=t.right&&e.clientY>=t.top&&e.clientY<=t.bottom||this.close()}}updateUI(){this.log("EDD Cart Preview: Updating UI",{hasItems:this.state.hasItems,itemCount:this.state.items.length,isLoading:this.state.isLoading}),this.elements.loading.classList.toggle("hidden",!this.state.isLoading),this.elements.empty.classList.toggle("hidden",this.state.hasItems),this.elements.items.classList.toggle("hidden",!this.state.hasItems),this.elements.footer.classList.toggle("hidden",!this.state.hasItems),this.elements.floatingButton&&this.elements.floatingButton.classList.toggle("hidden",!this.state.hasItems),this.state.hasItems&&(this.log("EDD Cart Preview: Rendering items",this.state.items),this.renderItems(),this.elements.summaryValue.innerHTML=this.state.subtotal,setTimeout((()=>this.updateScrollIndicator()),0))}renderItems(){if(this.elements.itemsList.innerHTML="",this.itemTemplate){this.hooks.doAction("beforeRenderItems");for(const e of this.state.items){const t=this.hooks.applyFilters("cartItemData",e),r=this.createItemElement(t);this.elements.itemsList.appendChild(r);const i=this.elements.itemsList.querySelector(`[data-cart-key="${e.key}"]`);if(!i)return;const a=this.hooks.applyFilters("cartItemMessages",[],t);if(a.length>0){const e=this.createMessagesContainer(a);i.appendChild(e)}this.hooks.doAction("itemRendered",i,t)}this.hooks.doAction("afterRenderItems",this.state.cartData||{})}else console.error("EDD Cart Preview: Item template not available.")}createItemElement(e){const t=document.importNode(this.itemTemplate.content,!0),r=t.querySelector(".cart-preview__item"),i=t.querySelector(".cart-preview__item-image"),a=t.querySelector(".cart-preview__item-name"),n=t.querySelector(".cart-preview__item-price"),s=t.querySelector(".cart-preview__item-remove"),d=t.querySelector(".cart-preview__item-quantity"),c=t.querySelector(".cart-preview__quantity-control"),l=t.querySelector(".cart-preview__quantity-display"),p=t.querySelector(".cart-preview__quantity-button--minus"),h=t.querySelector(".cart-preview__quantity-button--plus"),v=t.querySelector(".cart-preview__fees-list");if(r.dataset.cartKey=e.key,e.thumbnail&&(i.src=e.thumbnail,i.alt=e.name,i.style.display=""),a.textContent=e.name,n.innerHTML=e.price,e.quantities_enabled&&(d.style.display="",c.dataset.cartKey=e.key,l.textContent=e.quantity,p.addEventListener("click",(e=>{const t=Number.parseInt(c.dataset.cartKey),r=Number.parseInt(l.textContent);r>1&&this.updateQuantity(t,r-1)})),h.addEventListener("click",(e=>{const t=Number.parseInt(c.dataset.cartKey),r=Number.parseInt(l.textContent);this.updateQuantity(t,r+1)})),e.quantity<=1&&(p.disabled=!0)),e.fees&&e.fees.length>0){v.style.display="";for(const t of e.fees){const e=document.createElement("div");e.className="cart-preview__fee",e.innerHTML=`<strong>${t.label}:</strong> ${t.amount}`,v.appendChild(e)}t.querySelector(".cart-preview__item-fees").style.display=""}s.dataset.cartKey=e.key;const m=(s.dataset.labelTemplate||"Remove %s from cart").replace("%s",e.name);return s.setAttribute("aria-label",m),s.addEventListener("click",(e=>{const t=Number.parseInt(e.currentTarget.dataset.cartKey);this.removeItem(t)})),o(t),t}createMessagesContainer(e){const t=document.createElement("div");t.className="cart-preview__item__messages";for(const r of e){const e=document.createElement("div");e.className="cart-preview__item__message",r.type&&e.classList.add(`cart-preview__item__message--${r.type}`),e.textContent=r.text,t.appendChild(e)}return t}showError(e){this.state.error=e,this.elements.errorMessage.textContent=e,this.elements.error.classList.remove("hidden")}clearError(){this.state.error=null,this.elements.error.classList.add("hidden")}updateScrollIndicator(){if(!this.elements.scrollIndicator||!this.elements.content)return;const e=this.elements.content,t=e.scrollHeight>e.clientHeight,r=Math.abs(e.scrollHeight-e.clientHeight-e.scrollTop)<5,i=e.offsetWidth>e.clientWidth,a=t&&!r&&!i;this.elements.scrollIndicator.classList.toggle("hidden",!a)}async fetchCartContents(){this.fetchController&&this.fetchController.abort(),this.fetchController=new AbortController,this.state.isLoading=!0,this.updateUI();try{const e=await fetch(`${this.config.apiBase}/contents`,{method:"GET",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp,"X-WP-Nonce":this.config.nonce},credentials:"same-origin",signal:this.fetchController.signal});if(!e.ok)throw new Error("Failed to fetch cart contents");const t=await e.json();this.log("EDD Cart Preview: Fetched cart data",t),this.updateStateFromResponse(t)}catch(e){if("AbortError"===e.name)return void this.log("EDD Cart Preview: Fetch aborted (newer request started)");console.error("EDD Cart Preview: Fetch failed",e),this.showError(this.config.i18n.failedCartContents)}finally{this.state.isLoading=!1,this.fetchController=null,this.updateUI()}}async removeItem(e){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const t={"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp};this.config.nonce&&(t["X-WP-Nonce"]=this.config.nonce);const r=await fetch(`${this.config.apiBase}/remove`,{method:"POST",headers:t,credentials:"same-origin",body:JSON.stringify({cart_key:e}),signal:this.operationController.signal});if(!r.ok)throw new Error("Failed to remove item");const i=await r.json();this.updateStateFromResponse(i),i.removedFromCart&&this.elements.status&&(this.elements.status.textContent=i.removedFromCart),i.download_id&&this.updatePurchaseForm(i.download_id),document.dispatchEvent(new CustomEvent("edd:cart-item-removed",{detail:{cartKey:e,downloadId:i.download_id,data:i}}))}catch(e){if("AbortError"===e.name)return void this.log("EDD Cart Preview: Remove operation aborted (newer operation started)");console.error("EDD Cart Preview: Remove failed",e),this.showError(this.config.i18n.failedRemoveItem)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updatePurchaseForm(e){const t=document.querySelector(`#edd_purchase_${e}`);if(!t)return;const r=t.querySelector("button.edd-add-to-cart.edd-has-js"),i=t.querySelector("a.edd_go_to_checkout"),a=t.querySelector(".edd_price_options");r&&(r.style.display="",r.removeAttribute("data-edd-loading")),i&&(i.style.display="none"),a&&(a.style.display=""),this.log(`EDD Cart Preview: Updated purchase form for download ${e}`)}async updateQuantity(e,t){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const r={"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp};this.config.nonce&&(r["X-WP-Nonce"]=this.config.nonce);const i=await fetch(`${this.config.apiBase}/update-quantity`,{method:"POST",headers:r,credentials:"same-origin",body:JSON.stringify({cart_key:e,quantity:t}),signal:this.operationController.signal});if(!i.ok)throw new Error("Failed to update quantity");const a=await i.json();this.updateStateFromResponse(a),document.dispatchEvent(new CustomEvent("edd:cart-quantity-updated",{detail:{cartKey:e,quantity:t,data:a}}))}catch(e){if("AbortError"===e.name)return void this.log("EDD Cart Preview: Update quantity aborted (newer operation started)");console.error("EDD Cart Preview: Update quantity failed",e),this.showError(this.config.i18n.failedUpdateQuantity)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updateStateFromResponse(e){this.log("EDD Cart Preview: Updating state from response",e);const t=e.cart||e;this.state.items=t.items||[],this.state.subtotal=t.subtotal||"0.00",this.state.hasItems=t.has_items||!1,this.state.itemCount=t.item_count||0,this.state.cartData=t,e.token&&(this.state.token=e.token,e.timestamp&&(this.config.timestamp=e.timestamp)),this.log("EDD Cart Preview: New state",this.state)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}log(e){this.config.debug&&console.log(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})):globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})()})();