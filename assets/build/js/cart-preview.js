<<<<<<< HEAD
(()=>{var t={651:(t,e,r)=>{var i=r(8151);i&&i.__esModule&&(i=i.default),t.exports="string"==typeof i?i:i.toString()},1601:t=>{"use strict";t.exports=function(t){return t[1]}},1669:t=>{"use strict";t.exports=jQuery},6314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var n={};if(i)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(n[d]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&n[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},8151:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r(1601),o=r.n(i),a=r(6314),n=r.n(a)()(o());n.push([t.id,'@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes slideDown{from{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}@keyframes slideOut{from{transform:translateX(0)}to{transform:translateX(100%)}}@keyframes slideInRTL{from{transform:translateX(-100%)}to{transform:translateX(0)}}@keyframes slideOutRTL{from{transform:translateX(0)}to{transform:translateX(-100%)}}.cart-preview__dialog{border:none;padding:0;margin:0;max-width:none;max-height:none}.cart-preview__dialog[open]{position:fixed;bottom:0;left:0;right:0;top:90px;margin:0;width:100%;height:auto;max-height:calc(100vh - 90px);background:#fff;box-shadow:0 -2px 8px rgba(0,0,0,.1);border-radius:.75rem .75rem 0 0;display:flex;flex-direction:column;transform:translateY(100%);animation:slideUp .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog[open]{top:0;right:0;bottom:0;left:auto;max-width:400px;height:100%;max-height:none;box-shadow:-2px 0 8px rgba(0,0,0,.1);border-radius:.75rem 0 0 .75rem;transform:translateX(100%);animation:slideIn .4s ease forwards}}.cart-preview__dialog.closing{animation:slideDown .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog.closing{animation:slideOut .4s ease forwards}}.cart-preview__dialog::backdrop{background:rgba(0,0,0,.5);transition:opacity .4s ease}@media(min-width: 782px){:host-context([dir=rtl]) .cart-preview__dialog[open]{left:0;right:auto;border-radius:0 1rem 1rem 0;box-shadow:2px 0 8px rgba(0,0,0,.1);transform:translateX(-100%);animation:slideInRTL .4s ease forwards}:host-context([dir=rtl]) .cart-preview__dialog.closing{animation:slideOutRTL .4s ease forwards}}.cart-preview__header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid #e0e0e0;flex-shrink:0}@media(min-width: 782px){.cart-preview__header{padding:1.5rem}}.cart-preview__title{margin:0;font-size:1.125rem;font-weight:600}@media(min-width: 782px){.cart-preview__title{font-size:1.25rem}}.cart-preview__close{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.5rem;line-height:1;padding:.5rem;color:#666;transition:color .2s ease}.cart-preview__close svg{width:1.5rem;height:1.5rem;display:block}.cart-preview__close .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__close:hover,.cart-preview__close:focus{color:#000}.cart-preview__close:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__content{flex:1;overflow-y:auto;overflow-x:hidden;padding:1rem;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;position:relative}@media(min-width: 782px){.cart-preview__content{padding:1.5rem}}.cart-preview__loading{display:flex;align-items:center;justify-content:center;padding:1.5rem;color:#666;position:fixed;top:0;left:0;right:0;bottom:0;z-index:999999;background:hsla(0,0%,100%,.5)}@media(min-width: 782px){.cart-preview__loading{padding:3rem 1.5rem}}.cart-preview__error{padding:1rem;margin-bottom:1rem;background:#fee;border:1px solid #fcc;color:#c00;display:flex;align-items:center;justify-content:space-between;gap:1rem}.cart-preview__error--dismiss{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.25rem;line-height:1;padding:0 .5rem}.cart-preview__empty{text-align:center;padding:1.5rem;color:#666}@media(min-width: 782px){.cart-preview__empty{padding:3rem 1.5rem}}.cart-preview__items{display:flex;flex-direction:column;gap:1rem;flex-grow:1}.cart-preview__item{display:flex;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:4px;margin-bottom:1rem;flex-wrap:wrap}.cart-preview__item__message{font-style:italic;margin-top:8px;padding:6px 10px;background-color:rgba(0,115,170,.1);border-left:3px solid #0073aa;font-size:.85em;color:#666;line-height:1.5;flex-basis:100%}.cart-preview__item-image{width:60px;height:60px;object-fit:cover;border-radius:4px;flex-shrink:0}.cart-preview__item-details{flex:1;min-width:0}.cart-preview__item-name{font-weight:600;margin:0 0 .5rem 0;font-size:.9rem;overflow-wrap:break-word;word-wrap:break-word}@media(min-width: 782px){.cart-preview__item-name{font-size:.95rem}}.cart-preview__item-price{color:#666;font-size:.875rem}@media(min-width: 782px){.cart-preview__item-price{font-size:.9rem}}.cart-preview__item-quantity{margin-top:.5rem}.cart-preview__item-remove{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;color:#999;font-size:1.25rem;line-height:1;padding:.25rem .5rem;flex-shrink:0;transition:color .2s ease;align-self:center}.cart-preview__item-remove svg{width:1.25rem;height:1.25rem;display:block}.cart-preview__item-remove .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__item-remove:hover,.cart-preview__item-remove:focus{color:#c00}.cart-preview__item-remove:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__summary{border-top:2px solid #e0e0e0;padding-top:1.5rem;margin-top:auto;display:flex;flex-direction:column;gap:1rem}.cart-preview__summary--taxes{font-size:.8rem;font-style:italic;color:#666;margin:0}.cart-preview__summary-row{display:flex;justify-content:space-between;margin:0;font-size:.9rem}@media(min-width: 782px){.cart-preview__summary-row{font-size:1rem}}.cart-preview__summary-label{font-weight:600}.cart-preview__footer{padding:1rem;border-top:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;gap:.75rem;flex-shrink:0}@media(min-width: 782px){.cart-preview__footer{padding:1.5rem}}.cart-preview__button{padding:.75rem 1rem;border:none;border-radius:4px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease;text-align:center;text-decoration:none;display:block}@media(min-width: 782px){.cart-preview__button{padding:.75rem 1.5rem;font-size:1rem}}.cart-preview__button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__button--primary{background:var(--edd-button-color, #2271b1);color:var(--edd-button-text-color, #ffffff);flex-grow:1}.cart-preview__button--primary:hover,.cart-preview__button--primary:focus{background:var(--edd-button-hover-color, #135e96)}.cart-preview__button--secondary{background:rgba(0,0,0,0);color:var(--edd-button-color, #2271b1);border:1px solid var(--edd-button-color, #2271b1)}.cart-preview__button--secondary:hover,.cart-preview__button--secondary:focus{background:#f0f0f0}.cart-preview__spinner{animation:1.5s linear infinite edd-spinning;animation-play-state:inherit;border:2px solid #f3f3f3;border-bottom-color:#666;border-radius:100%;content:"";width:20px;height:20px;transform:translate3d(-50%, -50%, 0);will-change:transform}.screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__button--trigger{position:fixed;bottom:20px;left:20px;width:60px;height:60px;border-radius:50%;background:#fff;border:none;box-shadow:0 4px 12px rgba(0,0,0,.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:999998;transition:all .2s ease}@media(min-width: 782px){.cart-preview__button--trigger{width:80px;height:80px}}.cart-preview__button--trigger svg{width:1.75rem;height:1.75rem;stroke:#000;color:#000}@media(min-width: 782px){.cart-preview__button--trigger svg{width:2rem;height:2rem}}.cart-preview__button--trigger:hover{box-shadow:0 6px 16px rgba(0,0,0,.2);transform:scale(1.05)}.cart-preview__button--trigger:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}:host-context([dir=rtl]) .cart-preview__button--trigger{left:auto;right:20px}.cart-preview__quantity-control{display:inline-flex;align-items:center;gap:4px;border:1px solid #e0e0e0;border-radius:4px;padding:4px}.cart-preview__quantity-button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;font-size:1rem;color:#000;border-radius:3px;transition:all .2s ease}.cart-preview__quantity-button svg{width:1rem;height:1rem}.cart-preview__quantity-button .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__quantity-button:hover:not(:disabled){background:#f3f4f6;color:#000}.cart-preview__quantity-button:disabled{opacity:.4;cursor:not-allowed}.cart-preview__quantity-button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__quantity-display{min-width:2ch;text-align:center;font-size:.875rem;font-weight:500;color:#000}.hidden.hidden{display:none}',""]);const s=n}},e={};function r(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=r(651),e=r.n(t);class i{constructor(){this.filters={},this.actions={}}addFilter(t,e,r=10){this.filters[t]||(this.filters[t]=[]),this.filters[t].push({callback:e,priority:r}),this.filters[t].sort(((t,e)=>t.priority-e.priority))}applyFilters(t,e,...r){return this.filters[t]?this.filters[t].reduce(((t,{callback:e})=>e(t,...r)),e):e}addAction(t,e,r=10){this.actions[t]||(this.actions[t]=[]),this.actions[t].push({callback:e,priority:r}),this.actions[t].sort(((t,e)=>t.priority-e.priority))}doAction(t,...e){if(this.actions[t])for(const{callback:r}of this.actions[t])r(...e)}removeFilter(t,e){if(!this.filters[t])return!1;const r=this.filters[t].length;return this.filters[t]=this.filters[t].filter((t=>t.callback!==e)),this.filters[t].length<r}removeAction(t,e){if(!this.actions[t])return!1;const r=this.actions[t].length;return this.actions[t]=this.actions[t].filter((t=>t.callback!==e)),this.actions[t].length<r}getFilters(t){return t?this.filters[t]||[]:this.filters}getActions(t){return t?this.actions[t]||[]:this.actions}clear(){this.filters={},this.actions={}}clearHook(t,e){e&&"filter"!==e||delete this.filters[t],e&&"action"!==e||delete this.actions[t]}hasHook(t,e){return"filter"===e?!!this.filters[t]&&this.filters[t].length>0:"action"===e?!!this.actions[t]&&this.actions[t].length>0:this.filters[t]&&this.filters[t].length>0||this.actions[t]&&this.actions[t].length>0}}const o=t=>n[t]||"",a=(t=document)=>{const e=t.querySelectorAll("[data-edd-icon]");let r=0;for(const t of e){const e=t.dataset.eddIcon;if(!e)continue;const i=o(e);i&&(t.innerHTML=i,r++)}return r},n={cart:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />\n\t</svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />\n\t</svg>',"x-mark":'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />\n\t</svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />\n\t</svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />\n\t</svg>'};var s=r(1669);class d{constructor(t){this.config=t,this.hooks=new i,this.state={isOpen:!1,isLoading:!1,items:[],subtotal:"0.00",hasItems:!1,itemCount:0,error:null,token:t.token||""},this.fetchController=null,this.operationController=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.init()}init(){this.createShadowDOM(),this.attachEventListeners(),this.setupGlobalAPI(),this.setupEDDIntegration(),this.fetchCartContents()}createShadowDOM(){this.hostElement=document.createElement("edd-cart-preview"),document.body.appendChild(this.hostElement),this.shadow=this.hostElement.attachShadow({mode:"open"}),this.injectStyles(),this.render(),this.createFloatingButton()}injectStyles(){const t=document.createElement("style");t.textContent=this.generateCSSVariables()+e(),this.shadow.appendChild(t)}generateCSSVariables(){const t=this.config.buttonColors||{};return`\n\t\t\t:host {\n\t\t\t\t--edd-button-color: ${t.buttonColor||"#2271b1"};\n\t\t\t\t--edd-button-hover-color: ${t.buttonHoverColor||"#135e96"};\n\t\t\t\t--edd-button-text-color: ${t.buttonTextColor||"#ffffff"};\n\t\t\t}\n\t\t`}render(){const t=document.getElementById("edd-cart-preview-dialog-template");if(!t)return void console.error("EDD Cart Preview: Dialog template not found. Ensure dialog.php is loaded.");const e=document.importNode(t.content,!0);this.shadow.appendChild(e);const r=document.getElementById("edd-cart-preview-item-template");r?this.itemTemplate=r:this.log("EDD Cart Preview: Item template not found."),this.cacheElements(),a(this.shadow)}createFloatingButton(){if(!this.config.showButton)return;const t=document.createElement("button");t.className="cart-preview__button--trigger",t.setAttribute("aria-label","Open cart"),t.setAttribute("part","cart-preview-button-trigger"),t.innerHTML=o("cart"),t.addEventListener("click",this.open),this.shadow.appendChild(t),this.elements.floatingButton=t}cacheElements(){this.elements={dialog:this.shadow.querySelector(".cart-preview__dialog"),closeBtn:this.shadow.querySelector(".cart-preview__close"),continueBtn:this.shadow.querySelector(".cart-preview__continue"),loading:this.shadow.querySelector(".cart-preview__loading"),error:this.shadow.querySelector(".cart-preview__error"),errorMessage:this.shadow.querySelector(".cart-preview__error--message"),errorDismiss:this.shadow.querySelector(".cart-preview__error--dismiss"),empty:this.shadow.querySelector(".cart-preview__empty"),items:this.shadow.querySelector(".cart-preview__items"),itemsList:this.shadow.querySelector(".cart-preview__items-list"),summaryValue:this.shadow.querySelector(".cart-preview__summary-value"),footer:this.shadow.querySelector(".cart-preview__footer")}}attachEventListeners(){this.elements.closeBtn.addEventListener("click",this.close),this.elements.continueBtn.addEventListener("click",this.close),this.elements.dialog.addEventListener("close",(()=>{this.state.isOpen=!1,document.body.style.overflow="",document.dispatchEvent(new CustomEvent("edd:cart-preview:closed"))})),this.elements.dialog.addEventListener("click",this.handleBackdropClick),this.elements.errorDismiss.addEventListener("click",(()=>this.clearError()))}setupGlobalAPI(){globalThis.eddSlideoutCart={open:this.open,close:this.close,toggle:this.toggle,refresh:()=>this.fetchCartContents(),getState:()=>({...this.state}),hooks:this.hooks},document.dispatchEvent(new CustomEvent("edd:cart-preview:ready",{detail:{api:globalThis.eddSlideoutCart}}))}setupEDDIntegration(){const t=()=>{if(void 0===s)return;const t=s;t(document.body).on("edd_cart_item_added",(async(t,e)=>{this.log("EDD Cart: Item added",e),await this.fetchCartContents(),this.config.autoOpenOnAdd&&this.open()})),t(document.body).on("edd_cart_item_removed",(async(t,e)=>{this.log("EDD Cart: Item removed",e),await this.fetchCartContents()})),t(document.body).on("edd_quantity_updated",(async(t,e)=>{this.log("EDD Cart: Quantity updated",e),await this.fetchCartContents()}))};if(void 0!==s)t();else{const e=setInterval((()=>{void 0!==s&&(clearInterval(e),t())}),100);setTimeout((()=>clearInterval(e)),5e3)}}open(){this.state.isOpen=!0,this.elements.dialog.showModal(),document.body.style.overflow="hidden",document.dispatchEvent(new CustomEvent("edd:cart-preview:opened"))}close(){this.elements.dialog.classList.add("closing"),setTimeout((()=>{this.elements.dialog.close(),this.elements.dialog.classList.remove("closing")}),400)}toggle(){this.state.isOpen?this.close():this.open()}handleBackdropClick(t){if(t.target===this.elements.dialog){const e=this.elements.dialog.getBoundingClientRect();t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom||this.close()}}updateUI(){this.log("EDD Cart Preview: Updating UI",{hasItems:this.state.hasItems,itemCount:this.state.items.length,isLoading:this.state.isLoading}),this.elements.loading.classList.toggle("hidden",!this.state.isLoading),this.elements.empty.classList.toggle("hidden",this.state.hasItems),this.elements.items.classList.toggle("hidden",!this.state.hasItems),this.elements.footer.classList.toggle("hidden",!this.state.hasItems),this.elements.floatingButton&&this.elements.floatingButton.classList.toggle("hidden",!this.state.hasItems),this.state.hasItems&&(this.log("EDD Cart Preview: Rendering items",this.state.items),this.renderItems(),this.elements.summaryValue.innerHTML=this.state.subtotal)}renderItems(){if(this.elements.itemsList.innerHTML="",this.itemTemplate){this.hooks.doAction("beforeRenderItems");for(const t of this.state.items){const e=this.hooks.applyFilters("cartItemData",t),r=this.createItemElement(e);this.elements.itemsList.appendChild(r);const i=this.elements.itemsList.querySelector(`[data-cart-key="${t.key}"]`);i&&this.hooks.doAction("itemRendered",i,e)}this.hooks.doAction("afterRenderItems",this.state.cartData||{})}else console.error("EDD Cart Preview: Item template not available.")}createItemElement(t){const e=document.importNode(this.itemTemplate.content,!0),r=e.querySelector(".cart-preview__item"),i=e.querySelector(".cart-preview__item-image"),o=e.querySelector(".cart-preview__item-name"),n=e.querySelector(".cart-preview__item-price"),s=e.querySelector(".cart-preview__item-remove"),d=e.querySelector(".cart-preview__item-quantity"),l=e.querySelector(".cart-preview__quantity-control"),c=e.querySelector(".cart-preview__quantity-display"),h=e.querySelector(".cart-preview__quantity-button--minus"),p=e.querySelector(".cart-preview__quantity-button--plus");r.dataset.cartKey=t.key,t.thumbnail&&(i.src=t.thumbnail,i.alt=t.name,i.style.display=""),o.textContent=t.name,n.innerHTML=t.price,t.quantities_enabled&&(d.style.display="",l.dataset.cartKey=t.key,c.textContent=t.quantity,h.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);r>1&&this.updateQuantity(e,r-1)})),p.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);this.updateQuantity(e,r+1)})),t.quantity<=1&&(h.disabled=!0)),s.dataset.cartKey=t.key;const m=(s.dataset.labelTemplate||"Remove %s from cart").replace("%s",t.name);return s.setAttribute("aria-label",m),s.addEventListener("click",(t=>{const e=Number.parseInt(t.currentTarget.dataset.cartKey);this.removeItem(e)})),a(e),e}showError(t){this.state.error=t,this.elements.errorMessage.textContent=t,this.elements.error.classList.remove("hidden")}clearError(){this.state.error=null,this.elements.error.classList.add("hidden")}async fetchCartContents(){this.fetchController&&this.fetchController.abort(),this.fetchController=new AbortController,this.state.isLoading=!0,this.updateUI();try{const t=await fetch(`${this.config.apiBase}/contents`,{method:"GET",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},signal:this.fetchController.signal});if(!t.ok)throw new Error("Failed to fetch cart contents");const e=await t.json();this.log("EDD Cart Preview: Fetched cart data",e),this.updateStateFromResponse(e)}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Fetch aborted (newer request started)");console.error("EDD Cart Preview: Fetch failed",t),this.showError(this.config.i18n.failedCartContents)}finally{this.state.isLoading=!1,this.fetchController=null,this.updateUI()}}async removeItem(t){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const e=await fetch(`${this.config.apiBase}/remove`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t}),signal:this.operationController.signal});if(!e.ok)throw new Error("Failed to remove item");const r=await e.json();this.updateStateFromResponse(r),r.download_id&&this.updatePurchaseForm(r.download_id),document.dispatchEvent(new CustomEvent("edd:cart-item-removed",{detail:{cartKey:t,downloadId:r.download_id,data:r}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Remove operation aborted (newer operation started)");console.error("EDD Cart Preview: Remove failed",t),this.showError(this.config.i18n.failedRemoveItem)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updatePurchaseForm(t){const e=document.querySelector(`#edd_purchase_${t}`);if(!e)return;const r=e.querySelector("button.edd-add-to-cart.edd-has-js"),i=e.querySelector("a.edd_go_to_checkout"),o=e.querySelector(".edd_price_options");r&&(r.style.display="",r.removeAttribute("data-edd-loading")),i&&(i.style.display="none"),o&&(o.style.display=""),this.log(`EDD Cart Preview: Updated purchase form for download ${t}`)}async updateQuantity(t,e){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const r=await fetch(`${this.config.apiBase}/update-quantity`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t,quantity:e}),signal:this.operationController.signal});if(!r.ok)throw new Error("Failed to update quantity");const i=await r.json();this.updateStateFromResponse(i),document.dispatchEvent(new CustomEvent("edd:cart-quantity-updated",{detail:{cartKey:t,quantity:e,data:i}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Update quantity aborted (newer operation started)");console.error("EDD Cart Preview: Update quantity failed",t),this.showError(this.config.i18n.failedUpdateQuantity)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updateStateFromResponse(t){this.log("EDD Cart Preview: Updating state from response",t);const e=t.cart||t;this.state.items=e.items||[],this.state.subtotal=e.subtotal||"0.00",this.state.hasItems=e.has_items||!1,this.state.itemCount=e.item_count||0,this.state.cartData=e,t.token&&(this.state.token=t.token,t.timestamp&&(this.config.timestamp=t.timestamp)),this.log("EDD Cart Preview: New state",this.state)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}log(t){this.config.debug&&console.log(t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})):globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})()})();
=======
<<<<<<< Updated upstream
(()=>{var t={651:(t,e,r)=>{var i=r(8151);i&&i.__esModule&&(i=i.default),t.exports="string"==typeof i?i:i.toString()},1601:t=>{"use strict";t.exports=function(t){return t[1]}},1669:t=>{"use strict";t.exports=jQuery},6314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var n={};if(i)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(n[d]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&n[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},8151:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r(1601),o=r.n(i),a=r(6314),n=r.n(a)()(o());n.push([t.id,'@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes slideDown{from{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}@keyframes slideOut{from{transform:translateX(0)}to{transform:translateX(100%)}}@keyframes slideInRTL{from{transform:translateX(-100%)}to{transform:translateX(0)}}@keyframes slideOutRTL{from{transform:translateX(0)}to{transform:translateX(-100%)}}.cart-preview__dialog{border:none;padding:0;margin:0;max-width:none;max-height:none}.cart-preview__dialog[open]{position:fixed;bottom:0;left:0;right:0;top:90px;margin:0;width:100%;height:auto;max-height:calc(100vh - 90px);background:#fff;box-shadow:0 -2px 8px rgba(0,0,0,.1);border-radius:.75rem .75rem 0 0;display:flex;flex-direction:column;transform:translateY(100%);animation:slideUp .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog[open]{top:0;right:0;bottom:0;left:auto;max-width:400px;height:100%;max-height:none;box-shadow:-2px 0 8px rgba(0,0,0,.1);border-radius:.75rem 0 0 .75rem;transform:translateX(100%);animation:slideIn .4s ease forwards}}.cart-preview__dialog.closing{animation:slideDown .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog.closing{animation:slideOut .4s ease forwards}}.cart-preview__dialog::backdrop{background:rgba(0,0,0,.5);transition:opacity .4s ease}@media(min-width: 782px){:host-context([dir=rtl]) .cart-preview__dialog[open]{left:0;right:auto;border-radius:0 1rem 1rem 0;box-shadow:2px 0 8px rgba(0,0,0,.1);transform:translateX(-100%);animation:slideInRTL .4s ease forwards}:host-context([dir=rtl]) .cart-preview__dialog.closing{animation:slideOutRTL .4s ease forwards}}.cart-preview__header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid #e0e0e0;flex-shrink:0}@media(min-width: 782px){.cart-preview__header{padding:1.5rem}}.cart-preview__title{margin:0;font-size:1.125rem;font-weight:600}@media(min-width: 782px){.cart-preview__title{font-size:1.25rem}}.cart-preview__close{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.5rem;line-height:1;padding:.5rem;color:#666;transition:color .2s ease}.cart-preview__close svg{width:1.5rem;height:1.5rem;display:block}.cart-preview__close .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__close:hover,.cart-preview__close:focus{color:#000}.cart-preview__close:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__content{flex:1;overflow-y:auto;overflow-x:hidden;padding:1rem;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;position:relative}@media(min-width: 782px){.cart-preview__content{padding:1.5rem}}.cart-preview__loading{display:flex;align-items:center;justify-content:center;padding:1.5rem;color:#666;position:fixed;top:0;left:0;right:0;bottom:0;z-index:999999;background:hsla(0,0%,100%,.5)}@media(min-width: 782px){.cart-preview__loading{padding:3rem 1.5rem}}.cart-preview__error{padding:1rem;margin-bottom:1rem;background:#fee;border:1px solid #fcc;color:#cc1818;display:flex;align-items:center;justify-content:space-between;gap:1rem}.cart-preview__error--dismiss{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.25rem;line-height:1;padding:0 .5rem}.cart-preview__empty{text-align:center;padding:1.5rem;color:#666}@media(min-width: 782px){.cart-preview__empty{padding:3rem 1.5rem}}.cart-preview__items{display:flex;flex-direction:column;gap:1rem;flex-grow:1}.cart-preview__item{display:flex;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:4px;margin-bottom:1rem;flex-wrap:wrap}.cart-preview__item__messages{flex-basis:100%;display:flex;flex-direction:column;margin-top:8px}.cart-preview__item__message{font-style:italic;padding:6px 10px;background-color:rgba(0,115,170,.1);border-left:3px solid #0073aa;font-size:.85em;color:#666;line-height:1.5}.cart-preview__item__message--error{border-left-color:#cc1818;background-color:rgba(204,24,24,.1)}.cart-preview__item-image{width:60px;height:60px;object-fit:cover;border-radius:4px;flex-shrink:0}.cart-preview__item-details{flex:1;min-width:0}.cart-preview__item-name{font-weight:600;margin:0 0 .5rem 0;font-size:.9rem;overflow-wrap:break-word;word-wrap:break-word}@media(min-width: 782px){.cart-preview__item-name{font-size:.95rem}}.cart-preview__item-price{color:#666;font-size:.875rem}@media(min-width: 782px){.cart-preview__item-price{font-size:.9rem}}.cart-preview__item-quantity{margin-top:.5rem}.cart-preview__item-remove{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;color:#999;font-size:1.25rem;line-height:1;padding:.25rem .5rem;flex-shrink:0;transition:color .2s ease;align-self:center}.cart-preview__item-remove svg{width:1.25rem;height:1.25rem;display:block}.cart-preview__item-remove .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__item-remove:hover,.cart-preview__item-remove:focus{color:#cc1818}.cart-preview__item-remove:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__summary{border-top:2px solid #e0e0e0;padding-top:1.5rem;margin-top:auto;display:flex;flex-direction:column;gap:1rem}.cart-preview__summary--taxes{font-size:.8rem;font-style:italic;color:#666;margin:0}.cart-preview__summary-row{display:flex;justify-content:space-between;margin:0;font-size:.9rem}@media(min-width: 782px){.cart-preview__summary-row{font-size:1rem}}.cart-preview__summary-label{font-weight:600}.cart-preview__footer{padding:1rem;border-top:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;gap:.75rem;flex-shrink:0}@media(min-width: 782px){.cart-preview__footer{padding:1.5rem}}.cart-preview__button{padding:.75rem 1rem;border:none;border-radius:4px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease;text-align:center;text-decoration:none;display:block}@media(min-width: 782px){.cart-preview__button{padding:.75rem 1.5rem;font-size:1rem}}.cart-preview__button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__button--primary{background:var(--edd-button-color, #2271b1);color:var(--edd-button-text-color, #ffffff);flex-grow:1}.cart-preview__button--primary:hover,.cart-preview__button--primary:focus{background:var(--edd-button-hover-color, #135e96)}.cart-preview__button--secondary{background:rgba(0,0,0,0);color:var(--edd-button-color, #2271b1);border:1px solid var(--edd-button-color, #2271b1)}.cart-preview__button--secondary:hover,.cart-preview__button--secondary:focus{background:#f0f0f0}.cart-preview__spinner{animation:1.5s linear infinite edd-spinning;animation-play-state:inherit;border:2px solid #f3f3f3;border-bottom-color:#666;border-radius:100%;content:"";width:20px;height:20px;transform:translate3d(-50%, -50%, 0);will-change:transform}.screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__button--trigger{position:fixed;bottom:20px;left:20px;width:60px;height:60px;border-radius:50%;background:#fff;border:none;box-shadow:0 4px 12px rgba(0,0,0,.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:999998;transition:all .2s ease}@media(min-width: 782px){.cart-preview__button--trigger{width:80px;height:80px}}.cart-preview__button--trigger svg{width:1.75rem;height:1.75rem;stroke:#000;color:#000}@media(min-width: 782px){.cart-preview__button--trigger svg{width:2rem;height:2rem}}.cart-preview__button--trigger:hover{box-shadow:0 6px 16px rgba(0,0,0,.2);transform:scale(1.05)}.cart-preview__button--trigger:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}:host-context([dir=rtl]) .cart-preview__button--trigger{left:auto;right:20px}.cart-preview__quantity-control{display:inline-flex;align-items:center;gap:4px;border:1px solid #e0e0e0;border-radius:4px;padding:4px}.cart-preview__quantity-button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;font-size:1rem;color:#000;border-radius:3px;transition:all .2s ease}.cart-preview__quantity-button svg{width:1rem;height:1rem}.cart-preview__quantity-button .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__quantity-button:hover:not(:disabled){background:#f3f4f6;color:#000}.cart-preview__quantity-button:disabled{opacity:.4;cursor:not-allowed}.cart-preview__quantity-button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__quantity-display{min-width:2ch;text-align:center;font-size:.875rem;font-weight:500;color:#000}.hidden.hidden{display:none}',""]);const s=n}},e={};function r(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=r(651),e=r.n(t);class i{constructor(){this.filters={},this.actions={}}addFilter(t,e,r=10){this.filters[t]||(this.filters[t]=[]),this.filters[t].push({callback:e,priority:r}),this.filters[t].sort(((t,e)=>t.priority-e.priority))}applyFilters(t,e,...r){return this.filters[t]?this.filters[t].reduce(((t,{callback:e})=>e(t,...r)),e):e}addAction(t,e,r=10){this.actions[t]||(this.actions[t]=[]),this.actions[t].push({callback:e,priority:r}),this.actions[t].sort(((t,e)=>t.priority-e.priority))}doAction(t,...e){if(this.actions[t])for(const{callback:r}of this.actions[t])r(...e)}removeFilter(t,e){if(!this.filters[t])return!1;const r=this.filters[t].length;return this.filters[t]=this.filters[t].filter((t=>t.callback!==e)),this.filters[t].length<r}removeAction(t,e){if(!this.actions[t])return!1;const r=this.actions[t].length;return this.actions[t]=this.actions[t].filter((t=>t.callback!==e)),this.actions[t].length<r}getFilters(t){return t?this.filters[t]||[]:this.filters}getActions(t){return t?this.actions[t]||[]:this.actions}clear(){this.filters={},this.actions={}}clearHook(t,e){e&&"filter"!==e||delete this.filters[t],e&&"action"!==e||delete this.actions[t]}hasHook(t,e){return"filter"===e?!!this.filters[t]&&this.filters[t].length>0:"action"===e?!!this.actions[t]&&this.actions[t].length>0:this.filters[t]&&this.filters[t].length>0||this.actions[t]&&this.actions[t].length>0}}const o=t=>n[t]||"",a=(t=document)=>{const e=t.querySelectorAll("[data-edd-icon]");let r=0;for(const t of e){const e=t.dataset.eddIcon;if(!e)continue;const i=o(e);i&&(t.innerHTML=i,r++)}return r},n={cart:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />\n\t</svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />\n\t</svg>',"x-mark":'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />\n\t</svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />\n\t</svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />\n\t</svg>'};var s=r(1669);class d{constructor(t){this.config=t,this.hooks=new i,this.state={isOpen:!1,isLoading:!1,items:[],subtotal:"0.00",hasItems:!1,itemCount:0,error:null,token:t.token||""},this.fetchController=null,this.operationController=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.init()}init(){this.createShadowDOM(),this.attachEventListeners(),this.setupGlobalAPI(),this.setupEDDIntegration(),this.fetchCartContents()}createShadowDOM(){this.hostElement=document.createElement("edd-cart-preview"),document.body.appendChild(this.hostElement),this.shadow=this.hostElement.attachShadow({mode:"open"}),this.injectStyles(),this.render(),this.createFloatingButton()}injectStyles(){const t=document.createElement("style");t.textContent=this.generateCSSVariables()+e(),this.shadow.appendChild(t)}generateCSSVariables(){const t=this.config.buttonColors||{};return`\n\t\t\t:host {\n\t\t\t\t--edd-button-color: ${t.buttonColor||"#2271b1"};\n\t\t\t\t--edd-button-hover-color: ${t.buttonHoverColor||"#135e96"};\n\t\t\t\t--edd-button-text-color: ${t.buttonTextColor||"#ffffff"};\n\t\t\t}\n\t\t`}render(){const t=document.getElementById("edd-cart-preview-dialog-template");if(!t)return void console.error("EDD Cart Preview: Dialog template not found. Ensure dialog.php is loaded.");const e=document.importNode(t.content,!0);this.shadow.appendChild(e);const r=document.getElementById("edd-cart-preview-item-template");r?this.itemTemplate=r:this.log("EDD Cart Preview: Item template not found."),this.cacheElements(),a(this.shadow)}createFloatingButton(){if(!this.config.showButton)return;const t=document.createElement("button");t.className="cart-preview__button--trigger",t.setAttribute("aria-label","Open cart"),t.setAttribute("part","cart-preview-button-trigger"),t.innerHTML=o("cart"),t.addEventListener("click",this.open),this.shadow.appendChild(t),this.elements.floatingButton=t}cacheElements(){this.elements={dialog:this.shadow.querySelector(".cart-preview__dialog"),closeBtn:this.shadow.querySelector(".cart-preview__close"),continueBtn:this.shadow.querySelector(".cart-preview__continue"),loading:this.shadow.querySelector(".cart-preview__loading"),error:this.shadow.querySelector(".cart-preview__error"),errorMessage:this.shadow.querySelector(".cart-preview__error--message"),errorDismiss:this.shadow.querySelector(".cart-preview__error--dismiss"),empty:this.shadow.querySelector(".cart-preview__empty"),items:this.shadow.querySelector(".cart-preview__items"),itemsList:this.shadow.querySelector(".cart-preview__items-list"),summaryValue:this.shadow.querySelector(".cart-preview__summary-value"),footer:this.shadow.querySelector(".cart-preview__footer")}}attachEventListeners(){this.elements.closeBtn.addEventListener("click",this.close),this.elements.continueBtn.addEventListener("click",this.close),this.elements.dialog.addEventListener("close",(()=>{this.state.isOpen=!1,document.body.style.overflow="",document.dispatchEvent(new CustomEvent("edd:cart-preview:closed"))})),this.elements.dialog.addEventListener("click",this.handleBackdropClick),this.elements.errorDismiss.addEventListener("click",(()=>this.clearError()))}setupGlobalAPI(){globalThis.eddSlideoutCart={open:this.open,close:this.close,toggle:this.toggle,refresh:()=>this.fetchCartContents(),getState:()=>({...this.state}),hooks:this.hooks},document.dispatchEvent(new CustomEvent("edd:cart-preview:ready",{detail:{api:globalThis.eddSlideoutCart}}))}setupEDDIntegration(){const t=()=>{if(void 0===s)return;const t=s;t(document.body).on("edd_cart_item_added",(async(t,e)=>{this.log("EDD Cart: Item added",e),await this.fetchCartContents(),this.config.autoOpenOnAdd&&this.open()})),t(document.body).on("edd_cart_item_removed",(async(t,e)=>{this.log("EDD Cart: Item removed",e),await this.fetchCartContents()})),t(document.body).on("edd_quantity_updated",(async(t,e)=>{this.log("EDD Cart: Quantity updated",e),await this.fetchCartContents()}))};if(void 0!==s)t();else{const e=setInterval((()=>{void 0!==s&&(clearInterval(e),t())}),100);setTimeout((()=>clearInterval(e)),5e3)}}open(){this.state.isOpen=!0,this.elements.dialog.showModal(),document.body.style.overflow="hidden",document.dispatchEvent(new CustomEvent("edd:cart-preview:opened"))}close(){this.elements.dialog.classList.add("closing"),setTimeout((()=>{this.elements.dialog.close(),this.elements.dialog.classList.remove("closing")}),400)}toggle(){this.state.isOpen?this.close():this.open()}handleBackdropClick(t){if(t.target===this.elements.dialog){const e=this.elements.dialog.getBoundingClientRect();t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom||this.close()}}updateUI(){this.log("EDD Cart Preview: Updating UI",{hasItems:this.state.hasItems,itemCount:this.state.items.length,isLoading:this.state.isLoading}),this.elements.loading.classList.toggle("hidden",!this.state.isLoading),this.elements.empty.classList.toggle("hidden",this.state.hasItems),this.elements.items.classList.toggle("hidden",!this.state.hasItems),this.elements.footer.classList.toggle("hidden",!this.state.hasItems),this.elements.floatingButton&&this.elements.floatingButton.classList.toggle("hidden",!this.state.hasItems),this.state.hasItems&&(this.log("EDD Cart Preview: Rendering items",this.state.items),this.renderItems(),this.elements.summaryValue.innerHTML=this.state.subtotal)}renderItems(){if(this.elements.itemsList.innerHTML="",this.itemTemplate){this.hooks.doAction("beforeRenderItems");for(const t of this.state.items){const e=this.hooks.applyFilters("cartItemData",t),r=this.createItemElement(e);this.elements.itemsList.appendChild(r);const i=this.elements.itemsList.querySelector(`[data-cart-key="${t.key}"]`);if(!i)return;const o=this.hooks.applyFilters("cartItemMessages",[],e);if(o.length>0){const t=this.createMessagesContainer(o);i.appendChild(t)}this.hooks.doAction("itemRendered",i,e)}this.hooks.doAction("afterRenderItems")}else console.error("EDD Cart Preview: Item template not available.")}createItemElement(t){const e=document.importNode(this.itemTemplate.content,!0),r=e.querySelector(".cart-preview__item"),i=e.querySelector(".cart-preview__item-image"),o=e.querySelector(".cart-preview__item-name"),n=e.querySelector(".cart-preview__item-price"),s=e.querySelector(".cart-preview__item-remove"),d=e.querySelector(".cart-preview__item-quantity"),l=e.querySelector(".cart-preview__quantity-control"),c=e.querySelector(".cart-preview__quantity-display"),h=e.querySelector(".cart-preview__quantity-button--minus"),p=e.querySelector(".cart-preview__quantity-button--plus");r.dataset.cartKey=t.key,t.thumbnail&&(i.src=t.thumbnail,i.alt=t.name,i.style.display=""),o.textContent=t.name,n.innerHTML=t.price,t.quantities_enabled&&(d.style.display="",l.dataset.cartKey=t.key,c.textContent=t.quantity,h.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);r>1&&this.updateQuantity(e,r-1)})),p.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);this.updateQuantity(e,r+1)})),t.quantity<=1&&(h.disabled=!0)),s.dataset.cartKey=t.key;const m=(s.dataset.labelTemplate||"Remove %s from cart").replace("%s",t.name);return s.setAttribute("aria-label",m),s.addEventListener("click",(t=>{const e=Number.parseInt(t.currentTarget.dataset.cartKey);this.removeItem(e)})),a(e),e}createMessagesContainer(t){const e=document.createElement("div");e.className="cart-preview__item__messages";for(const r of t){const t=document.createElement("div");t.className="cart-preview__item__message",r.type&&t.classList.add(`cart-preview__item__message--${r.type}`),t.textContent=r.text,e.appendChild(t)}return e}showError(t){this.state.error=t,this.elements.errorMessage.textContent=t,this.elements.error.classList.remove("hidden")}clearError(){this.state.error=null,this.elements.error.classList.add("hidden")}async fetchCartContents(){this.fetchController&&this.fetchController.abort(),this.fetchController=new AbortController,this.state.isLoading=!0,this.updateUI();try{const t=await fetch(`${this.config.apiBase}/contents`,{method:"GET",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},signal:this.fetchController.signal});if(!t.ok)throw new Error("Failed to fetch cart contents");const e=await t.json();this.log("EDD Cart Preview: Fetched cart data",e),this.updateStateFromResponse(e)}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Fetch aborted (newer request started)");console.error("EDD Cart Preview: Fetch failed",t),this.showError(this.config.i18n.failedCartContents)}finally{this.state.isLoading=!1,this.fetchController=null,this.updateUI()}}async removeItem(t){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const e=await fetch(`${this.config.apiBase}/remove`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t}),signal:this.operationController.signal});if(!e.ok)throw new Error("Failed to remove item");const r=await e.json();this.updateStateFromResponse(r),r.download_id&&this.updatePurchaseForm(r.download_id),document.dispatchEvent(new CustomEvent("edd:cart-item-removed",{detail:{cartKey:t,downloadId:r.download_id,data:r}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Remove operation aborted (newer operation started)");console.error("EDD Cart Preview: Remove failed",t),this.showError(this.config.i18n.failedRemoveItem)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updatePurchaseForm(t){const e=document.querySelector(`#edd_purchase_${t}`);if(!e)return;const r=e.querySelector("button.edd-add-to-cart.edd-has-js"),i=e.querySelector("a.edd_go_to_checkout"),o=e.querySelector(".edd_price_options");r&&(r.style.display="",r.removeAttribute("data-edd-loading")),i&&(i.style.display="none"),o&&(o.style.display=""),this.log(`EDD Cart Preview: Updated purchase form for download ${t}`)}async updateQuantity(t,e){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const r=await fetch(`${this.config.apiBase}/update-quantity`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t,quantity:e}),signal:this.operationController.signal});if(!r.ok)throw new Error("Failed to update quantity");const i=await r.json();this.updateStateFromResponse(i),document.dispatchEvent(new CustomEvent("edd:cart-quantity-updated",{detail:{cartKey:t,quantity:e,data:i}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Update quantity aborted (newer operation started)");console.error("EDD Cart Preview: Update quantity failed",t),this.showError(this.config.i18n.failedUpdateQuantity)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updateStateFromResponse(t){this.log("EDD Cart Preview: Updating state from response",t);const e=t.cart||t;this.state.items=e.items||[],this.state.subtotal=e.subtotal||"0.00",this.state.hasItems=e.has_items||!1,this.state.itemCount=e.item_count||0,t.token&&(this.state.token=t.token,t.timestamp&&(this.config.timestamp=t.timestamp)),this.log("EDD Cart Preview: New state",this.state)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}log(t){this.config.debug&&console.log(t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})):globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})()})();
=======
(()=>{var t={651:(t,e,r)=>{var i=r(8151);i&&i.__esModule&&(i=i.default),t.exports="string"==typeof i?i:i.toString()},1601:t=>{"use strict";t.exports=function(t){return t[1]}},1669:t=>{"use strict";t.exports=jQuery},6314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r="",i=void 0!==e[5];return e[4]&&(r+="@supports (".concat(e[4],") {")),e[2]&&(r+="@media ".concat(e[2]," {")),i&&(r+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),r+=t(e),i&&(r+="}"),e[2]&&(r+="}"),e[4]&&(r+="}"),r})).join("")},e.i=function(t,r,i,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var n={};if(i)for(var s=0;s<this.length;s++){var d=this[s][0];null!=d&&(n[d]=!0)}for(var l=0;l<t.length;l++){var c=[].concat(t[l]);i&&n[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=a),r&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=r):c[2]=r),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},8151:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r(1601),o=r.n(i),a=r(6314),n=r.n(a)()(o());n.push([t.id,'@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}@keyframes slideDown{from{transform:translateY(0)}to{transform:translateY(100%)}}@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}@keyframes slideOut{from{transform:translateX(0)}to{transform:translateX(100%)}}@keyframes slideInRTL{from{transform:translateX(-100%)}to{transform:translateX(0)}}@keyframes slideOutRTL{from{transform:translateX(0)}to{transform:translateX(-100%)}}.cart-preview__dialog{border:none;padding:0;margin:0;max-width:none;max-height:none}.cart-preview__dialog[open]{position:fixed;bottom:0;left:0;right:0;top:90px;margin:0;width:100%;height:auto;max-height:calc(100vh - 90px);background:#fff;box-shadow:0 -2px 8px rgba(0,0,0,.1);border-radius:.75rem .75rem 0 0;display:flex;flex-direction:column;transform:translateY(100%);animation:slideUp .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog[open]{top:0;right:0;bottom:0;left:auto;max-width:400px;height:100%;max-height:none;box-shadow:-2px 0 8px rgba(0,0,0,.1);border-radius:.75rem 0 0 .75rem;transform:translateX(100%);animation:slideIn .4s ease forwards}}.cart-preview__dialog.closing{animation:slideDown .4s ease forwards}@media(min-width: 782px){.cart-preview__dialog.closing{animation:slideOut .4s ease forwards}}.cart-preview__dialog::backdrop{background:rgba(0,0,0,.5);transition:opacity .4s ease}@media(min-width: 782px){:host-context([dir=rtl]) .cart-preview__dialog[open]{left:0;right:auto;border-radius:0 1rem 1rem 0;box-shadow:2px 0 8px rgba(0,0,0,.1);transform:translateX(-100%);animation:slideInRTL .4s ease forwards}:host-context([dir=rtl]) .cart-preview__dialog.closing{animation:slideOutRTL .4s ease forwards}}.cart-preview__header{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid #e0e0e0;flex-shrink:0}@media(min-width: 782px){.cart-preview__header{padding:1.5rem}}.cart-preview__title{margin:0;font-size:1.125rem;font-weight:600}@media(min-width: 782px){.cart-preview__title{font-size:1.25rem}}.cart-preview__close{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.5rem;line-height:1;padding:.5rem;color:#666;transition:color .2s ease}.cart-preview__close svg{width:1.5rem;height:1.5rem;display:block}.cart-preview__close .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__close:hover,.cart-preview__close:focus{color:#000}.cart-preview__close:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__content{flex:1;overflow-y:auto;overflow-x:hidden;padding:1rem;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;position:relative}@media(min-width: 782px){.cart-preview__content{padding:1.5rem}}.cart-preview__loading{display:flex;align-items:center;justify-content:center;padding:1.5rem;color:#666;position:fixed;top:0;left:0;right:0;bottom:0;z-index:999999;background:hsla(0,0%,100%,.5)}@media(min-width: 782px){.cart-preview__loading{padding:3rem 1.5rem}}.cart-preview__error{padding:1rem;margin-bottom:1rem;background:#fee;border:1px solid #fcc;color:#c00;display:flex;align-items:center;justify-content:space-between;gap:1rem}.cart-preview__error--dismiss{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;font-size:1.25rem;line-height:1;padding:0 .5rem}.cart-preview__empty{text-align:center;padding:1.5rem;color:#666}@media(min-width: 782px){.cart-preview__empty{padding:3rem 1.5rem}}.cart-preview__items{display:flex;flex-direction:column;gap:1rem;flex-grow:1}.cart-preview__item{display:flex;gap:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:4px;margin-bottom:1rem;flex-wrap:wrap}.cart-preview__item__message{font-style:italic;margin-top:8px;padding:6px 10px;background-color:rgba(0,115,170,.1);border-left:3px solid #0073aa;font-size:.85em;color:#666;line-height:1.5;flex-basis:100%}.cart-preview__item-image{width:60px;height:60px;object-fit:cover;border-radius:4px;flex-shrink:0}.cart-preview__item-details{flex:1;min-width:0}.cart-preview__item-name{font-weight:600;margin:0 0 .5rem 0;font-size:.9rem;overflow-wrap:break-word;word-wrap:break-word}@media(min-width: 782px){.cart-preview__item-name{font-size:.95rem}}.cart-preview__item-price{color:#666;font-size:.875rem}@media(min-width: 782px){.cart-preview__item-price{font-size:.9rem}}.cart-preview__item-quantity{margin-top:.5rem}.cart-preview__item-remove{background:rgba(0,0,0,0);border:none;cursor:pointer;padding:0;color:#999;font-size:1.25rem;line-height:1;padding:.25rem .5rem;flex-shrink:0;transition:color .2s ease;align-self:center}.cart-preview__item-remove svg{width:1.25rem;height:1.25rem;display:block}.cart-preview__item-remove .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__item-remove:hover,.cart-preview__item-remove:focus{color:#c00}.cart-preview__item-remove:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__summary{border-top:2px solid #e0e0e0;padding-top:1.5rem;margin-top:auto;display:flex;flex-direction:column;gap:1rem}.cart-preview__summary--taxes{font-size:.8rem;font-style:italic;color:#666;margin:0}.cart-preview__summary-row{display:flex;justify-content:space-between;margin:0;font-size:.9rem}@media(min-width: 782px){.cart-preview__summary-row{font-size:1rem}}.cart-preview__summary-label{font-weight:600}.cart-preview__footer{padding:1rem;border-top:1px solid #e0e0e0;display:flex;justify-content:space-between;align-items:center;gap:.75rem;flex-shrink:0}@media(min-width: 782px){.cart-preview__footer{padding:1.5rem}}.cart-preview__button{padding:.75rem 1rem;border:none;border-radius:4px;font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease;text-align:center;text-decoration:none;display:block}@media(min-width: 782px){.cart-preview__button{padding:.75rem 1.5rem;font-size:1rem}}.cart-preview__button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__button--primary{background:var(--edd-button-color, #2271b1);color:var(--edd-button-text-color, #ffffff);flex-grow:1}.cart-preview__button--primary:hover,.cart-preview__button--primary:focus{background:var(--edd-button-hover-color, #135e96)}.cart-preview__button--secondary{background:rgba(0,0,0,0);color:var(--edd-button-color, #2271b1);border:1px solid var(--edd-button-color, #2271b1)}.cart-preview__button--secondary:hover,.cart-preview__button--secondary:focus{background:#f0f0f0}.cart-preview__spinner{animation:1.5s linear infinite edd-spinning;animation-play-state:inherit;border:2px solid #f3f3f3;border-bottom-color:#666;border-radius:100%;content:"";width:20px;height:20px;transform:translate3d(-50%, -50%, 0);will-change:transform}.screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__button--trigger{position:fixed;bottom:20px;left:20px;width:60px;height:60px;border-radius:50%;background:#fff;border:none;box-shadow:0 4px 12px rgba(0,0,0,.15);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:999998;transition:all .2s ease}@media(min-width: 782px){.cart-preview__button--trigger{width:80px;height:80px}}.cart-preview__button--trigger svg{width:1.75rem;height:1.75rem;stroke:#000;color:#000}@media(min-width: 782px){.cart-preview__button--trigger svg{width:2rem;height:2rem}}.cart-preview__button--trigger:hover{box-shadow:0 6px 16px rgba(0,0,0,.2);transform:scale(1.05)}.cart-preview__button--trigger:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}:host-context([dir=rtl]) .cart-preview__button--trigger{left:auto;right:20px}.cart-preview__quantity-control{display:inline-flex;align-items:center;gap:4px;border:1px solid #e0e0e0;border-radius:4px;padding:4px}.cart-preview__quantity-button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;font-size:1rem;color:#000;border-radius:3px;transition:all .2s ease}.cart-preview__quantity-button svg{width:1rem;height:1rem}.cart-preview__quantity-button .screen-reader-text{border:0;clip-path:inset(50%);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;word-wrap:normal !important}.cart-preview__quantity-button:hover:not(:disabled){background:#f3f4f6;color:#000}.cart-preview__quantity-button:disabled{opacity:.4;cursor:not-allowed}.cart-preview__quantity-button:focus{outline:2px solid var(--edd-button-color, #2271b1);outline-offset:2px}.cart-preview__quantity-display{min-width:2ch;text-align:center;font-size:.875rem;font-weight:500;color:#000}.hidden.hidden{display:none}',""]);const s=n}},e={};function r(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return t[i](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=r(651),e=r.n(t);class i{constructor(){this.filters={},this.actions={}}addFilter(t,e,r=10){this.filters[t]||(this.filters[t]=[]),this.filters[t].push({callback:e,priority:r}),this.filters[t].sort(((t,e)=>t.priority-e.priority))}applyFilters(t,e,...r){return this.filters[t]?this.filters[t].reduce(((t,{callback:e})=>e(t,...r)),e):e}addAction(t,e,r=10){this.actions[t]||(this.actions[t]=[]),this.actions[t].push({callback:e,priority:r}),this.actions[t].sort(((t,e)=>t.priority-e.priority))}doAction(t,...e){if(this.actions[t])for(const{callback:r}of this.actions[t])r(...e)}removeFilter(t,e){if(!this.filters[t])return!1;const r=this.filters[t].length;return this.filters[t]=this.filters[t].filter((t=>t.callback!==e)),this.filters[t].length<r}removeAction(t,e){if(!this.actions[t])return!1;const r=this.actions[t].length;return this.actions[t]=this.actions[t].filter((t=>t.callback!==e)),this.actions[t].length<r}getFilters(t){return t?this.filters[t]||[]:this.filters}getActions(t){return t?this.actions[t]||[]:this.actions}clear(){this.filters={},this.actions={}}clearHook(t,e){e&&"filter"!==e||delete this.filters[t],e&&"action"!==e||delete this.actions[t]}hasHook(t,e){return"filter"===e?!!this.filters[t]&&this.filters[t].length>0:"action"===e?!!this.actions[t]&&this.actions[t].length>0:this.filters[t]&&this.filters[t].length>0||this.actions[t]&&this.actions[t].length>0}}const o=t=>n[t]||"",a=(t=document)=>{const e=t.querySelectorAll("[data-edd-icon]");let r=0;for(const t of e){const e=t.dataset.eddIcon;if(!e)continue;const i=o(e);i&&(t.innerHTML=i,r++)}return r},n={cart:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />\n\t</svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />\n\t</svg>',"x-mark":'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">\n\t\t<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />\n\t</svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />\n\t</svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">\n\t\t<path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" />\n\t</svg>'};var s=r(1669);class d{constructor(t){this.config=t,this.hooks=new i,this.state={isOpen:!1,isLoading:!1,items:[],subtotal:"0.00",hasItems:!1,itemCount:0,error:null,token:t.token||""},this.fetchController=null,this.operationController=null,this.open=this.open.bind(this),this.close=this.close.bind(this),this.toggle=this.toggle.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.init()}init(){this.createShadowDOM(),this.attachEventListeners(),this.setupGlobalAPI(),this.setupEDDIntegration(),this.fetchCartContents()}createShadowDOM(){this.hostElement=document.createElement("edd-cart-preview"),document.body.appendChild(this.hostElement),this.shadow=this.hostElement.attachShadow({mode:"open"}),this.injectStyles(),this.render(),this.createFloatingButton()}injectStyles(){const t=document.createElement("style");t.textContent=this.generateCSSVariables()+e(),this.shadow.appendChild(t)}generateCSSVariables(){const t=this.config.buttonColors||{};return`\n\t\t\t:host {\n\t\t\t\t--edd-button-color: ${t.buttonColor||"#2271b1"};\n\t\t\t\t--edd-button-hover-color: ${t.buttonHoverColor||"#135e96"};\n\t\t\t\t--edd-button-text-color: ${t.buttonTextColor||"#ffffff"};\n\t\t\t}\n\t\t`}render(){const t=document.getElementById("edd-cart-preview-dialog-template");if(!t)return void console.error("EDD Cart Preview: Dialog template not found. Ensure dialog.php is loaded.");const e=document.importNode(t.content,!0);this.shadow.appendChild(e);const r=document.getElementById("edd-cart-preview-item-template");r?this.itemTemplate=r:this.log("EDD Cart Preview: Item template not found."),this.cacheElements(),a(this.shadow)}createFloatingButton(){if("none"===this.config.buttonSize)return;const t=document.createElement("button");t.className=`cart-preview__button--trigger cart-preview__button--trigger--${this.config.buttonSize}`,this.config.buttonPosition&&(t.className+=` cart-preview__button--trigger--${this.config.buttonPosition}`),t.setAttribute("aria-label","Open cart"),t.setAttribute("part","cart-preview-button-trigger"),t.innerHTML=o("cart"),t.addEventListener("click",this.open),this.shadow.appendChild(t),this.elements.floatingButton=t}cacheElements(){this.elements={dialog:this.shadow.querySelector(".cart-preview__dialog"),closeBtn:this.shadow.querySelector(".cart-preview__close"),continueBtn:this.shadow.querySelector(".cart-preview__continue"),loading:this.shadow.querySelector(".cart-preview__loading"),error:this.shadow.querySelector(".cart-preview__error"),errorMessage:this.shadow.querySelector(".cart-preview__error--message"),errorDismiss:this.shadow.querySelector(".cart-preview__error--dismiss"),empty:this.shadow.querySelector(".cart-preview__empty"),items:this.shadow.querySelector(".cart-preview__items"),itemsList:this.shadow.querySelector(".cart-preview__items-list"),summaryValue:this.shadow.querySelector(".cart-preview__summary-value"),footer:this.shadow.querySelector(".cart-preview__footer")}}attachEventListeners(){this.elements.closeBtn.addEventListener("click",this.close),this.elements.continueBtn.addEventListener("click",this.close),this.elements.dialog.addEventListener("close",(()=>{this.state.isOpen=!1,document.body.style.overflow="",document.dispatchEvent(new CustomEvent("edd:cart-preview:closed"))})),this.elements.dialog.addEventListener("click",this.handleBackdropClick),this.elements.errorDismiss.addEventListener("click",(()=>this.clearError()))}setupGlobalAPI(){globalThis.eddSlideoutCart={open:this.open,close:this.close,toggle:this.toggle,refresh:()=>this.fetchCartContents(),getState:()=>({...this.state}),hooks:this.hooks},document.dispatchEvent(new CustomEvent("edd:cart-preview:ready",{detail:{api:globalThis.eddSlideoutCart}}))}setupEDDIntegration(){const t=()=>{if(void 0===s)return;const t=s;t(document.body).on("edd_cart_item_added",(async(t,e)=>{this.log("EDD Cart: Item added",e),await this.fetchCartContents(),this.config.autoOpenOnAdd&&this.open()})),t(document.body).on("edd_cart_item_removed",(async(t,e)=>{this.log("EDD Cart: Item removed",e),await this.fetchCartContents()})),t(document.body).on("edd_quantity_updated",(async(t,e)=>{this.log("EDD Cart: Quantity updated",e),await this.fetchCartContents()}))};if(void 0!==s)t();else{const e=setInterval((()=>{void 0!==s&&(clearInterval(e),t())}),100);setTimeout((()=>clearInterval(e)),5e3)}}open(){this.state.isOpen=!0,this.elements.dialog.showModal(),document.body.style.overflow="hidden",document.dispatchEvent(new CustomEvent("edd:cart-preview:opened"))}close(){this.elements.dialog.classList.add("closing"),setTimeout((()=>{this.elements.dialog.close(),this.elements.dialog.classList.remove("closing")}),400)}toggle(){this.state.isOpen?this.close():this.open()}handleBackdropClick(t){if(t.target===this.elements.dialog){const e=this.elements.dialog.getBoundingClientRect();t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom||this.close()}}updateUI(){this.log("EDD Cart Preview: Updating UI",{hasItems:this.state.hasItems,itemCount:this.state.items.length,isLoading:this.state.isLoading}),this.elements.loading.classList.toggle("hidden",!this.state.isLoading),this.elements.empty.classList.toggle("hidden",this.state.hasItems),this.elements.items.classList.toggle("hidden",!this.state.hasItems),this.elements.footer.classList.toggle("hidden",!this.state.hasItems),this.elements.floatingButton&&this.elements.floatingButton.classList.toggle("hidden",!this.state.hasItems),this.state.hasItems&&(this.log("EDD Cart Preview: Rendering items",this.state.items),this.renderItems(),this.elements.summaryValue.innerHTML=this.state.subtotal)}renderItems(){if(this.elements.itemsList.innerHTML="",this.itemTemplate){this.hooks.doAction("beforeRenderItems");for(const t of this.state.items){const e=this.hooks.applyFilters("cartItemData",t),r=this.createItemElement(e);this.elements.itemsList.appendChild(r);const i=this.elements.itemsList.querySelector(`[data-cart-key="${t.key}"]`);i&&this.hooks.doAction("itemRendered",i,e)}this.hooks.doAction("afterRenderItems")}else console.error("EDD Cart Preview: Item template not available.")}createItemElement(t){const e=document.importNode(this.itemTemplate.content,!0),r=e.querySelector(".cart-preview__item"),i=e.querySelector(".cart-preview__item-image"),o=e.querySelector(".cart-preview__item-name"),n=e.querySelector(".cart-preview__item-price"),s=e.querySelector(".cart-preview__item-remove"),d=e.querySelector(".cart-preview__item-quantity"),l=e.querySelector(".cart-preview__quantity-control"),c=e.querySelector(".cart-preview__quantity-display"),h=e.querySelector(".cart-preview__quantity-button--minus"),p=e.querySelector(".cart-preview__quantity-button--plus");r.dataset.cartKey=t.key,t.thumbnail&&(i.src=t.thumbnail,i.alt=t.name,i.style.display=""),o.textContent=t.name,n.innerHTML=t.price,t.quantities_enabled&&(d.style.display="",l.dataset.cartKey=t.key,c.textContent=t.quantity,h.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);r>1&&this.updateQuantity(e,r-1)})),p.addEventListener("click",(t=>{const e=Number.parseInt(l.dataset.cartKey),r=Number.parseInt(c.textContent);this.updateQuantity(e,r+1)})),t.quantity<=1&&(h.disabled=!0)),s.dataset.cartKey=t.key;const m=(s.dataset.labelTemplate||"Remove %s from cart").replace("%s",t.name);return s.setAttribute("aria-label",m),s.addEventListener("click",(t=>{const e=Number.parseInt(t.currentTarget.dataset.cartKey);this.removeItem(e)})),a(e),e}showError(t){this.state.error=t,this.elements.errorMessage.textContent=t,this.elements.error.classList.remove("hidden")}clearError(){this.state.error=null,this.elements.error.classList.add("hidden")}async fetchCartContents(){this.fetchController&&this.fetchController.abort(),this.fetchController=new AbortController,this.state.isLoading=!0,this.updateUI();try{const t=await fetch(`${this.config.apiBase}/contents`,{method:"GET",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},signal:this.fetchController.signal});if(!t.ok)throw new Error("Failed to fetch cart contents");const e=await t.json();this.log("EDD Cart Preview: Fetched cart data",e),this.updateStateFromResponse(e)}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Fetch aborted (newer request started)");console.error("EDD Cart Preview: Fetch failed",t),this.showError(this.config.i18n.failedCartContents)}finally{this.state.isLoading=!1,this.fetchController=null,this.updateUI()}}async removeItem(t){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const e=await fetch(`${this.config.apiBase}/remove`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t}),signal:this.operationController.signal});if(!e.ok)throw new Error("Failed to remove item");const r=await e.json();this.updateStateFromResponse(r),r.download_id&&this.updatePurchaseForm(r.download_id),document.dispatchEvent(new CustomEvent("edd:cart-item-removed",{detail:{cartKey:t,downloadId:r.download_id,data:r}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Remove operation aborted (newer operation started)");console.error("EDD Cart Preview: Remove failed",t),this.showError(this.config.i18n.failedRemoveItem)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updatePurchaseForm(t){const e=document.querySelector(`#edd_purchase_${t}`);if(!e)return;const r=e.querySelector("button.edd-add-to-cart.edd-has-js"),i=e.querySelector("a.edd_go_to_checkout"),o=e.querySelector(".edd_price_options");r&&(r.style.display="",r.removeAttribute("data-edd-loading")),i&&(i.style.display="none"),o&&(o.style.display=""),this.log(`EDD Cart Preview: Updated purchase form for download ${t}`)}async updateQuantity(t,e){this.operationController&&this.operationController.abort(),this.operationController=new AbortController,this.state.isLoading=!0,this.clearError(),this.updateUI();try{const r=await fetch(`${this.config.apiBase}/update-quantity`,{method:"POST",headers:{"Content-Type":"application/json","X-EDD-Cart-Token":this.state.token,"X-EDD-Cart-Timestamp":this.config.timestamp},body:JSON.stringify({cart_key:t,quantity:e}),signal:this.operationController.signal});if(!r.ok)throw new Error("Failed to update quantity");const i=await r.json();this.updateStateFromResponse(i),document.dispatchEvent(new CustomEvent("edd:cart-quantity-updated",{detail:{cartKey:t,quantity:e,data:i}}))}catch(t){if("AbortError"===t.name)return void this.log("EDD Cart Preview: Update quantity aborted (newer operation started)");console.error("EDD Cart Preview: Update quantity failed",t),this.showError(this.config.i18n.failedUpdateQuantity)}finally{this.state.isLoading=!1,this.operationController=null,this.updateUI()}}updateStateFromResponse(t){this.log("EDD Cart Preview: Updating state from response",t);const e=t.cart||t;this.state.items=e.items||[],this.state.subtotal=e.subtotal||"0.00",this.state.hasItems=e.has_items||!1,this.state.itemCount=e.item_count||0,t.token&&(this.state.token=t.token,t.timestamp&&(this.config.timestamp=t.timestamp)),this.log("EDD Cart Preview: New state",this.state)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}log(t){this.config.debug&&console.log(t)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})):globalThis.eddCartPreviewConfig&&new d(globalThis.eddCartPreviewConfig)})()})();
>>>>>>> Stashed changes
>>>>>>> issue/2050
