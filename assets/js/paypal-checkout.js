(()=>{"use strict";var e={1669:e=>{e.exports=jQuery}},t={};function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=a(1669),r={isMounted:!1,init:function(){document.getElementById("edd-paypal-container")&&this.initButtons("#edd-paypal-container","checkout"),n(document.body).on("edd_discount_applied",this.maybeRefreshPage),n(document.body).on("edd_discount_removed",this.maybeRefreshPage)},isPayPal:function(){return!!document.getElementById("edd-paypal-container")},maybeRefreshPage:function(e,t){r.isPayPal()&&(!r.isMounted&&t.total_plain>0&&window.location.reload(),0==parseFloat(t.total_plain)&&window.location.reload())},setErrorHtml:function(e,t,a){if("checkout"===t&&"undefined"!=typeof edd_global_vars&&edd_global_vars.checkout_error_anchor)(r=document.getElementById("edd-paypal-errors-wrap"))&&(r.innerHTML=a);else if("buy_now"===t){var r,o=e.closest(".edd_download_purchase_form");(r=!!o&&o.querySelector(".edd-paypal-checkout-buy-now-error-wrapper"))&&(r.innerHTML=a)}n(document.body).trigger("edd_checkout_error",[a])},initButtons:function(e,t){r.isMounted=!0,paypal.Buttons(r.getButtonArgs(e,t)).render(e),document.dispatchEvent(new CustomEvent("edd_paypal_buttons_mounted"))},getButtonArgs:function(e,t){var a="checkout"===t?document.getElementById("edd_purchase_form"):e.closest(".edd_download_purchase_form"),o="checkout"===t?a.querySelector("#edd-paypal-errors-wrap"):a.querySelector(".edd-paypal-checkout-buy-now-error-wrapper"),d="checkout"===t?document.getElementById("edd-paypal-spinner"):a.querySelector(".edd-paypal-spinner"),c=a.querySelector('input[name="edd_process_paypal_nonce"]'),i=a.querySelector('input[name="edd-process-paypal-token"]'),s="subscription"===eddPayPalVars.intent?"createSubscription":"createOrder",u=a.querySelectorAll("[required]"),l={onInit:function(e,t){t.disable(),a.checkValidity()&&t.enable(),u.forEach((function(e){e.addEventListener("change",(function(e){a.checkValidity()?t.enable():t.disable()}))}))},onClick:function(e,n){return!!a.reportValidity()&&(d.style.display="block",o&&(o.innerHTML=""),fetch(edd_scripts.ajaxurl,{method:"POST",body:new FormData(a)}).then((function(e){return e.json()})).then((function(e){if(!e.success){var a=eddPayPalVars.defaultError;return e.data&&"string"==typeof e.data?a=e.data:"string"==typeof e&&(a=e),d.style.display="none",r.setErrorHtml(o,t,a),!1}})))},onApprove:function(a,n){var o=new FormData;return o.append("action",eddPayPalVars.approvalAction),o.append("edd_process_paypal_nonce",c.value),o.append("token",i.getAttribute("data-token")),o.append("timestamp",i.getAttribute("data-timestamp")),a.orderID&&o.append("paypal_order_id",a.orderID),a.subscriptionID&&o.append("paypal_subscription_id",a.subscriptionID),fetch(edd_scripts.ajaxurl,{method:"POST",body:o}).then((function(e){return e.json()})).then((function(a){if(a.success&&a.data.redirect_url)window.location=a.data.redirect_url;else{d.style.display="none";var o=a.data.message?a.data.message:eddPayPalVars.defaultError;if(r.setErrorHtml(e,t,o),a.data.retry)return n.restart()}}))},onError:function(a){d.style.display="none",r.setErrorHtml(e,t,a)},onCancel:function(e){d.style.display="none";const t=new FormData;return t.append("action","edd_cancel_paypal_order"),fetch(edd_scripts.ajaxurl,{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){if(e.success){const t=e.data.nonces;Object.keys(t).forEach((function(e){var a=document.getElementById("edd-gateway-"+e);a&&a.setAttribute("data-"+e+"-nonce",t[e])}))}}))}};return eddPayPalVars.style&&(l.style=eddPayPalVars.style),l[s]=function(e,t){return d.style.display="block",o&&(o.innerHTML=""),fetch(edd_scripts.ajaxurl,{method:"POST",body:new FormData(a)}).then((function(e){return e.json()})).then((function(e){if(e.data&&e.data.paypal_order_id)return e.data.nonce&&(c.value=e.data.nonce),e.data.token&&(n(i).attr("data-token",e.data.token),n(i).attr("data-timestamp",e.data.timestamp)),e.data.paypal_order_id;var t=eddPayPalVars.defaultError;return e.data&&"string"==typeof e.data?t=e.data:"string"==typeof e&&(t=e),new Promise((function(e,a){a(t)}))}))},l}};n(document.body).on("edd_gateway_loaded",(function(e,t){"paypal_commerce"===t&&r.init()})),n(document).ready((function(e){!function(){for(var e=document.querySelectorAll(".edd-paypal-checkout-buy-now"),t=0;t<e.length;t++){var a=e[t];if(!a.classList.contains("edd-free-download")){var n=a.closest(".edd_purchase_submit_wrapper");if(n&&"add_to_cart"!==a.closest("form").querySelector(".edd_action_input").value){n.innerHTML="";var o=document.createElement("div");o.classList.add("edd-paypal-checkout-buy-now-error-wrapper"),n.before(o);var d=document.createElement("span");d.classList.add("edd-paypal-spinner","edd-loading-ajax","edd-loading"),d.style.display="none",n.after(d),r.initButtons(n,"buy_now")}}}}()}))})();