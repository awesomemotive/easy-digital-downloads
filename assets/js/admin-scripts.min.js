function edd_attach_tooltips(e){e.tooltip({content:function(){return jQuery(this).prop("title")},tooltipClass:"edd-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})}jQuery(document).ready(function(e){var t=e(".edd-help-tip");edd_attach_tooltips(t);var d={init:function(){this.add(),this.move(),this.remove(),this.type(),this.prices(),this.files(),this.updatePrices()},clone_repeatable:function(t){var d=highest=1;return t.parent().find(".edd_repeatable_row").each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),d=highest+=1,clone=t.clone(),clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())}),clone.removeClass("edd_add_blank"),clone.attr("data-key",d),clone.find("input, select, textarea").val("").each(function(){var t=e(this).attr("name"),a=e(this).attr("id");t&&(t=t.replace(/\[(\d+)\]/,"["+parseInt(d)+"]"),e(this).attr("name",t)),e(this).attr("data-key",d),"undefined"!=typeof a&&(a=a.replace(/(\d+)/,parseInt(d)),e(this).attr("id",a))}),clone.find("span.edd_price_id").each(function(){e(this).text(parseInt(d))}),clone.find("span.edd_file_id").each(function(){e(this).text(parseInt(d))}),clone.find(".edd_repeatable_default_input").each(function(){e(this).val(parseInt(d)).removeAttr("checked")}),clone.find(".edd_repeatable_condition_field").each(function(){e(this).find("option:eq(0)").prop("selected","selected")}),clone.find(".search-choice").remove(),clone.find(".chosen-container").remove(),edd_attach_tooltips(clone.find(".edd-help-tip")),clone},add:function(){e(document.body).on("click",".submit .edd_add_repeatable",function(t){t.preventDefault();var a=e(this),n=a.parent().parent().prev(".edd_repeatable_row"),i=d.clone_repeatable(n);i.insertAfter(n).find("input, textarea, select").filter(":visible").eq(0).focus(),i.find(".edd-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option}),i.find(".edd-select-chosen").css("width","100%"),i.find(".edd-select-chosen .chosen-search input").attr("placeholder",edd_vars.search_placeholder)})},move:function(){e(".edd_repeatable_table .edd-repeatables-wrap").sortable({handle:".edd-draghandle-anchor",items:".edd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;e(this).find(".edd_repeatable_row").each(function(){e(this).find("input.edd_repeatable_index").each(function(){e(this).val(t)}),t++})}})},remove:function(){e(document.body).on("click",".edd-remove-row, .edd_remove_repeatable",function(t){t.preventDefault();var d,a,n,i=e(this).parents(".edd_repeatable_row"),o=i.parent().find(".edd_repeatable_row").length,r=e(this).data("type"),s="div.edd_repeatable_"+r+"s";if(d=e(this).is(".ui-sortable .edd_repeatable_row:first-child .edd-remove-row, .ui-sortable .edd_repeatable_row:first-child .edd_remove_repeatable")?i.next(".edd_repeatable_row"):i.prev(".edd_repeatable_row"),a=d.find("select, input, textarea, button").filter(":visible"),n=a.eq(0),"price"===r){var c=i.data("key");e('.edd_repeatable_condition_field option[value="'+c+'"]').remove()}if(o>1)e("input, select",i).val(""),i.fadeOut("fast").remove(),n.focus();else switch(r){case"price":alert(edd_vars.one_price_min);break;case"file":e("input, select",i).val("");break;default:alert(edd_vars.one_field_min)}e(s).each(function(t){e(this).find("input, select").each(function(){var d=e(this).attr("name");d=d.replace(/\[(\d+)\]/,"["+t+"]"),e(this).attr("name",d).attr("id",d)})})})},type:function(){e(document.body).on("change","#_edd_product_type",function(t){var d=e("#edd_products"),a=e("#edd_download_files"),n=e("#edd_download_limit_wrap");"bundle"===e(this).val()?(d.show(),a.hide(),n.hide()):(d.hide(),a.show(),n.show())})},prices:function(){e(document.body).on("change","#edd_variable_pricing",function(t){var d=e(this).is(":checked"),a=e("#edd_regular_price_field"),n=e("#edd_variable_price_fields, .edd_repeatable_table .pricing"),i=e(".edd-bundled-product-row, .edd-repeatable-row-standard-fields");d?(a.hide(),n.show(),i.addClass("has-variable-pricing")):(a.show(),n.hide(),i.removeClass("has-variable-pricing"))})},files:function(){var t;window.formfield="",e(document.body).on("click",".edd_upload_file_button",function(a){a.preventDefault();var n=e(this);return window.formfield=e(this).closest(".edd_repeatable_upload_wrapper"),t?void t.open():(t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:n.data("uploader-title"),button:{text:n.data("uploader-button-text")},multiple:"0"==e(this).data("multiple")?!1:!0}),t.on("menu:render:default",function(e){var t={};e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set(t)}),t.on("insert",function(){var a=t.state().get("selection");a.each(function(t,a){t=t.toJSON();var n="image"===t.type?e(".attachment-display-settings .size option:selected").val():!1,i=t.url,o=t.title.length>0?t.title:t.filename;if(n&&"undefined"!=typeof t.sizes[n]&&(i=t.sizes[n].url),"image"===t.type&&(o=n&&"undefined"!=typeof t.sizes[n]?o+"-"+t.sizes[n].width+"x"+t.sizes[n].height:o+"-"+t.width+"x"+t.height),0===a)window.formfield.find(".edd_repeatable_attachment_id_field").val(t.id),window.formfield.find(".edd_repeatable_thumbnail_size_field").val(n),window.formfield.find(".edd_repeatable_upload_field").val(i),window.formfield.find(".edd_repeatable_name_field").val(o);else{var r=window.formfield,s=d.clone_repeatable(r);s.find(".edd_repeatable_attachment_id_field").val(t.id),s.find(".edd_repeatable_thumbnail_size_field").val(n),s.find(".edd_repeatable_upload_field").val(i),s.find(".edd_repeatable_name_field").val(o),s.insertAfter(r)}})}),void t.open())});var t;window.formfield=""},updatePrices:function(){e("#edd_price_fields").on("keyup",".edd_variable_prices_name",function(){var t=e(this).parents(".edd_repeatable_row").data("key"),d=e(this).val(),a=e(".edd_repeatable_condition_field option[value="+t+"]");a.length>0?a.text(d):e(".edd_repeatable_condition_field").append(e("<option></option>").attr("value",t).text(d))})}};e(document.body).on("click",".toggle-custom-price-option-section",function(t){t.preventDefault();var d=e(this).html()==edd_vars.show_advanced_settings?!0:!1;d?e(this).html(edd_vars.hide_advanced_settings):e(this).html(edd_vars.show_advanced_settings);var a=e(this).parents(".edd-repeatable-row-header");a.siblings(".edd-custom-price-option-sections-wrap").slideToggle();var n;n=d?e(":input:not(input[type=button],input[type=submit],button):visible:first",a.siblings(".edd-custom-price-option-sections-wrap")):e(":input:not(input[type=button],input[type=submit],button):visible:first",a.siblings(".edd-repeatable-row-standard-fields")),n.focus()}),d.init();var a=e(".edd_datepicker");if(a.length>0){var n="mm/dd/yy";a.datepicker({dateFormat:n})}var i={init:function(){this.edit_address(),this.remove_download(),this.add_download(),this.change_customer(),this.new_customer(),this.edit_price(),this.recalculate_total(),this.variable_prices_check(),this.add_note(),this.remove_note(),this.resend_receipt(),this.copy_download_link()},edit_address:function(){e('select[name="edd-payment-address[0][country]"]').change(function(){var t=e(this),d={action:"edd_get_shop_states",country:t.val(),field_name:"edd-payment-address[0][state]"};return e.post(ajaxurl,d,function(t){var d=e("#edd-order-address-state-wrap select, #edd-order-address-state-wrap input");e("#edd-order-address-state-wrap .chosen-container").remove(),"nostates"==t?d.replaceWith('<input type="text" name="edd-payment-address[0][state]" value="" class="edd-edit-toggles medium-text"/>'):d.replaceWith(t)}),!1})},remove_download:function(){e("#edd-purchased-files").on("click",".edd-order-remove-download",function(){var t=e(document.body).find("#edd-purchased-files > .row:not(.header)").length;if(1===t)return alert(edd_vars.one_download_min),!1;if(confirm(edd_vars.delete_payment_download)){var d=e(this).data("key"),a=(e(".edd-payment-id").val(),e('input[name="edd-payment-details-downloads['+d+'][id]"]').val()),n=e('input[name="edd-payment-details-downloads['+d+'][price_id]"]').val(),i=e('input[name="edd-payment-details-downloads['+d+'][quantity]"]').val(),o=e('input[name="edd-payment-details-downloads['+d+'][amount]"]').val();if(e('input[name="edd-payment-details-downloads['+d+'][tax]"]'))var r=e('input[name="edd-payment-details-downloads['+d+'][tax]"]').val();if(e('input[name="edd-payment-details-downloads['+d+'][fees]"]'))var r=e.parseJSON(e('input[name="edd-payment-details-downloads['+d+'][fees]"]').val());var s=e('input[name="edd-payment-removed"]').val();s=e.parseJSON(s),s.length<1&&(s={});var c=[{id:a,price_id:n,quantity:i,amount:o,cart_index:d}];s[d]=c,e('input[name="edd-payment-removed"]').val(JSON.stringify(s)),e(this).parent().parent().remove(),r&&r.length&&e.each(r,function(t,d){e('*li[data-fee-id="'+d+'"]').remove()}),e("#edd-payment-downloads-changed").val(1),e(".edd-order-payment-recalc-totals").show()}return!1})},change_customer:function(){e("#edd-customer-details").on("click",".edd-payment-change-customer, .edd-payment-change-customer-cancel",function(t){t.preventDefault();var d=e(this).hasClass("edd-payment-change-customer"),a=e(this).hasClass("edd-payment-change-customer-cancel");d?(e(".customer-info").hide(),e(".change-customer").show(),e(".edd-payment-change-customer-input").css("width","auto")):a&&(e(".customer-info").show(),e(".change-customer").hide())})},new_customer:function(){e("#edd-customer-details").on("click",".edd-payment-new-customer, .edd-payment-new-customer-cancel",function(t){t.preventDefault();var d=e(this).hasClass("edd-payment-new-customer"),a=e(this).hasClass("edd-payment-new-customer-cancel");d?(e(".customer-info").hide(),e(".new-customer").show()):a&&(e(".customer-info").show(),e(".new-customer").hide());var d=e("#edd-new-customer");e(".new-customer").is(":visible")?d.val(1):d.val(0)})},add_download:function(){e(".edd-edit-purchase-element").on("click","#edd-order-add-download",function(t){t.preventDefault();var d=e("#edd_order_download_select"),a=e("#edd-order-download-quantity"),n=e("#edd-order-download-price"),i=e("#edd-order-download-tax"),o=e(".edd_price_options_select option:selected"),r=d.val(),s=d.find(":selected").text(),c=a.val(),l=n.val(),p=i.val(),u=o.val(),_=o.text();if(1>r)return!1;if(l||(l=0),l=parseFloat(l),isNaN(l))return alert(edd_vars.numeric_item_price),!1;if(p=parseFloat(p),isNaN(p))return alert(edd_vars.numeric_item_tax),!1;if(isNaN(parseInt(c)))return alert(edd_vars.numeric_quantity),!1;_&&(s=s+" - "+_);var m=e("#edd-purchased-files div.row").length,f=e("#edd-purchased-files div.row:last").clone();f.find(".download span").html('<a href="post.php?post='+r+'&action=edit"></a>'),f.find(".download span a").text(s),f.find(".edd-payment-details-download-item-price").val(l.toFixed(edd_vars.currency_decimals)),f.find(".edd-payment-details-download-item-tax").val(p.toFixed(edd_vars.currency_decimals)),f.find("input.edd-payment-details-download-id").val(r),f.find("input.edd-payment-details-download-price-id").val(u);var h=l*c+p;h=h.toFixed(edd_vars.currency_decimals),f.find("span.edd-payment-details-download-amount").text(h),f.find("input.edd-payment-details-download-amount").val(h),f.find("input.edd-payment-details-download-quantity").val(c),f.find("input.edd-payment-details-download-has-log").val(0),f.find(".edd-copy-download-link-wrapper").remove(),f.find("input").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(m)+"]"),e(this).attr("name",t).attr("id",t)}),f.find("a.edd-order-remove-download").attr("data-key",parseInt(m)),e("#edd-payment-downloads-changed").val(1),e(f).insertAfter("#edd-purchased-files div.row:last"),e(".edd-order-payment-recalc-totals").show(),e(".edd-add-download-field").val("")})},edit_price:function(){e(document.body).on("change keyup",".edd-payment-item-input",function(){var t=e(this).parents("ul.edd-purchased-files-list-wrapper");e(".edd-order-payment-recalc-totals").show();var d=t.find("input.edd-payment-details-download-quantity").val().replace(edd_vars.thousands_separator,""),a=t.find("input.edd-payment-details-download-item-price").val().replace(edd_vars.thousands_separator,""),n=t.find("input.edd-payment-details-download-item-tax").val().replace(edd_vars.thousands_separator,"");if(a=parseFloat(a),isNaN(a))return alert(edd_vars.numeric_item_price),!1;n=parseFloat(n),isNaN(n)&&(n=0),isNaN(parseInt(d))&&(d=1);var i=a*d+n;i=i.toFixed(edd_vars.currency_decimals),t.find("input.edd-payment-details-download-amount").val(i),t.find("span.edd-payment-details-download-amount").text(i)})},recalculate_total:function(){e("#edd-order-recalc-total").on("click",function(t){t.preventDefault();var d=0,a=0,n=e("#edd-purchased-files .row input.edd-payment-details-download-amount"),i=e("#edd-purchased-files .row input.edd-payment-details-download-item-tax");n.length&&n.each(function(){d+=parseFloat(e(this).val())}),i.length&&i.each(function(){a+=parseFloat(e(this).val())}),e(".edd-payment-fees").length&&e(".edd-payment-fees span.fee-amount").each(function(){d+=parseFloat(e(this).data("fee"))}),e("input[name=edd-payment-total]").val(d.toFixed(edd_vars.currency_decimals)),e("input[name=edd-payment-tax]").val(a.toFixed(edd_vars.currency_decimals))})},variable_prices_check:function(){e(".edd-edit-purchase-element").on("change","select#edd_order_download_select",function(){var t=e(this),d=t.val();if(parseInt(d)>0){var a={action:"edd_check_for_download_price_variations",download_id:d};e.ajax({type:"POST",data:a,url:ajaxurl,success:function(d){e(".edd_price_options_select").remove(),e(d).insertAfter(t.next())}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}})},add_note:function(){e("#edd-add-payment-note").on("click",function(t){t.preventDefault();var d={action:"edd_insert_payment_note",payment_id:e(this).data("payment-id"),note:e("#edd-payment-note").val()};if(d.note)e.ajax({type:"POST",data:d,url:ajaxurl,success:function(t){e("#edd-payment-notes-inner").append(t),e(".edd-no-payment-notes").hide(),e("#edd-payment-note").val("")}}).fail(function(e){window.console&&window.console.log&&console.log(e)});else{var a=e("#edd-payment-note").css("border-color");e("#edd-payment-note").css("border-color","red"),setTimeout(function(){e("#edd-payment-note").css("border-color",a)},500)}})},remove_note:function(){e(document.body).on("click",".edd-delete-payment-note",function(t){if(t.preventDefault(),confirm(edd_vars.delete_payment_note)){var d={action:"edd_delete_payment_note",payment_id:e(this).data("payment-id"),note_id:e(this).data("note-id")};return e.ajax({type:"POST",data:d,url:ajaxurl,success:function(t){return e("#edd-payment-note-"+d.note_id).remove(),e(".edd-payment-note").length||e(".edd-no-payment-notes").show(),!1}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!0}})},resend_receipt:function(){var t=e(".edd-order-resend-receipt-addresses");e(document.body).on("click","#edd-select-receipt-email",function(e){e.preventDefault(),t.slideDown()}),e(document.body).on("change",".edd-order-resend-receipt-email",function(){var t=e("#edd-select-receipt-email").prop("href")+"&email="+e(this).val();confirm(edd_vars.resend_receipt)&&(window.location=t)}),e(document.body).on("click","#edd-resend-receipt",function(e){return confirm(edd_vars.resend_receipt)})},copy_download_link:function(){e(document.body).on("click",".edd-copy-download-link",function(t){t.preventDefault();var d=e(this),a={action:"edd_get_file_download_link",payment_id:e('input[name="edd_payment_id"]').val(),download_id:d.data("download-id"),price_id:d.data("price-id")};e.ajax({type:"POST",data:a,url:ajaxurl,success:function(t){return e("#edd-download-link").dialog({width:400}).html('<textarea rows="10" cols="40" id="edd-download-link-textarea">'+t+"</textarea>"),e("#edd-download-link-textarea").focus().select(),!1}}).fail(function(e){window.console&&window.console.log&&console.log(e)})})}};i.init();var o={init:function(){this.type_select(),this.product_requirements()},type_select:function(){e("#edd-edit-discount #edd-type, #edd-add-discount #edd-type").change(function(){var t=e(this).val();e(".edd-amount-description").hide(),e(".edd-amount-description."+t+"-discount").show()})},product_requirements:function(){e("#products").change(function(){var t=e("#edd-discount-product-conditions");e(this).val()?t.show():t.hide()})}};o.init();var r={init:function(){this.date_options(),this.customers_export()},date_options:function(){e("#edd-graphs-date-options").change(function(){var t=e(this),d=e("#edd-date-range-options");"other"===t.val()?d.show():d.hide()})},customers_export:function(){e("#edd_customer_export_download").change(function(){var t=e(this),d=e("option:selected",t).val(),a=e("#edd_customer_export_option");if("0"===t.val()?a.show():a.hide(),0!=parseInt(d)){var n={action:"edd_check_for_download_price_variations",download_id:d,all_prices:!0},i=e(".edd_price_options_select");e.post(ajaxurl,n,function(t){i.remove(),e("#edd_customer_export_download_chosen").after(t)})}else i.remove()})}};r.init();var s={init:function(){this.general(),this.taxes(),this.emails(),this.misc()},general:function(){var t=e(".edd-color-picker");if(t.length&&t.wpColorPicker(),"undefined"==typeof wp||"1"!==edd_vars.new_media_ui){var d=e(".edd_settings_upload_button");d.length>0&&(window.formfield="",e(document.body).on("click",d,function(t){t.preventDefault(),window.formfield=e(this).parent().prev(),window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3),tb_show(edd_vars.add_new_download,"media-upload.php?TB_iframe=true")}),window.edd_send_to_editor=window.send_to_editor,window.send_to_editor=function(t){window.formfield?(imgurl=e("a","<div>"+t+"</div>").attr("href"),window.formfield.val(imgurl),window.clearInterval(window.tbframe_interval),tb_remove()):window.edd_send_to_editor(t),window.send_to_editor=window.edd_send_to_editor,window.formfield="",window.imagefield=!1})}else{var a;window.formfield="",e(document.body).on("click",".edd_settings_upload_button",function(t){t.preventDefault();var d=e(this);return window.formfield=e(this).parent().prev(),a?void a.open():(a=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:d.data("uploader_title"),button:{text:d.data("uploader_button_text")},multiple:!1}),a.on("menu:render:default",function(e){var t={};e.unset("library-separator"),e.unset("gallery"),e.unset("featured-image"),e.unset("embed"),e.set(t)}),a.on("insert",function(){var e=a.state().get("selection");e.each(function(e,t){e=e.toJSON(),window.formfield.val(e.url)})}),void a.open())});var a;window.formfield=""}},taxes:function(){var t=e("select.edd-no-states");t.length&&t.closest("tr").addClass("hidden"),e('select[name="edd_settings[base_country]"]').change(function(){var t=e(this),d=t.closest("tr"),a={action:"edd_get_shop_states",country:e(this).val(),field_name:"edd_settings[base_state]"};return e.post(ajaxurl,a,function(e){"nostates"==e?d.next().addClass("hidden"):(d.next().removeClass("hidden"),d.next().find("select").replaceWith(e))}),!1}),e(document.body).on("change","#edd_tax_rates select.edd-tax-country",function(){var t=e(this),d={action:"edd_get_shop_states",country:e(this).val(),field_name:t.attr("name").replace("country","state")};return e.post(ajaxurl,d,function(e){if("nostates"==e){var a='<input type="text" name="'+d.field_name+'" value=""/>';t.parent().next().find("select").replaceWith(a)}else t.parent().next().find("input,select").show(),t.parent().next().find("input,select").replaceWith(e)}),!1}),e("#edd_add_tax_rate").on("click",function(){var t=e("#edd_tax_rates tr:last"),d=t.clone(),a=t.parent().find("tr").length;return d.find("td input").not(":input[type=checkbox]").val(""),d.find('td [type="checkbox"]').attr("checked",!1),d.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(a)+"]"),e(this).attr("name",t).attr("id",t)}),d.find("label").each(function(){var t=e(this).attr("for");t=t.replace(/\[(\d+)\]/,"["+parseInt(a)+"]"),e(this).attr("for",t)}),d.insertAfter(t),!1}),e(document.body).on("click","#edd_tax_rates .edd_remove_tax_rate",function(){if(confirm(edd_vars.delete_tax_rate)){var t=e("#edd_tax_rates tr:visible"),d=t.length;2===d?(e("#edd_tax_rates select").val(""),e('#edd_tax_rates input[type="text"]').val(""),e('#edd_tax_rates input[type="number"]').val(""),e('#edd_tax_rates input[type="checkbox"]').attr("checked",!1)):e(this).closest("tr").remove(),e("#edd_tax_rates tr").each(function(t){e(this).children().find("input, select").each(function(){var d=e(this).attr("name");d=d.replace(/\[(\d+)\]/,"["+(t-1)+"]"),e(this).attr("name",d).attr("id",d)})})}return!1})},emails:function(){var t=e("#email-preview-wrap");if(t.length){var d=e("#email-preview");t.colorbox({inline:!0,href:d,width:"80%",height:"auto"})}},misc:function(){var t=e('select[name="edd_settings[download_method]"]'),d=t.parent().parent().next();"direct"==t.val()&&(d.hide(),d.find("input").prop("checked",!1)),t.on("change",function(){"direct"==e(this).val()?(d.hide(),d.find("input").prop("checked",!1)):d.show()})}};s.init(),e(".download_page_edd-payment-history .row-actions .delete a, a.edd-delete-payment").on("click",function(){return confirm(edd_vars.delete_payment)?!0:!1}),e("#the-list").on("click",".editinline",function(){var t=e(this).closest("tr").attr("id");t=t.replace("post-","");var d=e("#post-"+t),a=d.find(".column-price .downloadprice-"+t).val();a!=e("#post-"+t+".column-price .downloadprice-"+t).val()?e(".regprice","#edd-download-data").val(a).attr("disabled",!1):e(".regprice","#edd-download-data").val(edd_vars.quick_edit_warning).attr("disabled","disabled")}),e(document.body).on("click","#bulk_edit",function(){var t=e("#bulk-edit"),d=new Array;t.find("#bulk-titles").children().each(function(){d.push(e(this).attr("id").replace(/^(ttle)/i,""))});var a=e('#edd-download-data input[name="_edd_regprice"]').val(),n={action:"edd_save_bulk_edit",edd_bulk_nonce:d,post_ids:d,price:a};e.post(ajaxurl,n)}),e(".edd-select-chosen").chosen({inherit_select_classes:!0,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option}),e(".edd-select-chosen .chosen-search input").each(function(){var t=e(this).parent().parent().parent().prev("select.edd-select-chosen"),d=(t.data("search-type"),t.data("search-placeholder"));e(this).attr("placeholder",d)}),e(".chosen-choices").on("click",function(){var t=e(this).parent().prev().data("search-placeholder");"undefined"==typeof t&&(t=edd_vars.type_to_search),e(this).children("li").children("input").attr("placeholder",t)});var c,l=342;e(document.body).on("keyup",".edd-select.chosen-container .chosen-search input, .edd-select.chosen-container .search-field input",function(t){var d=e(this).val(),a=e(this).closest(".edd-select-chosen"),n=(a.attr("id").replace("_chosen",""),a.prev()),i=a.hasClass("no-bundles"),o=a.hasClass("variations"),r=t.which,s="edd_download_search";if(a.prev().data("search-type")){if("no_ajax"==n.data("search-type"))return;s="edd_"+n.data("search-type")+"_search"}d.length<=3&&"edd_download_search"==s||16==r||13==r||91==r||17==r||37==r||38==r||39==r||40==r||(clearTimeout(c),c=setTimeout(function(){e.ajax({type:"GET",url:ajaxurl,data:{action:s,s:d,no_bundles:i,variations:o},dataType:"json",beforeSend:function(){n.closest("ul.chosen-results").empty()},success:function(t){e("option:not(:selected)",n).remove(),e.each(t,function(t,d){e('option[value="'+d.id+'"]',n).length||n.prepend('<option value="'+d.id+'">'+d.name+"</option>")}),e(".edd-select-chosen").trigger("chosen:updated"),n.next().find("input").val(d)}}).fail(function(e){window.console&&window.console.log&&console.log(e)}).done(function(e){})},l))}),e("#post").on("click",".edd-thickbox",function(){e(".edd-select-chosen","#choose-download").css("width","100%")});var p={init:function(){this.revoke_api_key(),this.regenerate_api_key(),this.create_api_key(),this.recount_stats()},revoke_api_key:function(){e(document.body).on("click",".edd-revoke-api-key",function(e){return confirm(edd_vars.revoke_api_key)})},regenerate_api_key:function(){e(document.body).on("click",".edd-regenerate-api-key",function(e){return confirm(edd_vars.regenerate_api_key)})},create_api_key:function(){e(document.body).on("submit","#api-key-generate-form",function(t){var d=e('input[type="text"][name="user_id"]');d.css("border-color","#ddd");var a=d.val();return a.length<1||0==a?(d.css("border-color","#ff0000"),!1):void 0})},recount_stats:function(){e(document.body).on("change","#recount-stats-type",function(){var t=e("#edd-tools-recount-form"),d=e("option:selected",this).data("type"),a=e("#recount-stats-submit"),n=e("#tools-product-dropdown");if(t.find(".notice-wrap").remove(),a.removeClass("button-disabled").attr("disabled",!1),n.hide(),e(".edd-recount-stats-descriptions span").hide(),"recount-download"===d)n.show(),n.find(".edd-select-chosen").css("width","auto");else if("reset-stats"===d){t.append('<div class="notice-wrap"></div>');var i=t.find(".notice-wrap");i.html('<div class="notice notice-warning"><p><input type="checkbox" id="confirm-reset" name="confirm_reset_store" value="1" /> <label for="confirm-reset">'+edd_vars.reset_stats_warn+"</label></p></div>"),e("#recount-stats-submit").addClass("button-disabled").attr("disabled","disabled")}else n.hide(),n.val(0);e("#"+d).show()}),e(document.body).on("change","#confirm-reset",function(){var t=e(this).is(":checked");t?e("#recount-stats-submit").removeClass("button-disabled").removeAttr("disabled"):e("#recount-stats-submit").addClass("button-disabled").attr("disabled","disabled")}),e("#edd-tools-recount-form").submit(function(t){var d=e("#recount-stats-type").val(),a=e(this),n=e("option:selected",this).data("type");if("reset-stats"===n){var i=e("#confirm-reset").is(":checked");if(i)return!0;r=!0}a.find(".notice-wrap").remove(),a.append('<div class="notice-wrap"></div>');var o=a.find(".notice-wrap"),r=!1;if((null===d||0===d)&&(o.html('<div class="updated error"><p>'+edd_vars.batch_export_no_class+"</p></div>"),r=!0),"recount-download"===n){var s=e('select[name="download_id"]').val();0==s&&(o.html('<div class="updated error"><p>'+edd_vars.batch_export_no_reqs+"</p></div>"),r=!0)}return r?(a.find(".button-disabled").removeClass("button-disabled"),!1):void 0})}};p.init();var u={init:function(){this.submit(),this.dismiss_message()},submit:function(){var t=this;e(document.body).on("submit",".edd-export-form",function(d){d.preventDefault();var a=e(this).find('input[type="submit"]');if(!a.hasClass("button-disabled")){var n=e(this).serialize();a.addClass("button-disabled"),e(this).find(".notice-wrap").remove(),e(this).append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="edd-progress"><div></div></div></div>'),t.process_step(1,n,t)}})},process_step:function(t,d,a){e.ajax({type:"POST",url:ajaxurl,data:{form:d,action:"edd_do_ajax_export",step:t},dataType:"json",success:function(t){if("done"==t.step||t.error||t.success){var n=e(".edd-export-form").find(".edd-progress").parent().parent(),i=n.find(".notice-wrap");if(n.find(".button-disabled").removeClass("button-disabled"),t.error){var o=t.message;i.html('<div class="updated error"><p>'+o+"</p></div>")}else if(t.success){var r=t.message;i.html('<div id="edd-batch-success" class="updated notice is-dismissible"><p>'+r+'<span class="notice-dismiss"></span></p></div>')}else i.remove(),window.location=t.url}else e(".edd-progress div").animate({width:t.percentage+"%"},50,function(){}),a.process_step(parseInt(t.step),d,a)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})},dismiss_message:function(){e(document.body).on("click","#edd-batch-success .notice-dismiss",function(){e("#edd-batch-success").parent().slideUp("fast")})}};u.init();var _={init:function(){this.submit()},submit:function(){var t=this;e(".edd-import-form").ajaxForm({beforeSubmit:t.before_submit,success:t.success,complete:t.complete,dataType:"json",error:t.error})},before_submit:function(t,d,a){if(d.find(".notice-wrap").remove(),d.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="edd-progress"><div></div></div></div>'),!(window.File&&window.FileReader&&window.FileList&&window.Blob)){var n=e(".edd-import-form").find(".edd-progress").parent().parent(),i=n.find(".notice-wrap");return n.find(".button-disabled").removeClass("button-disabled"),i.html('<div class="update error"><p>'+edd_vars.unsupported_browser+"</p></div>"),!1}},success:function(e,t,d,a){},complete:function(t){var d=jQuery.parseJSON(t.responseText);if(d.success){var a=e(".edd-import-form .notice-wrap").parent();a.find(".edd-import-file-wrap,.notice-wrap").remove(),a.find(".edd-import-options").slideDown();var n=a.find("select.edd-import-csv-column"),i=(n.parent().parent(),""),o=d.data.columns.sort(function(e,t){return t>e?-1:e>t?1:0});e.each(o,function(e,t){i+='<option value="'+t+'">'+t+"</option>"}),n.append(i),n.on("change",function(){var t=e(this).val();t&&0!=d.data.first_row[t]?e(this).parent().next().html(d.data.first_row[t]):e(this).parent().next().html("")}),e(document.body).on("click",".edd-import-proceed",function(e){e.preventDefault(),a.append('<div class="notice-wrap"><span class="spinner is-active"></span><div class="edd-progress"><div></div></div></div>'),d.data.mapping=a.serialize(),_.process_step(1,d.data,self)})}else _.error(t)},error:function(t){var d=jQuery.parseJSON(t.responseText),a=e(".edd-import-form").find(".edd-progress").parent().parent(),n=a.find(".notice-wrap");a.find(".button-disabled").removeClass("button-disabled"),d.data.error?n.html('<div class="update error"><p>'+d.data.error+"</p></div>"):n.remove()},process_step:function(t,d,a){e.ajax({type:"POST",url:ajaxurl,data:{form:d.form,nonce:d.nonce,"class":d["class"],upload:d.upload,mapping:d.mapping,action:"edd_do_ajax_import",step:t},dataType:"json",success:function(t){if("done"==t.data.step||t.data.error){var n=e(".edd-import-form").find(".edd-progress").parent().parent(),i=n.find(".notice-wrap");n.find(".button-disabled").removeClass("button-disabled"),t.data.error?i.html('<div class="update error"><p>'+t.data.error+"</p></div>"):(n.find(".edd-import-options").hide(),e("html, body").animate({scrollTop:n.parent().offset().top},500),i.html('<div class="updated"><p>'+t.data.message+"</p></div>"))}else e(".edd-progress div").animate({width:t.data.percentage+"%"},50,function(){}),_.process_step(parseInt(t.data.step),d,a)}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}};_.init();var m={vars:{customer_card_wrap_editable:e(".edd-customer-card-wrapper .editable"),customer_card_wrap_edit_item:e(".edd-customer-card-wrapper .edit-item"),user_id:e('input[name="customerinfo[user_id]"]'),state_input:e(':input[name="customerinfo[state]"]'),note:e("#customer-note")},init:function(){this.edit_customer(),this.add_email(),this.user_search(),this.remove_user(),this.cancel_edit(),this.change_country(),this.add_note(),this.delete_checked()},edit_customer:function(){e(document.body).on("click","#edit-customer",function(e){e.preventDefault(),m.vars.customer_card_wrap_editable.hide(),m.vars.customer_card_wrap_edit_item.fadeIn().css("display","block")})},add_email:function(){e(document.body).on("click","#add-customer-email",function(t){t.preventDefault();var d=e(this),a=d.parent();a.parent().find(".notice-wrap").remove(),a.find(".spinner").css("visibility","visible"),d.attr("disabled",!0);var n=a.find('input[name="customer-id"]').val(),i=a.find('input[name="additional-email"]').val(),o=a.find('input[name="make-additional-primary"]').is(":checked"),r=a.find('input[name="add_email_nonce"]').val(),s={edd_action:"customer-add-email",customer_id:n,email:i,primary:o,_wpnonce:r};e.post(ajaxurl,s,function(e){!0===e.success?window.location.href=e.redirect:(d.attr("disabled",!1),
a.after('<div class="notice-wrap"><div class="notice notice-error inline"><p>'+e.message+"</p></div></div>"),a.find(".spinner").css("visibility","hidden"))},"json")})},user_search:function(){e(document.body).on("click.eddSelectUser",".edd_user_search_results a",function(t){t.preventDefault();var d=e(this).data("userid");m.vars.user_id.val(d)})},remove_user:function(){e(document.body).on("click","#disconnect-customer",function(t){t.preventDefault();var d=e('input[name="customerinfo[id]"]').val(),a={edd_action:"disconnect-userid",customer_id:d,_wpnonce:e("#edit-customer-info #_wpnonce").val()};e.post(ajaxurl,a,function(e){window.location.href=window.location.href},"json")})},cancel_edit:function(){e(document.body).on("click","#edd-edit-customer-cancel",function(t){t.preventDefault(),m.vars.customer_card_wrap_edit_item.hide(),m.vars.customer_card_wrap_editable.show(),e(".edd_user_search_results").html("")})},change_country:function(){e('select[name="customerinfo[country]"]').change(function(){var t=e(this),d={action:"edd_get_shop_states",country:t.val(),field_name:"customerinfo[state]"};return e.post(ajaxurl,d,function(e){"nostates"==e?m.vars.state_input.replaceWith('<input type="text" name="'+d.field_name+'" value="" class="edd-edit-toggles medium-text"/>'):m.vars.state_input.replaceWith(e)}),!1})},add_note:function(){e(document.body).on("click","#add-customer-note",function(t){t.preventDefault();var d={edd_action:"add-customer-note",customer_id:e("#customer-id").val(),customer_note:m.vars.note.val(),add_customer_note_nonce:e("#add_customer_note_nonce").val()};if(d.customer_note)e.ajax({type:"POST",data:d,url:ajaxurl,success:function(t){e("#edd-customer-notes").prepend(t),e(".edd-no-customer-notes").hide(),m.vars.note.val("")}}).fail(function(e){window.console&&window.console.log&&console.log(e)});else{var a=m.vars.note.css("border-color");m.vars.note.css("border-color","red"),setTimeout(function(){m.vars.note.css("border-color",a)},500)}})},delete_checked:function(){e("#edd-customer-delete-confirm").change(function(){var t=e("#edd-customer-delete-records"),d=e("#edd-delete-customer");e(this).prop("checked")?(t.attr("disabled",!1),d.attr("disabled",!1)):(t.attr("disabled",!0),t.prop("checked",!1),d.attr("disabled",!0))})}};m.init(),e(".edd-ajax-user-search").keyup(function(){var t=e(this).val(),d="";e(this).data("exclude")&&(d=e(this).data("exclude")),e(".edd-ajax").show();var a={action:"edd_search_users",user_name:t,exclude:d};document.body.style.cursor="wait",e.ajax({type:"POST",data:a,dataType:"json",url:ajaxurl,success:function(t){e(".edd-ajax").hide(),e(".edd_user_search_results").removeClass("hidden"),e(".edd_user_search_results span").html(""),e(t.results).appendTo(".edd_user_search_results span"),document.body.style.cursor="default"}})}),e(document.body).on("click.eddSelectUser",".edd_user_search_results span a",function(t){t.preventDefault();var d=e(this).data("login");e(".edd-ajax-user-search").val(d),e(".edd_user_search_results").addClass("hidden"),e(".edd_user_search_results span").html("")}),e(document.body).on("click.eddCancelUserSearch",".edd_user_search_results a.edd-ajax-user-cancel",function(t){t.preventDefault(),e(".edd-ajax-user-search").val(""),e(".edd_user_search_results").addClass("hidden"),e(".edd_user_search_results span").html("")}),e("#edd_dashboard_sales").length&&e.ajax({type:"GET",data:{action:"edd_load_dashboard_widget"},url:ajaxurl,success:function(t){e("#edd_dashboard_sales .inside").html(t)}}),e(document.body).on("keydown",".customer-note-input",function(t){13==t.keyCode&&(t.metaKey||t.ctrlKey)&&e("#add-customer-note").click()})});var eddFormatCurrency=function(e){var t=parseFloat(e),d=edd_vars.currency,a=edd_vars.currency_decimals;return t.toLocaleString(d,{style:"currency",currency:d,minimumFractionDigits:a,maximumFractionDigits:a})},eddFormatNumber=function(e){var t=parseFloat(e),d=edd_vars.currency;edd_vars.currency_decimals;return t.toLocaleString(d,{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0})},eddLabelFormatter=function(e,t){return'<div style="font-size:12px; text-align:center; padding:2px">'+e+"</div>"},eddLegendFormatterSales=function(e,t){var d=e.toLowerCase().replace(/\s/g,"-"),a='<div class="edd-legend-color" style="background-color: '+t.color+'"></div>',n='<div class="edd-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+eddFormatNumber(t.data[0][1])+")</div>",i='<div id="'+t.edd_vars.id+d+'" class="edd-legend-item-wrapper">'+a+n+"</div>";return jQuery("#edd-pie-legend-"+t.edd_vars.id).append(i),i},eddLegendFormatterEarnings=function(e,t){var d=e.toLowerCase().replace(/\s/g,"-"),a='<div class="edd-legend-color" style="background-color: '+t.color+'"></div>',n='<div class="edd-pie-legend-item">'+e+": "+Math.round(t.percent)+"% ("+eddFormatCurrency(t.data[0][1])+")</div>",i='<div id="'+t.edd_vars.id+d+'" class="edd-legend-item-wrapper">'+a+n+"</div>";return jQuery("#edd-pie-legend-"+t.edd_vars.id).append(i),i};