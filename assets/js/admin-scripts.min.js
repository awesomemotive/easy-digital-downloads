jQuery(document).ready(function(c){var b={init:function(){this.add();this.remove();this.type();this.prices();this.files()},clone_repeatable:function(e){clone=e.clone();clone.find("select").each(function(){c(this).val(e.find('select[name="'+c(this).attr("name")+'"]').val())});var d=e.parent().find("tr").length-1;clone.removeClass("edd_add_blank");clone.find("td input, td select").val("");clone.find("input, select").each(function(){var f=c(this).attr("name");f=f.replace(/\[(\d+)\]/,"["+parseInt(d)+"]");c(this).attr("name",f).attr("id",f)});return clone},add:function(){c("body").on("click",".submit .edd_add_repeatable",function(f){f.preventDefault();var d=c(this),g=d.parent().parent().prev("tr"),h=b.clone_repeatable(g);h.insertAfter(g)})},remove:function(){c("body").on("click",".edd_remove_repeatable",function(h){h.preventDefault();var i=c(this).parent().parent("tr"),g=i.parent().find("tr").length-1,f=c(this).data("type"),d="tr.edd_repeatable_"+f+"s";if(g>1){c("input, select",i).val("");i.fadeOut("fast").remove()}else{switch(f){case"price":alert(edd_vars.one_price_min);break;case"file":alert(edd_vars.one_file_min);break;default:alert(edd_vars.one_field_min);break}}c(d).each(function(e){c(this).find("input, select").each(function(){var j=c(this).attr("name");j=j.replace(/\[(\d+)\]/,"["+e+"]");c(this).attr("name",j).attr("id",j)})})})},type:function(){c("body").on("change","#edd_product_type",function(d){c("#edd_download_files").toggle();c("#edd_products").toggle();c("#edd_download_limit_wrap").toggle()})},prices:function(){c("body").on("change","#edd_variable_pricing",function(d){c(".edd_pricing_fields").toggle();c(".edd_repeatable_condition_field").toggle();c("#edd_download_files table .pricing").toggle()})},files:function(){if(typeof wp=="undefined"||edd_vars.new_media_ui!="1"){if(c(".edd_upload_image_button").length>0){window.formfield="";c("body").on("click",".edd_upload_image_button",function(g){g.preventDefault();window.formfield=c(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2000);if(edd_vars.post_id!=null){var f="post_id="+edd_vars.post_id+"&"}tb_show(edd_vars.add_new_download,"media-upload.php?"+f+"TB_iframe=true")});window.edd_send_to_editor=window.send_to_editor;window.send_to_editor=function(e){if(window.formfield){imgurl=c("a","<div>"+e+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.edd_send_to_editor(e)}window.send_to_editor=window.edd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var d;window.formfield="";c("body").on("click",".edd_upload_image_button",function(g){g.preventDefault();var f=c(this);window.formfield=c(this).closest(".edd_repeatable_upload_wrapper");if(d){d.open();return}d=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:f.data("uploader_title"),button:{text:f.data("uploader_button_text"),},multiple:true});d.on("menu:render:default",function(h){var e={};h.unset("library-separator");h.unset("gallery");h.unset("featured-image");h.unset("embed");h.set(e)});d.on("insert",function(){var e=d.state().get("selection");e.each(function(j,h){j=j.toJSON();if(h==0){window.formfield.find(".edd_repeatable_upload_field").val(j.url);window.formfield.find(".edd_repeatable_name_field").val(j.title)}else{var i=window.formfield,k=b.clone_repeatable(i);k.find(".edd_repeatable_upload_field").val(j.url);if(j.title.length>0){k.find(".edd_repeatable_name_field").val(j.title)}else{k.find(".edd_repeatable_name_field").val(j.filename)}k.insertAfter(i)}})});d.open()});var d;window.formfield=""}}};b.init();if(c(".form-table .edd_datepicker").length>0){var a="mm/dd/yy";c(".edd_datepicker").datepicker({dateFormat:a})}c("#purchased-downloads").on("click",".edd-remove-purchased-download",function(){var d=c(this);data={action:d.data("action"),download_id:d.data("id")};c.post(ajaxurl,data,function(e){if(e!="fail"){c(".purchased_download_"+d.data("id")).remove()}});return false});c("#edd-add-downloads-to-purchase").on("click",".edd-add-another-download",function(){var f=c("#edd-add-downloads-to-purchase select.edd-downloads-list:last").parent().clone(),e=c("#edd-add-downloads-to-purchase select.edd-downloads-list").length,d=c("#edd-add-downloads-to-purchase select.edd-downloads-list:last").parent();if(f.has("select.edd-variable-prices-select")){c("select.edd-variable-prices-select",f).remove()}c(f).children("select").prop("name","downloads["+e+"][id]");f.insertAfter(d);return false});c("#edd-add-downloads-to-purchase").on("change","select.edd-downloads-list",function(){var f=c(this),e=c("option:selected",f).val(),d=c("#edd-add-downloads-to-purchase select").length-1;if(parseInt(e)!=0){var g={action:"edd_check_for_download_price_variations",download_id:e,array_key:d,nonce:c("#edd_add_downloads_to_purchase_nonce").val()};c(".edd_add_download_to_purchase_waiting:last").removeClass("hidden");c.post(ajaxurl,g,function(h){f.next("select").remove();f.after(h);if(!c(".edd-remove-download",f.parent()).length&&c("#edd-add-downloads-to-purchase select.edd-downloads-list").length>1){f.parent().append('&nbsp;<a href="#" class="edd-remove-download">'+edd_vars.remove_text+"</a>")}c(".edd_add_download_to_purchase_waiting:last").addClass("hidden")})}else{f.next("select").remove();c(".edd_add_download_to_purchase_waiting:last").addClass("hidden")}});c("#edd-add-downloads-to-purchase").on("click",".edd-remove-download",function(){c(this).parent().remove();return false});c("#edd-add-download").on("click",function(){c("#edd-add-downloads-to-purchase select.edd-downloads-list").each(function(){var g=c("option:selected",this).val();if(c(this).next().hasClass("edd-variable-prices-select")){var f=c("option:selected",c(this).next()).val(),e=c("option:selected",c(this).next()).text(),d='<input type="hidden" name="edd-purchased-downloads['+g+'][options][price_id]" value="'+f+'"/> ('+e+")"}else{var f="",d=""}data={action:"edd_get_download_title",download_id:g};c.post(ajaxurl,data,function(h){if(h!="fail"){var i='<div class="purchased_download_'+g+'"><input type="hidden" name="edd-purchased-downloads['+g+']" value="'+g+'"/><strong>'+h+d+'</strong> - <a href="#" class="edd-remove-purchased-download" data-action="remove_purchased_download" data-id="'+g+'">Remove</a></div>';c(i).insertBefore("#edit-downloads")}})});tb_remove();return false});c("#edd_payment_status").change(function(){if(c("#edd_payment_status option:selected").val()=="publish"){c("#edd_payment_notification").slideDown()}else{c("#edd_payment_notification").slideUp()}});c(".download_page_edd-payment-history .row-actions .delete a").on("click",function(){if(confirm(edd_vars.delete_payment)){return true}return false});c("#the-list").on("click",".editinline",function(){inlineEditPost.revert();var e=c(this).closest("tr").attr("id");e=e.replace("post-","");var d=c("#post-"+e);var f=d.find(".column-price .downloadprice-"+e).val();if(f!=c("#post-"+e+".column-price .downloadprice-"+e).val()){c(".regprice","#edd-download-data").val(f).attr("disabled",false)}else{c(".regprice","#edd-download-data").val(edd_vars.quick_edit_warning).attr("disabled","disabled")}});if(c("#email-preview-wrap").length){c("#open-email-preview").colorbox({inline:true,href:"#email-preview",width:"80%",height:"auto"})}c("#edd-graphs-date-options").change(function(){var d=c(this);if(d.val()=="other"){c("#edd-date-range-options").show()}else{c("#edd-date-range-options").hide()}});if(c('input[name="edd_settings_taxes[tax_condition]"]:checked').val()!="local"){c('input[name="edd_settings_taxes[tax_condition]"]').parent().parent().next().hide()}c('input[name="edd_settings_taxes[tax_condition]"]').on("change",function(){var d=c(this).parent().parent().next();if(c(this).val()=="local"){d.fadeIn()}else{d.fadeOut()}});c("body").on("click","#bulk_edit",function(){var e=c("#bulk-edit");var d=new Array();e.find("#bulk-titles").children().each(function(){d.push(c(this).attr("id").replace(/^(ttle)/i,""))});var f=c('#edd-download-data input[name="_edd_regprice"]').val();var g={action:"edd_save_bulk_edit",edd_bulk_nonce:d,post_ids:d,price:f};c.post(ajaxurl,g)});c(".edd-select-chosen").chosen()});