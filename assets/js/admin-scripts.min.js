jQuery(document).ready(function(e){var t={init:function(){this.add();this.move();this.remove();this.type();this.prices();this.files();this.updatePrices()},clone_repeatable:function(t){var n=highest=1;t.parent().find("tr.edd_repeatable_row").each(function(){var t=e(this).data("key");if(parseInt(t)>highest){highest=t}});n=highest+=1;clone=t.clone();clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())});clone.removeClass("edd_add_blank");clone.data("key",n);clone.find("td input, td select").val("");clone.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]");e(this).attr("name",t).attr("id",t)});clone.find("span.edd_price_id").each(function(){e(this).text(parseInt(n))});clone.find(".edd_repeatable_default_input").each(function(){e(this).val(parseInt(n)).removeAttr("checked")});return clone},add:function(){e("body").on("click",".submit .edd_add_repeatable",function(n){n.preventDefault();var r=e(this),i=r.parent().parent().prev("tr"),s=t.clone_repeatable(i);s.insertAfter(i)})},move:function(){e(".edd_repeatable_table tbody").sortable({handle:".edd_draghandle",items:".edd_repeatable_row",opacity:.6,cursor:"move",axis:"y",update:function(){var t=0;e(this).find("tr").each(function(){e(this).find("input.edd_repeatable_index").each(function(){e(this).val(t)});t++})}})},remove:function(){e("body").on("click",".edd_remove_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent("tr"),r=n.parent().find("tr").length-1,i=e(this).data("type"),s="tr.edd_repeatable_"+i+"s";e(".edd_repeatable_condition_field option[value="+n.index()+"]").remove();if(r>1){e("input, select",n).val("");n.fadeOut("fast").remove()}else{switch(i){case"price":alert(edd_vars.one_price_min);break;case"file":alert(edd_vars.one_file_min);break;default:alert(edd_vars.one_field_min);break}}e(s).each(function(t){e(this).find("input, select").each(function(){var n=e(this).attr("name");n=n.replace(/\[(\d+)\]/,"["+t+"]");e(this).attr("name",n).attr("id",n)})})})},type:function(){e("body").on("change","#_edd_product_type",function(t){if("bundle"===e(this).val()){e("#edd_products").show();e("#edd_download_files").hide();e("#edd_download_limit_wrap").hide()}else{e("#edd_products").hide();e("#edd_download_files").show();e("#edd_download_limit_wrap").show()}})},prices:function(){e("body").on("change","#edd_variable_pricing",function(t){e(".edd_pricing_fields,.edd_repeatable_table .pricing").toggle()})},files:function(){if(typeof wp==="undefined"||"1"!==edd_vars.new_media_ui){if(e(".edd_upload_file_button").length>0){window.formfield="";e("body").on("click",".edd_upload_file_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);if(edd_vars.post_id!=null){var n="post_id="+edd_vars.post_id+"&"}tb_show(edd_vars.add_new_download,"media-upload.php?"+n+"TB_iframe=true")});window.edd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.edd_send_to_editor(t)}window.send_to_editor=window.edd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var n;window.formfield="";e("body").on("click",".edd_upload_file_button",function(r){r.preventDefault();var i=e(this);window.formfield=e(this).closest(".edd_repeatable_upload_wrapper");if(n){n.open();return}n=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:i.data("uploader-title"),button:{text:i.data("uploader-button-text")},multiple:e(this).data("multiple")=="0"?false:true});n.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});n.on("insert",function(){var e=n.state().get("selection");e.each(function(e,n){e=e.toJSON();if(0===n){window.formfield.find(".edd_repeatable_attachment_id_field").val(e.id);window.formfield.find(".edd_repeatable_upload_field").val(e.url);window.formfield.find(".edd_repeatable_name_field").val(e.title)}else{var r=window.formfield,i=t.clone_repeatable(r);i.find(".edd_repeatable_attachment_id_field").val(e.id);i.find(".edd_repeatable_upload_field").val(e.url);if(e.title.length>0){i.find(".edd_repeatable_name_field").val(e.title)}else{i.find(".edd_repeatable_name_field").val(e.filename)}i.insertAfter(r)}})});n.open()});var n;window.formfield=""}},updatePrices:function(){e("#edd_price_fields").on("keyup",".edd_variable_prices_name",function(){var t=e(this).parents("tr").index(),n=e(this).val(),r=e(".edd_repeatable_condition_field option[value="+t+"]");if(r.length>0){r.text(n)}else{e(".edd_repeatable_condition_field").append(e("<option></option>").attr("value",t).text(n))}})}};t.init();if(e(".edd_datepicker").length>0){var n="mm/dd/yy";e(".edd_datepicker").datepicker({dateFormat:n})}var r={init:function(){this.edit_address();this.remove_download();this.add_download();this.recalculate_total();this.variable_prices_check();this.add_note();this.remove_note();this.resend_receipt();this.copy_download_link()},edit_address:function(){e('select[name="edd-payment-address[0][country]"]').change(function(){var t=e(this);data={action:"edd_get_shop_states",country:t.val(),field_name:"edd-payment-address[0][state]"};e.post(ajaxurl,data,function(t){if("nostates"==t){e("#edd-order-address-state-wrap select, #edd-order-address-state-wrap input").replaceWith('<input type="text" name="edd-payment-address[0][state]" value="" class="edd-edit-toggles medium-text"/>')}else{e("#edd-order-address-state-wrap select, #edd-order-address-state-wrap input").replaceWith(t)}});return false})},remove_download:function(){e("#edd-purchased-files").on("click",".edd-order-remove-download",function(){if(confirm(edd_vars.delete_payment_download)){e(this).parent().parent().parent().remove();e("#edd-payment-downloads-changed").val(1);e(".edd-order-payment-recalc-totals").show()}return false})},add_download:function(){e("#edd-purchased-files").on("click","#edd-order-add-download",function(t){t.preventDefault();var n=e("#edd_order_download_select").val();var r=e("#edd_order_download_select").find(":selected").text();var i=e("#edd-order-download-quantity").val();var s=e("#edd-order-download-amount").val();var o=e(".edd_price_options_select option:selected").val();var u=e(".edd_price_options_select option:selected").text();if(n<1){return false}if(!s){s=0}s=parseInt(s);if(isNaN(s)){alert(edd_vars.numeric_item_price);return false}if(edd_vars.quantities_enabled==="1"){if(!isNaN(parseInt(i))){s=s*i}else{alert(edd_vars.numeric_quantity);return false}}s=s.toFixed(edd_vars.currency_decimals);var a=s+edd_vars.currency_sign;if("before"===edd_vars.currency_pos){a=edd_vars.currency_sign+s}if(u){r=r+" - "+u}var f=e("#edd-purchased-files div.row").length;var l=e("#edd-purchased-files div.row:last").clone();l.find(".download span").html('<a href="post.php?post='+n+'&action=edit"></a>');l.find(".download span a").text(r);l.find(".price-text").text(a);l.find(".item-quantity").text(i);l.find(".item-price").text(edd_vars.currency_sign+(s/i).toFixed(edd_vars.currency_decimals));l.find("input.edd-payment-details-download-id").val(n);l.find("input.edd-payment-details-download-price-id").val(o);l.find("input.edd-payment-details-download-amount").val(s);l.find("input.edd-payment-details-download-quantity").val(i);l.find("input").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(f)+"]");e(this).attr("name",t).attr("id",t)});e("#edd-payment-downloads-changed").val(1);e(l).insertAfter("#edd-purchased-files div.row:last");e(".edd-order-payment-recalc-totals").show()})},recalculate_total:function(){e("#edd-order-recalc-total").on("click",function(t){t.preventDefault();var n=0;if(e("#edd-purchased-files .row .edd-payment-details-download-amount").length){e("#edd-purchased-files .row .edd-payment-details-download-amount").each(function(){n+=parseFloat(e(this).val())})}if(e(".edd-payment-fees").length){e(".edd-payment-fees span.fee-amount").each(function(){n+=parseFloat(e(this).data("fee"))})}e("input[name=edd-payment-total]").val(n)})},variable_prices_check:function(){e("#edd-purchased-files").on("change","select#edd_order_download_select",function(){var t=e(this),n=t.val();if(parseInt(n)>0){var r={action:"edd_check_for_download_price_variations",download_id:n};e.ajax({type:"POST",data:r,url:ajaxurl,success:function(n){e(".edd_price_options_select").remove();e(n).insertAfter(t.next())}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})}})},add_note:function(){e("#edd-add-payment-note").on("click",function(t){t.preventDefault();var n={action:"edd_insert_payment_note",payment_id:e(this).data("payment-id"),note:e("#edd-payment-note").val()};if(n.note){e.ajax({type:"POST",data:n,url:ajaxurl,success:function(t){e("#edd-payment-notes-inner").append(t);e(".edd-no-payment-notes").hide();e("#edd-payment-note").val("")}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})}else{var r=e("#edd-payment-note").css("border-color");e("#edd-payment-note").css("border-color","red");setTimeout(function(){e("#edd-payment-note").css("border-color",r)},500)}})},remove_note:function(){e("body").on("click",".edd-delete-payment-note",function(t){t.preventDefault();if(confirm(edd_vars.delete_payment_note)){var n={action:"edd_delete_payment_note",payment_id:e(this).data("payment-id"),note_id:e(this).data("note-id")};e.ajax({type:"POST",data:n,url:ajaxurl,success:function(t){e("#edd-payment-note-"+n.note_id).remove();if(!e(".edd-payment-note").length){e(".edd-no-payment-notes").show()}return false}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}});return true}})},resend_receipt:function(){e("body").on("click","#edd-resend-receipt",function(e){return confirm(edd_vars.resend_receipt)})},copy_download_link:function(){e("body").on("click",".edd-copy-download-link",function(t){t.preventDefault();var n=e(this);var r={action:"edd_get_file_download_link",payment_id:e('input[name="edd_payment_id"]').val(),download_id:n.data("download-id"),price_id:n.data("price-id")};e.ajax({type:"POST",data:r,url:ajaxurl,success:function(t){e("#edd-download-link").dialog({width:400}).html('<textarea rows="10" cols="40" id="edd-download-link-textarea">'+t+"</textarea>");e("#edd-download-link-textarea").focus().select();return false}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})})}};r.init();var i={init:function(){this.type_select();this.product_requirements()},type_select:function(){e("#edd-edit-discount #edd-type, #edd-add-discount #edd-type").change(function(){e(".edd-amount-description").toggle()})},product_requirements:function(){e("#products").change(function(){if(e(this).val()){e("#edd-discount-product-conditions").show()}else{e("#edd-discount-product-conditions").hide()}})}};i.init();var s={init:function(){this.date_options();this.customers_export()},date_options:function(){e("#edd-graphs-date-options").change(function(){var t=e(this);if("other"===t.val()){e("#edd-date-range-options").show()}else{e("#edd-date-range-options").hide()}})},customers_export:function(){e("#edd_customer_export_download").change(function(){var t=e(this),n=e("option:selected",t).val();if("0"===t.val()){e("#edd_customer_export_option").show()}else{e("#edd_customer_export_option").hide()}if(parseInt(n)!=0){var r={action:"edd_check_for_download_price_variations",download_id:n};e.post(ajaxurl,r,function(n){e(".edd_price_options_select").remove();t.after(n)})}else{e(".edd_price_options_select").remove()}})}};s.init();var o={init:function(){this.general();this.taxes();this.emails();this.misc()},general:function(){if(e(".edd-color-picker").length){e(".edd-color-picker").wpColorPicker()}if(typeof wp==="undefined"||"1"!==edd_vars.new_media_ui){if(e(".edd_settings_upload_button").length>0){window.formfield="";e("body").on("click",".edd_settings_upload_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);tb_show(edd_vars.add_new_download,"media-upload.php?TB_iframe=true")});window.edd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.edd_send_to_editor(t)}window.send_to_editor=window.edd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var t;window.formfield="";e("body").on("click",".edd_settings_upload_button",function(n){n.preventDefault();var r=e(this);window.formfield=e(this).parent().prev();if(t){t.open();return}t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:r.data("uploader_title"),button:{text:r.data("uploader_button_text")},multiple:false});t.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});t.on("insert",function(){var e=t.state().get("selection");e.each(function(e,t){e=e.toJSON();window.formfield.val(e.url)})});t.open()});var t;window.formfield=""}},taxes:function(){if(e("select.edd-no-states").length){e("select.edd-no-states").closest("tr").hide()}e('select[name="edd_settings[base_country]"]').change(function(){var t=e(this),n=t.closest("tr");data={action:"edd_get_shop_states",country:e(this).val(),field_name:"edd_settings[base_state]"};e.post(ajaxurl,data,function(e){if("nostates"==e){n.next().hide()}else{n.next().show();n.next().find("select").replaceWith(e)}});return false});e("body").on("change","#edd_tax_rates select.edd-tax-country",function(){var t=e(this);data={action:"edd_get_shop_states",country:e(this).val(),field_name:t.attr("name").replace("country","state")};e.post(ajaxurl,data,function(e){if("nostates"==e){var n='<input type="text" name="'+data.field_name+'" value=""/>';t.parent().next().find("select").replaceWith(n)}else{t.parent().next().find("input,select").show();t.parent().next().find("input,select").replaceWith(e)}});return false});e("#edd_add_tax_rate").on("click",function(){var t=e("#edd_tax_rates tr:last");var n=t.clone();var r=t.parent().find("tr").length;n.find("td input").val("");n.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(r)+"]");e(this).attr("name",t).attr("id",t)});n.insertAfter(t);return false});e("body").on("click","#edd_tax_rates .edd_remove_tax_rate",function(){if(confirm(edd_vars.delete_tax_rate))e(this).closest("tr").remove();return false})},emails:function(){if(e("#email-preview-wrap").length){var t=e("#email-preview");e("#open-email-preview").colorbox({inline:true,href:t,width:"80%",height:"auto"})}},misc:function(){if(e('select[name="edd_settings[download_method]"]:selected').val()!="direct"){e('select[name="edd_settings[download_method]"]').parent().parent().next().hide();e('select[name="edd_settings[download_method]"]').parent().parent().next().find("input").attr("checked",false)}e('select[name="edd_settings[download_method]"]').on("change",function(){var t=e(this).parent().parent().next();if(e(this).val()=="direct"){t.hide()}else{t.show();t.find("input").attr("checked",false)}})}};o.init();e(".download_page_edd-payment-history .row-actions .delete a").on("click",function(){if(confirm(edd_vars.delete_payment)){return true}return false});e("#the-list").on("click",".editinline",function(){inlineEditPost.revert();var t=e(this).closest("tr").attr("id");t=t.replace("post-","");var n=e("#post-"+t);var r=n.find(".column-price .downloadprice-"+t).val();if(r!=e("#post-"+t+".column-price .downloadprice-"+t).val()){e(".regprice","#edd-download-data").val(r).attr("disabled",false)}else{e(".regprice","#edd-download-data").val(edd_vars.quick_edit_warning).attr("disabled","disabled")}});e("body").on("click","#bulk_edit",function(){var t=e("#bulk-edit");var n=new Array;t.find("#bulk-titles").children().each(function(){n.push(e(this).attr("id").replace(/^(ttle)/i,""))});var r=e('#edd-download-data input[name="_edd_regprice"]').val();var i={action:"edd_save_bulk_edit",edd_bulk_nonce:n,post_ids:n,price:r};e.post(ajaxurl,i)});e(".edd-select-chosen").chosen({inherit_select_classes:true,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option});e(".chosen-choices").on("click",function(){e(this).children("li").children("input").attr("placeholder",edd_vars.type_to_search)});var u;var a=342;e(".edd-select.chosen-container .chosen-search input, .edd-select.chosen-container .search-field input").keyup(function(t){var n=e(this).val(),r=e(this).closest(".edd-select-chosen");var i=r.attr("id").replace("_chosen","");var s=t.which;if(n.length<=3||t.which==16||t.which==13||t.which==91||t.which==17||t.which==37||t.which==38||t.which==39||t.which==40){return}clearTimeout(u);u=setTimeout(function(){e.ajax({type:"GET",url:ajaxurl,data:{action:"edd_download_search",s:n},dataType:"json",beforeSend:function(){e("ul.chosen-results").empty()},success:function(t){e("#"+i+" option:not(:selected)").remove();e.each(t,function(t,n){if(!e("#"+i+' option[value="'+n.id+'"]').length){e("#"+i).prepend('<option value="'+n.id+'">'+n.name+"</option>")}});e(".edd-select-chosen").trigger("chosen:updated");e("#"+i).next().find("input").val(n)}}).fail(function(e){if(window.console&&window.console.log){console.log(data)}}).done(function(e){})},a)});e("#post").on("click",".edd-thickbox",function(){e(".edd-select-chosen","#choose-download").css("width","100%")});var f={init:function(){this.revoke_api_key();this.regenerate_api_key()},revoke_api_key:function(){e("body").on("click",".edd-revoke-api-key",function(e){return confirm(edd_vars.revoke_api_key)})},regenerate_api_key:function(){e("body").on("click",".edd-regenerate-api-key",function(e){return confirm(edd_vars.regenerate_api_key)})}};f.init();e(".edd-ajax-user-search").keyup(function(){var t=e(this).val();e(".edd-ajax").show();data={action:"edd_search_users",user_name:t};document.body.style.cursor="wait";e.ajax({type:"POST",data:data,dataType:"json",url:ajaxurl,success:function(t){e(".edd-ajax").hide();e(".edd_user_search_results").html("");e(t.results).appendTo(".edd_user_search_results");document.body.style.cursor="default"}})});e("body").on("click.eddSelectUser",".edd_user_search_results a",function(t){t.preventDefault();var n=e(this).data("login");e(".edd-ajax-user-search").val(n);e(".edd_user_search_results").html("")})})