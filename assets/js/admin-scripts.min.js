jQuery(document).ready(function(e){var t={init:function(){this.add();this.move();this.remove();this.type();this.prices();this.files()},clone_repeatable:function(t){clone=t.clone();clone.find("select").each(function(){e(this).val(t.find('select[name="'+e(this).attr("name")+'"]').val())});var n=t.parent().find("tr").length-1;clone.removeClass("edd_add_blank");clone.find("td input, td select").val("");clone.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]");e(this).attr("name",t).attr("id",t)});return clone},add:function(){e("body").on("click",".submit .edd_add_repeatable",function(n){n.preventDefault();var r=e(this),i=r.parent().parent().prev("tr"),s=t.clone_repeatable(i);s.insertAfter(i)})},move:function(){},remove:function(){e("body").on("click",".edd_remove_repeatable",function(t){t.preventDefault();var n=e(this).parent().parent("tr"),r=n.parent().find("tr").length-1,i=e(this).data("type"),s="tr.edd_repeatable_"+i+"s";if(r>1){e("input, select",n).val("");n.fadeOut("fast").remove()}else{switch(i){case"price":alert(edd_vars.one_price_min);break;case"file":alert(edd_vars.one_file_min);break;default:alert(edd_vars.one_field_min);break}}e(s).each(function(t){e(this).find("input, select").each(function(){var n=e(this).attr("name");n=n.replace(/\[(\d+)\]/,"["+t+"]");e(this).attr("name",n).attr("id",n)})})})},type:function(){e("body").on("change","#edd_product_type",function(t){e("#edd_download_files").toggle();e("#edd_products").toggle();e("#edd_download_limit_wrap").toggle()})},prices:function(){e("body").on("change","#edd_variable_pricing",function(t){e(".edd_pricing_fields").toggle();e(".edd_repeatable_condition_field").toggle();e("#edd_download_files table .pricing").toggle()})},files:function(){if(typeof wp=="undefined"||edd_vars.new_media_ui!="1"){if(e(".edd_upload_image_button").length>0){window.formfield="";e("body").on("click",".edd_upload_image_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);if(edd_vars.post_id!=null){var n="post_id="+edd_vars.post_id+"&"}tb_show(edd_vars.add_new_download,"media-upload.php?"+n+"TB_iframe=true")});window.edd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.edd_send_to_editor(t)}window.send_to_editor=window.edd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var n;window.formfield="";e("body").on("click",".edd_upload_image_button",function(r){r.preventDefault();var i=e(this);window.formfield=e(this).closest(".edd_repeatable_upload_wrapper");if(n){n.open();return}n=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:i.data("uploader_title"),button:{text:i.data("uploader_button_text")},multiple:e(this).data("multiple")=="0"?false:true});n.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});n.on("insert",function(){var e=n.state().get("selection");e.each(function(e,n){e=e.toJSON();if(n==0){window.formfield.find(".edd_repeatable_upload_field").val(e.url);window.formfield.find(".edd_repeatable_name_field").val(e.title)}else{var r=window.formfield,i=t.clone_repeatable(r);i.find(".edd_repeatable_upload_field").val(e.url);if(e.title.length>0){i.find(".edd_repeatable_name_field").val(e.title)}else{i.find(".edd_repeatable_name_field").val(e.filename)}i.insertAfter(r)}})});n.open()});var n;window.formfield=""}}};t.init();if(e(".form-table .edd_datepicker").length>0){var n="mm/dd/yy";e(".edd_datepicker").datepicker({dateFormat:n})}var r={init:function(){this.remove_download();this.add_download();this.variable_prices_check();this.status_change();this.notes()},remove_download:function(){e("#purchased-downloads").on("click",".edd-remove-purchased-download",function(){var t=e(this);data={action:t.data("action"),download_id:t.data("id")};e.post(ajaxurl,data,function(n){if(n!="fail"){e(".purchased_download_"+t.data("id")).remove()}});return false});e("#edd-add-downloads-to-purchase").on("click",".edd-remove-download",function(){e(this).parent().remove();return false})},add_download:function(){e("#edd-add-downloads-to-purchase").on("click",".edd-add-another-download",function(){var t=e("#edd-add-downloads-to-purchase select.edd-downloads-list:last").parent().clone(),n=e("#edd-add-downloads-to-purchase select.edd-downloads-list").length,r=e("#edd-add-downloads-to-purchase select.edd-downloads-list:last").parent();if(t.has("select.edd-variable-prices-select")){e("select.edd-variable-prices-select",t).remove()}e(t).children("select").prop("name","downloads["+n+"][id]");t.insertAfter(r);return false});e("#edd-add-download").on("click",function(){e("#edd-add-downloads-to-purchase select.edd-downloads-list").each(function(){var t=e("option:selected",this).val();if(e(this).next().hasClass("edd-variable-prices-select")){var n=e("option:selected",e(this).next()).val(),r=e("option:selected",e(this).next()).text(),i='<input type="hidden" name="edd-purchased-downloads['+t+'][options][price_id]" value="'+n+'"/> '+"("+r+")"}else{var n="",i=""}data={action:"edd_get_download_title",download_id:t};e.post(ajaxurl,data,function(n){if(n!="fail"){var r='<div class="purchased_download_'+t+'"><input type="hidden" name="edd-purchased-downloads['+t+']" value="'+t+'"/><strong>'+n+i+'</strong> - <a href="#" class="edd-remove-purchased-download" data-action="remove_purchased_download" data-id="'+t+'">Remove</a></div>';e(r).insertBefore("#edit-downloads")}})});tb_remove();return false})},variable_prices_check:function(){e("#edd-add-downloads-to-purchase").on("change","select.edd-downloads-list",function(){var t=e(this),n=e("option:selected",t).val(),r=e("#edd-add-downloads-to-purchase select").length-1;if(parseInt(n)!=0){var i={action:"edd_check_for_download_price_variations",download_id:n,array_key:r,nonce:e("#edd_add_downloads_to_purchase_nonce").val()};e(".edd_add_download_to_purchase_waiting:last").removeClass("hidden");e.post(ajaxurl,i,function(n){t.next("select").remove();t.after(n);if(!e(".edd-remove-download",t.parent()).length&&e("#edd-add-downloads-to-purchase select.edd-downloads-list").length>1){t.parent().append('Â <a href="#" class="edd-remove-download">'+edd_vars.remove_text+"</a>")}e(".edd_add_download_to_purchase_waiting:last").addClass("hidden")})}else{t.next("select").remove();e(".edd_add_download_to_purchase_waiting:last").addClass("hidden")}})},status_change:function(){e("#edd_payment_status").change(function(){if(e("#edd_payment_status option:selected").val()=="publish"){e("#edd_payment_notification").slideDown()}else{e("#edd_payment_notification").slideUp()}})},notes:function(){e(".edd-delete-payment-note").on("click",function(){if(confirm(edd_vars.delete_payment_note)){return true}return false})}};r.init();var i={init:function(){this.date_options();this.customers_export()},date_options:function(){e("#edd-graphs-date-options").change(function(){var t=e(this);if(t.val()=="other"){e("#edd-date-range-options").show()}else{e("#edd-date-range-options").hide()}})},customers_export:function(){e("#edd_customer_export_download").change(function(){var t=e(this);if(t.val()=="0"){e("#edd_customer_export_option").show()}else{e("#edd_customer_export_option").hide()}})}};i.init();var s={init:function(){this.general();this.taxes();this.emails();this.misc()},general:function(){if(e(".edd-color-picker").length){e(".edd-color-picker").wpColorPicker()}if(typeof wp=="undefined"||edd_vars.new_media_ui!="1"){if(e(".edd_settings_upload_button").length>0){window.formfield="";e("body").on("click",".edd_settings_upload_button",function(t){t.preventDefault();window.formfield=e(this).parent().prev();window.tbframe_interval=setInterval(function(){jQuery("#TB_iframeContent").contents().find(".savesend .button").val(edd_vars.use_this_file).end().find("#insert-gallery, .wp-post-thumbnail").hide()},2e3);tb_show(edd_vars.add_new_download,"media-upload.php?TB_iframe=true")});window.edd_send_to_editor=window.send_to_editor;window.send_to_editor=function(t){if(window.formfield){imgurl=e("a","<div>"+t+"</div>").attr("href");window.formfield.val(imgurl);window.clearInterval(window.tbframe_interval);tb_remove()}else{window.edd_send_to_editor(t)}window.send_to_editor=window.edd_send_to_editor;window.formfield="";window.imagefield=false}}}else{var t;window.formfield="";e("body").on("click",".edd_settings_upload_button",function(n){n.preventDefault();var r=e(this);window.formfield=e(this).parent().prev();if(t){t.open();return}t=wp.media.frames.file_frame=wp.media({frame:"post",state:"insert",title:r.data("uploader_title"),button:{text:r.data("uploader_button_text")},multiple:false});t.on("menu:render:default",function(e){var t={};e.unset("library-separator");e.unset("gallery");e.unset("featured-image");e.unset("embed");e.set(t)});t.on("insert",function(){var e=t.state().get("selection");e.each(function(e,t){e=e.toJSON();window.formfield.val(e.url)})});t.open()});var t;window.formfield=""}},taxes:function(){e('select[name="edd_settings_taxes[base_country]"]').change(function(){var t=e(this),n=t.closest("tr");data={action:"edd_get_shop_states",country:e(this).val(),field_name:"edd_settings_taxes[base_state]"};e.post(ajaxurl,data,function(e){if("nostates"==e){n.next().hide()}else{n.next().show();n.next().find("select").replaceWith(e)}});return false});e("body").on("change","#edd_tax_rates select",function(){var t=e(this);data={action:"edd_get_shop_states",country:e(this).val(),field_name:t.attr("name").replace("country","state")};e.post(ajaxurl,data,function(e){if("nostates"==e){var n='<input type="text" name="'+data.field_name+'" value=""/>';t.parent().next().find("select").replaceWith(n)}else{t.parent().next().find("input,select").show();t.parent().next().find("input,select").replaceWith(e)}});return false});e("#edd_add_tax_rate").on("click",function(){var t=e("#edd_tax_rates tr:last");var n=t.clone();var r=t.parent().find("tr").length;n.find("td input").val("");n.find("input, select").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(r)+"]");e(this).attr("name",t).attr("id",t)});n.insertAfter(t);return false});e("body").on("click","#edd_tax_rates .edd_remove_tax_rate",function(){if(confirm(edd_vars.delete_tax_rate))e(this).closest("tr").remove();return false})},emails:function(){if(e("#email-preview-wrap").length){e("#open-email-preview").colorbox({inline:true,href:"#email-preview",width:"80%",height:"auto"})}},misc:function(){if(e('select[name="edd_settings_misc[download_method]"]:selected').val()!="direct"){e('select[name="edd_settings_misc[download_method]"]').parent().parent().next().hide();e('select[name="edd_settings_misc[download_method]"]').parent().parent().next().find("input").attr("checked",false)}e('select[name="edd_settings_misc[download_method]"]').on("change",function(){var t=e(this).parent().parent().next();if(e(this).val()=="direct"){t.hide()}else{t.show();t.find("input").attr("checked",false)}})}};s.init();e(".download_page_edd-payment-history .row-actions .delete a").on("click",function(){if(confirm(edd_vars.delete_payment)){return true}return false});e("#the-list").on("click",".editinline",function(){inlineEditPost.revert();var t=e(this).closest("tr").attr("id");t=t.replace("post-","");var n=e("#post-"+t);var r=n.find(".column-price .downloadprice-"+t).val();if(r!=e("#post-"+t+".column-price .downloadprice-"+t).val()){e(".regprice","#edd-download-data").val(r).attr("disabled",false)}else{e(".regprice","#edd-download-data").val(edd_vars.quick_edit_warning).attr("disabled","disabled")}});e("body").on("click","#bulk_edit",function(){var t=e("#bulk-edit");var n=new Array;t.find("#bulk-titles").children().each(function(){n.push(e(this).attr("id").replace(/^(ttle)/i,""))});var r=e('#edd-download-data input[name="_edd_regprice"]').val();var i={action:"edd_save_bulk_edit",edd_bulk_nonce:n,post_ids:n,price:r};e.post(ajaxurl,i)});e(".edd-select-chosen").chosen()})