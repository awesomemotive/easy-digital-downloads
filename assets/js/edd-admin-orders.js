!function(e){var d={};function t(r){if(d[r])return d[r].exports;var a=d[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=d,t.d=function(e,d,r){t.o(e,d)||Object.defineProperty(e,d,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,d){if(1&d&&(e=t(e)),8&d)return e;if(4&d&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&d&&"string"!=typeof e)for(var a in e)t.d(r,a,function(d){return e[d]}.bind(null,a));return r},t.n=function(e){var d=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(d,"a",d),d},t.o=function(e,d){return Object.prototype.hasOwnProperty.call(e,d)},t.p="",t(t.s=7)}({0:function(e,d){e.exports=jQuery},1:function(e,d,t){"use strict";t.d(d,"a",(function(){return a}));var r={disable_search_threshold:13,search_contains:!0,inherit_select_classes:!0,single_backstroke_delete:!1,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option,no_results_text:edd_vars.no_results_text},a=function(e){var d=r;return e.data("search-type")&&delete d.disable_search_threshold,d}},23:function(e,d,t){"use strict";(function(e){var d=t(7);!function(){var t=document.querySelector(".edd-override");if(t){var r=document.querySelector('input[name="edd-order-download-is-overrideable"]');e(document).on("edd-admin-add-order-download",(function(e){_.each(document.querySelectorAll(".overridable input"),(function(e){return e.addEventListener("keyup",d.default.update_totals)})),d.default.update_totals(),t.disabled=1==r.value})),t.addEventListener("click",(function(){this.disabled=!0,r.value=1,_.each(document.querySelectorAll(".overridable input"),(function(e){return e.readOnly=!1}));var e=document.createElement("input");e.name="edd_add_order_override",e.value=!0,e.type="hidden",document.getElementById("edd-add-order-form").appendChild(e)}))}}()}).call(this,t(0))},7:function(e,d,t){"use strict";t.r(d),function(e,r){var a=t(1),n=(t(23),{}),o={init:function(){this.add_order_item(),this.add_adjustment(),this.remove(),this.fetch_addresses(),this.select_address(),this.recalculate_total(),this.validate(),this.filters()},add_order_item:function(){var d=e(".edd-add-order-item-button");e("#edd-order-items").on("click","h3 .edd-metabox-title-action",(function(d){d.preventDefault(),e("#edd-order-items").children(".edd-add-download-to-purchase").slideToggle()})),d.prop("disabled","disabled"),e(".edd-order-add-download-select").on("change",(function(){d.removeAttr("disabled")})),d.on("click",(function(d){d.preventDefault();var t=e(".edd-order-add-download-select"),r=e(".edd-add-download-to-purchase .spinner"),a={action:"edd_add_order_item",nonce:e("#edd_add_order_nonce").val(),country:e(".edd-order-address-country").val(),region:e(".edd-order-address-region").val(),download:t.val(),quantity:e(".edd-add-order-quantity").val(),editable:e('input[name="edd-order-download-is-overrideable"]').val()};r.css("visibility","visible"),e.post(ajaxurl,a,(function(d){var t=d.success,a=d.data;t&&(e(".orderitems .no-items").hide(),e(".orderitems tbody").append(a.html),o.update_totals(),o.reindex(),r.css("visibility","hidden"),e(document).trigger("edd-admin-add-order-download",d))}),"json")}))},add_adjustment:function(){e("#edd-order-adjustments").on("click","h3 .edd-metabox-title-action",(function(d){d.preventDefault(),e("#edd-order-adjustments").children(".edd-add-adjustment-to-purchase").slideToggle()})),e(".edd-order-add-adjustment-select").on("change",(function(){var d=e(this).val();e(".edd-add-adjustment-to-purchase li.fee, .edd-add-adjustment-to-purchase li.discount, .edd-add-adjustment-to-purchase li.fee, .edd-add-adjustment-to-purchase li.credit").hide(),e("."+d,".edd-add-adjustment-to-purchase").show()})),e(".edd-add-order-adjustment-button").on("click",(function(d){d.preventDefault();var t={action:"edd_add_adjustment_to_order",nonce:e("#edd_add_order_nonce").val(),type:e(".edd-order-add-adjustment-select").val(),adjustment_data:{fee:e(".edd-order-add-fee-select").val(),discount:e(".edd-order-add-discount-select").val(),credit:{description:e(".edd-add-order-credit-description").val(),amount:e(".edd-add-order-credit-amount").val()}}},r=e(".edd-add-adjustment-to-purchase .spinner");r.css("visibility","visible"),e.post(ajaxurl,t,(function(d){var t=d.success,a=d.data;t&&(e(".orderadjustments .no-items").hide(),e(".orderadjustments tbody").append(a.html),o.update_totals(),o.reindex(),r.css("visibility","hidden"))}),"json")}))},remove:function(){e(document.body).on("click",".orderitems .remove-item, .orderadjustments .remove-item",(function(d){d.preventDefault();var t=e(this),r=t.parents("tbody");return t.parents("tr").remove(),1===e("tr",r).length&&e(".no-items",r).show(),o.update_totals(),o.reindex(),!1}))},fetch_addresses:function(){e(".edd-payment-change-customer-input").on("change",(function(){var d={action:"edd_customer_addresses",customer_id:e(this).val(),nonce:e("#edd_add_order_nonce").val()};return e.post(ajaxurl,d,(function(d){var t=d.success,r=d.data;t?(n.customer_address_ajax_result=r,r.html?(e(".customer-address-select-wrap").html(r.html).show(),e(".customer-address-select-wrap select").each((function(){var d=e(this);d.chosen(Object(a.a)(d))}))):e(".customer-address-select-wrap").html("").hide()):e(".customer-address-select-wrap").html("").hide()}),"json"),!1}))},select_address:function(){e(document.body).on("change",".customer-address-select-wrap .add-order-customer-address-select",(function(){var d=e(this).val(),t=e("#edd-add-order-form select#edd_order_address_country"),r=n.customer_address_ajax_result.addresses[d];e('#edd-add-order-form input[name="edd_order_address[address]"]').val(r.address),e('#edd-add-order-form input[name="edd_order_address[address2]"]').val(r.address2),e('#edd-add-order-form input[name="edd_order_address[postal_code]"]').val(r.postal_code),e('#edd-add-order-form input[name="edd_order_address[city]"]').val(r.city),t.val(r.country).trigger("chosen:updated"),e('#edd-add-order-form input[name="edd_order_address[address_id]"]').val(d);var a={action:"edd_get_shop_states",country:t.val(),nonce:e(".add-order-customer-address-select").data("nonce"),field_name:"edd_order_address_region"};return e.post(ajaxurl,a,(function(d){e("select#edd_order_address_region").find("option:gt(0)").remove(),"nostates"!==d&&e(d).find("option:gt(0)").appendTo("select#edd_order_address_region"),e("select#edd_order_address_region").trigger("chosen:updated"),e("select#edd_order_address_region").val(r.region).trigger("chosen:updated")})),!1})),e(".edd-order-address-country").on("change",(function(){var d=e(this),t={action:"edd_get_shop_states",country:d.val(),nonce:d.data("nonce"),field_name:"edd-order-address-country"};return e.post(ajaxurl,t,(function(d){e("select.edd-order-address-region").find("option:gt(0)").remove(),"nostates"!==d&&e(d).find("option:gt(0)").appendTo("select.edd-order-address-region"),e("select.edd-order-address-region").trigger("chosen:updated")})).done((function(e){o.recalculate_taxes()})),!1})),e(".edd-order-address-region").on("change",(function(){o.recalculate_taxes()}))},reindex:function(){var d=0;e(".orderitems tbody tr:not(.no-items), .orderadjustments tbody tr:not(.no-items)").each((function(){e(this).attr("data-key",d),e(this).find("input").each((function(){var t=e(this).attr("name");t&&(t=t.replace(/\[(\d+)\]/,"["+parseInt(d)+"]"),e(this).attr("name",t))})),d++}))},recalculate_taxes:function(){e("#publishing-action .spinner").css("visibility","visible");var d={action:"edd_add_order_recalculate_taxes",country:e(".edd-order-address-country").val(),region:e(".edd-order-address-region").val(),nonce:e("#edd_add_order_nonce").val()};e.post(ajaxurl,d,(function(d){var t=d.success,r=d.data;if(t&&""!==r.tax_rate){var a=parseFloat(r.tax_rate);e(".orderitems tbody tr:not(.no-items)").each((function(){var d=parseFloat(e(".amount .value",this).text())*(e(".quantity .value",this).length>0?parseFloat(e(".column-quantity .value",this).text()):1),t=0;if(r.prices_include_tax){var n=parseFloat(d/(1+a));t=parseFloat(d-n)}else t=d*a;var o=edd_vars.currency,s=edd_vars.currency_decimals,i=d+t;e(".tax .value",this).text(t.toLocaleString(o,{style:"decimal",currency:o,minimumFractionDigits:s,maximumFractionDigits:s})),e(".total .value",this).text(i.toLocaleString(o,{style:"decimal",currency:o,minimumFractionDigits:s,maximumFractionDigits:s}))}))}}),"json").done((function(){e("#publishing-action .spinner").css("visibility","hidden"),o.update_totals()}))},recalculate_total:function(){e("#edd-add-order").on("click","#edd-order-recalc-total",(function(){o.update_totals()}))},update_totals:function(){var d=0,t=0,r=0,a=0,n=0;e(".orderitems tbody tr:not(.no-items)").each((function(){var t,r=e(this),o=1,s=0;t=parseFloat(r.find(".amount input").val()),r.find(".quantity").length&&(o=parseFloat(r.find(".quantity input").val())),d+=t*o,r.find(".tax").length&&(s=parseFloat(r.find(".tax input").val()),isNaN(s)||edd_vars.taxes_included||(t+=s,a+=s)),n+=t*o})),e(".orderadjustments tbody tr:not(.no-items)").each((function(){var d=e(this),o=0;switch(d.data("adjustment")){case"credit":o=parseFloat(d.find("input.credit-amount",d).val()),r+=o,n-=o;break;case"discount":o=parseFloat(d.find("input.discount-amount",d).val()),"percent"===d.find("input.discount-type").val()?e(".orderitems tbody tr:not(.no-items)").each((function(){var d=e(this).find(".amount .value").text(),r=1;e(this).find(".quantity").length&&(r=parseFloat(e(this).find(".quantity").text()));var s=parseFloat((d*=r)/100*o);if(e(this).find(".tax").length){var i=parseFloat(e(this).find(".tax .value").text()),c=parseFloat(i/100*o);a-=c,n-=c}t+=s,n-=s})):(r+=o,n-=o)}})),isNaN(n)&&(n=0),isNaN(d)&&(d=0),isNaN(a)&&(a=0),isNaN(t)&&(t=0),isNaN(r)&&(r=0),e(" .edd-order-subtotal .value").html(d.toFixed(edd_vars.currency_decimals)),e(" .edd-order-discounts .value").html(t.toFixed(edd_vars.currency_decimals)),e(" .edd-order-adjustments .value").html(r.toFixed(edd_vars.currency_decimals)),e(" .edd-order-taxes .value").html(a.toFixed(edd_vars.currency_decimals)),e(" .edd-order-total .value ").html(n.toFixed(edd_vars.currency_decimals))},validate:function(){e("#edd-add-order-form").on("submit",(function(){if(e("#publishing-action .spinner").css("visibility","visible"),e(".orderitems tr.no-items").is(":visible")?e("#edd-add-order-no-items-error").slideDown():e("#edd-add-order-no-items-error").slideUp(),e(".order-customer-info").is(":visible")?e("#edd-add-order-customer-error").slideDown():e("#edd-add-order-customer-error").slideUp(),e(".notice").is(":visible"))return e("#publishing-action .spinner").css("visibility","hidden"),!1}))},filters:function(){e(".edd_countries_filter").on("change",(function(){var d=e(this),t={action:"edd_get_shop_states",country:d.val(),nonce:d.data("nonce"),field_name:"edd_regions_filter"};return e.post(ajaxurl,t,(function(d){e("select.edd_regions_filter").find("option:gt(0)").remove(),"nostates"!==d&&e(d).find("option:gt(0)").appendTo("select.edd_regions_filter"),e("select.edd_regions_filter").trigger("chosen:updated")})),!1}))}};r(document).ready((function(e){o.init()})),d.default=o}.call(this,t(0),t(0))}});
//# sourceMappingURL=edd-admin-orders.js.map