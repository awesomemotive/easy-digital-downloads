(()=>{var e={575:()=>{},1669:e=>{"use strict";e.exports=jQuery},4342:(e,t,n)=>{"use strict";!function(){var t,s,o,d=0,a=[];for(s=0;s<256;s++)a[s]=(s+256).toString(16).substr(1);function r(){var e=((!t||d+16>i.BUFFER_SIZE)&&(d=0,t=i.randomBytes(i.BUFFER_SIZE)),t.slice(d,d+=16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e}function i(){var e=r();return a[e[0]]+a[e[1]]+a[e[2]]+a[e[3]]+"-"+a[e[4]]+a[e[5]]+"-"+a[e[6]]+a[e[7]]+"-"+a[e[8]]+a[e[9]]+"-"+a[e[10]]+a[e[11]]+a[e[12]]+a[e[13]]+a[e[14]]+a[e[15]]}i.BUFFER_SIZE=4096,i.bin=r,i.clearBuffer=function(){t=null,d=0},i.test=function(e){return"string"==typeof e&&/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},"undefined"!=typeof crypto?o=crypto:"undefined"!=typeof window&&void 0!==window.msCrypto&&(o=window.msCrypto),o=o||n(575),e.exports=i,i.randomBytes=function(){if(o){if(o.randomBytes)return o.randomBytes;if(o.getRandomValues)return"function"!=typeof Uint8Array.prototype.slice?function(e){var t=new Uint8Array(e);return o.getRandomValues(t),Array.from(t)}:function(e){var t=new Uint8Array(e);return o.getRandomValues(t),t}}return function(e){var t,n=[];for(t=0;t<e;t++)n.push(Math.floor(256*Math.random()));return n}}()}()},9431:e=>{"use strict";e.exports=function(e,t,n,s){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,d=isFinite(+t)?Math.abs(t):0,a=void 0===s?",":s,r=void 0===n?".":n,i="";return i=(d?function(e,t){if(-1===(""+e).indexOf("e"))return+(Math.round(e+"e+"+t)+"e-"+t);var n=(""+e).split("e"),s="";return+n[1]+t>0&&(s="+"),(+(Math.round(+n[0]+"e"+s+(+n[1]+t))+"e-"+t)).toFixed(t)}(o,d).toString():""+Math.round(o)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,a)),(i[1]||"").length<d&&(i[1]=i[1]||"",i[1]+=new Array(d-i[1].length+1).join("0")),i.join(r)}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var d=t[s]={exports:{}};return e[s](d,d.exports,n),d.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{find:()=>r});var t={};n.r(t),n.d(t,{find:()=>g,findNext:()=>f,findPrevious:()=>h,isTabbableIndex:()=>u});const s=n(9431),o=class{constructor(e={}){const{currency_decimals:t,decimal_separator:n,thousands_separator:s}=edd_vars;this.config={precision:t,decimalSeparator:n,thousandSeparator:s,...e}}format(e){let t=e;"number"!=typeof e&&(t=parseFloat(e)),isNaN(t)&&(t=0);const{precision:n,decimalSeparator:o,thousandSeparator:d}=this.config;return s(t,n,o,d)}unformat(e){const{decimalSeparator:t,thousandSeparator:n}=this.config;"string"!=typeof e&&(e=String(e));const s=e.replace(n,"").replace(t,"."),o=parseFloat(s);return isNaN(o)?0:o}absint(e){const t=this.unformat(e);return t>=0?t:-1*t}},d=class{constructor(e={}){const{currency:t,currency_sign:n,currency_pos:s,currency_decimals:d,decimal_separator:a,thousands_separator:r}=edd_vars;this.config={currency:t,currencySymbol:n,currencySymbolPosition:s,precision:d,decimalSeparator:a,thousandSeparator:r,...e},this.number=new o(this.config)}format(e,t=!0){const{currencySymbol:n,currencySymbolPosition:s}=this.config,o=e<0;let d=this.number.format(e),a="";switch(o&&(d=this.number.format(-1*e)),s){case"before":a=n+d;break;case"after":a=d+n}return!0===o&&!1===t&&(a=`-${a}`),a}unformat(e){const{currencySymbol:t}=this.config,n=e.replace(t,"");return this.number.unformat(n)}};function a(e){return e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0}function r(e,{sequential:t=!1}={}){const n=e.querySelectorAll(function(e){return[e?'[tabindex]:not([tabindex^="-"])':"[tabindex]","a[href]","button:not([disabled])",'input:not([type="hidden"]):not([disabled])',"select:not([disabled])","textarea:not([disabled])",'iframe:not([tabindex^="-"])',"object","embed","area[href]","[contenteditable]:not([contenteditable=false])"].join(",")}(t));return Array.from(n).filter((e=>{if(!a(e))return!1;const{nodeName:t}=e;return"AREA"!==t||function(e){const t=e.closest("map[name]");if(!t)return!1;const n=e.ownerDocument.querySelector('img[usemap="#'+t.name+'"]');return!!n&&a(n)}(e)}))}function i(e){const t=e.getAttribute("tabindex");return null===t?0:parseInt(t,10)}function u(e){return-1!==i(e)}function c(e,t){return{element:e,index:t}}function l(e){return e.element}function m(e,t){const n=i(e.element),s=i(t.element);return n===s?e.index-t.index:n-s}function p(e){return e.filter(u).map(c).sort(m).map(l).reduce(function(){const e={};return function(t,n){const{nodeName:s,type:o,checked:d,name:a}=n;if("INPUT"!==s||"radio"!==o||!a)return t.concat(n);const r=e.hasOwnProperty(a);if(!d&&r)return t;if(r){const n=e[a];t=t.filter((e=>e!==n))}return e[a]=n,t.concat(n)}}(),[])}function g(e){return p(r(e))}function h(e){return p(r(e.ownerDocument.body)).reverse().find((t=>e.compareDocumentPosition(t)&e.DOCUMENT_POSITION_PRECEDING))}function f(e){return p(r(e.ownerDocument.body)).find((t=>e.compareDocumentPosition(t)&e.DOCUMENT_POSITION_FOLLOWING))}const y={focusable:e,tabbable:t};var b=n(1669);const v={disable_search_threshold:13,search_contains:!0,inherit_select_classes:!0,single_backstroke_delete:!1,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option,no_results_text:edd_vars.no_results_text},x=e=>{e instanceof b||(e=b(e));let t=v;return e.data("search-type")&&delete t.disable_search_threshold,{...t,width:e.css("width")}};var w=n(1669);const T=wp.Backbone.View.extend({events:{"keydown input":"handleTabBehavior","keydown textarea":"handleTabBehavior","focus input":"onFocus","focus textarea":"onFocus","focus select":"onFocus","change input":"onChange","change textarea":"onChange","change select":"onChange","input input":"onChange","input textarea":"onChange","input select":"onChange"},preinitialize(){this.focusedEl=null,this.focusedElCaretPos=0,wp.Backbone.View.prototype.preinitialize.apply(this,arguments)},addEvents(e){this.delegateEvents({...this.events,...e})},handleTabBehavior(e){const{keyCode:t,shiftKey:n,target:s}=e;if(9!==t)return;const o=y.tabbable.find(this.el);if(!o.length)return;const d=o[0],a=o[o.length-1];let r;r=n&&s===d?a:n||s!==a?n?y.tabbable.findPrevious(s):y.tabbable.findNext(s):d,void 0!==r?(this.focusedEl=r,this.focusedElCaretPos=r.value.length):(this.focusedEl=null,this.focusedElCaretPos=0)},onFocus(e){this.focusedEl=e.target},onChange(e){const{target:t,keyCode:n}=e;if(void 0===typeof n||9!==n)try{t.selectionStart&&(this.focusedElCaretPos=t.selectionStart)}catch(e){this.focusedElCaretPos=t.value.length}},prepare(){return this.model?{...this.model.toJSON(),state:this.model.get("state").toJSON()}:{}},render(){return wp.Backbone.View.prototype.render.apply(this,arguments),this.initializeSelects(),this.setFocus(),this},initializeSelects(){const e=this.el.querySelectorAll(".edd-select-chosen");_.each(e,(e=>{w(e).chosen({...x(w(e)),width:"100%"})}))},setFocus(){const{el:e,focusedEl:t,focusedElCaretPos:n}=this;if(null==t)return;let s=null;if(""!==t.id?s=`#${t.id}`:""!==t.name?s=`[name="${t.name}"]`:t.classList.length>0&&(s=`.${[...t.classList].join(".")}`),null===s)return;const o=e.querySelector(s);if(o){o.focus();try{o.setSelectionRange&&o.setSelectionRange(n,n)}catch(e){}}}});var I=n(1669);const j=T.extend({initialize(){this.$el.dialog({position:{my:"top center",at:"center center-25%"},classes:{"ui-dialog":"edd-dialog"},closeText:edd_vars.closeText,width:"350px",modal:!0,resizable:!1,draggable:!1,autoOpen:!1,create:function(){I(this).css("maxWidth","90vw")}})},openDialog(){return this.$el.dialog("open"),this},closeDialog(e){return e&&e.preventDefault&&e.preventDefault(),this.$el.dialog("close"),this.undelegateEvents(),this}});var C=n(1669);const A=j.extend({el:"#edd-admin-order-copy-download-link-dialog",template:wp.template("edd-admin-order-copy-download-link"),initialize(){j.prototype.initialize.apply(this,arguments),this.link=!1,this.addEvents({"click #close":"closeDialog"}),this.fetchLink.call(this)},prepare(){const{link:e}=this;return{link:e}},render(){T.prototype.render.apply(this,arguments);const{el:e,link:t}=this;!1!==t&&""!==t&&e.querySelector("#link").select()},fetchLink(){const{orderId:e,productId:t,priceId:n}=this.options;C.ajax({type:"POST",url:ajaxurl,data:{action:"edd_get_file_download_link",payment_id:e,download_id:t,price_id:n}}).done((e=>{e=e.trim(),["-1","-2","-3","-4",""].includes(e)?this.link="":this.link=e.trim()})).done((()=>this.render()))}}),k=T.extend({tagName:"tr",template:wp.template("edd-admin-order-item"),events:{"click .delete":"onDelete","click .copy-download-link":"onCopyDownloadLink"},initialize(){this.listenTo(this.model,"change",this.render)},prepare(){const{model:e,options:t}=this,{state:n}=t,{currency:s}=n.get("formatters"),o=e.getSubtotal(),d=e.getDiscountAmount(),a=e.get("_isAdjustingManually"),r=e.getTax();return{...T.prototype.prepare.apply(this,arguments),discount:d,amountCurrency:s.format(e.get("amount")),subtotal:o,subtotalCurrency:s.format(o),tax:r,taxCurrency:s.format(r),total:e.getTotal(),config:{isAdjustingManually:a},adjustments:e.get("adjustments").toJSON()}},onDelete(e){e.preventDefault();const{model:t,options:n}=this,{state:s}=n;s.get("items").remove(t),s.get("items").updateAmounts()},onCopyDownloadLink(e){e.preventDefault();const{options:t,model:n}=this;new A({orderId:n.get("orderId"),productId:n.get("productId"),priceId:n.get("priceId")}).openDialog().render()}}),D=wp.Backbone.View.extend({tagName:"tr",template:wp.template("edd-admin-order-no-items"),prepare(){const{model:e,options:t}=this,{state:n}=this.options,s=!0===n.get("hasQuantity")?4:3;return{...T.prototype.prepare.apply(this,arguments),config:{colspan:s}}}}),S=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__items",initialize(){const{state:e}=this.options,t=e.get("items");e.get("adjustments"),this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.remove)},render(){const{state:e}=this.options,t=e.get("items");this.views.remove(),0===t.length?this.views.set(new D({...this.options})):_.each(t.models,(e=>this.add(e)))},add(e){this.views.add(new k({...this.options,model:e}))},remove(e){let t=null;this.views.get().forEach((n=>{const{model:s}=n;s.get("id")===e.id&&(t=n)})),null!==t&&t.remove(),0===this.views.get().length&&this.views.set(new D({...this.options}))}}),B=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__subtotal",template:wp.template("edd-admin-order-subtotal"),initialize(){const{state:e}=this.options;this.listenTo(e.get("items"),"add remove change",this.render),this.listenTo(e.get("adjustments"),"add remove",this.render)},prepare(){const{state:e}=this.options,{currency:t,number:n}=e.get("formatters"),s=!0===e.get("hasQuantity")?2:1,o=e.getSubtotal();return{state:e.toJSON(),config:{colspan:s},subtotal:o,subtotalCurrency:t.format(o)}}}),E=T.extend({tagName:"tr",className:"is-expanded",events:{"click .delete":"onDelete"},initialize(){switch(T.prototype.initialize.apply(this),this.model.get("type")){case"credit":case"fee":this.template=wp.template("edd-admin-order-adjustment");break;default:this.template=wp.template("edd-admin-order-adjustment-discount")}this.listenTo(this.model,"change",this.render)},prepare(){const{model:e,options:t}=this,{state:n}=this.options,{currency:s,number:o}=n.get("formatters"),d=!0===n.get("hasQuantity")?2:1;let a;"order_item"===e.get("objectType")&&(a=_.first(n.get("items").filter((t=>void 0!==t.get("adjustments").findWhere({objectId:e.get("objectId")})))));const r=e.getAmount(),i=e.getTotal();return{...T.prototype.prepare.apply(this,arguments),config:{colspan:d},total:i,subtotal:r,orderItem:!!a&&a.toJSON(),totalCurrency:s.format(i),subtotalCurrency:s.format(r)}},onDelete(e){e.preventDefault();const{state:t}=this.options;t.get("adjustments").remove(this.model),t.get("items").updateAmounts()}}),N=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__adjustments",initialize(){const{state:e}=this.options,t=e.get("items"),n=e.get("adjustments");this.listenTo(e,"change:hasTax",this.render),this.listenTo(t,"change",this.render),this.listenTo(n,"add",this.render),this.listenTo(n,"remove",this.remove)},render(){const e=this.getAdjustments();this.views.remove(),_.each(e,(e=>this.add(e)))},add(e){this.views.add(new E({...this.options,model:e}))},remove(e){let t=null;const n=this.views.get();n&&(n.forEach((n=>{const{model:s}=n;s.id===e.id&&(t=n)})),null!==t&&t.remove())}}),M=N.extend({getAdjustments(){const{state:e}=this.options;return e.get("adjustments").filter((e=>["discount","fee"].includes(e.get("type"))))}}),O=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__tax",template:wp.template("edd-admin-order-tax"),events:{"click #notice-tax-change .notice-dismiss":"onDismissTaxRateChange","click #notice-tax-change .update-amounts":"onUpdateAmounts"},initialize(){const{state:e}=this.options;this.listenTo(e,"change:hasTax",this.render),this.listenTo(e.get("items"),"add remove change",this.render),this.listenTo(e.get("adjustments"),"add remove",this.render)},prepare(){const{state:e}=this.options,{currency:t,number:n}=e.get("formatters"),s=!0===e.get("hasQuantity")?2:1,o=e.getTax(),d=e.hasNewTaxRate(),a=[...e.get("items").models,...e.get("adjustments").getByType("fee")];return{state:{...e.toJSON(),hasNewTaxRate:d},config:{colspan:s},tax:o,taxCurrency:t.format(o),hasTaxableItems:a.length>0}},onDismissTaxRateChange(){const{state:e}=this.options;e.set("hasTax",e.get("hasTax")),e.trigger("change:hasTax")},onUpdateAmounts(e){e.preventDefault();const{state:t}=this.options;t.get("adjustments").getByType("fee").forEach((e=>{e.updateTax()})),t.get("items").updateAmounts().done((()=>{this.onDismissTaxRateChange()}))}}),F=N.extend({getAdjustments(){const{state:e}=this.options;return e.get("adjustments").getByType("credit")}}),z=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__total",template:wp.template("edd-admin-order-total"),initialize(){const{state:e}=this.options;this.listenTo(e,"change:hasTax",this.render),this.listenTo(e.get("items"),"add remove change",this.render),this.listenTo(e.get("adjustments"),"add remove",this.render)},prepare(){const{state:e}=this.options,{currency:t,number:n}=e.get("formatters"),s=!0===e.get("hasQuantity")?2:1,o=e.getTotal(),d=e.getDiscount(),a=void 0!==e.get("items").findWhere({_isAdjustingManually:!0});return{state:{...e.toJSON(),hasManualAdjustment:a},config:{colspan:s},total:o,discount:d,discountCurrency:t.format(d),totalCurrency:t.format(o)}}}),q=wp.Backbone.View.extend({template:wp.template("edd-admin-order-refund"),tagName:"tr",className:"is-expanded",prepare(){const{model:e,options:t}=this,{state:n}=t,{currency:s}=n.get("formatters");return{config:{colspan:!0===n.get("hasQuantity")?2:1},id:e.get("id"),number:e.get("number"),dateCreated:e.get("dateCreatedi18n"),totalCurrency:s.format(e.get("total"))}}}),R=wp.Backbone.View.extend({tagName:"tbody",className:"edd-order-overview-summary__refunds",template:wp.template("edd-admin-order-refunds"),render(){const{state:e}=this.options,{models:t}=e.get("refunds");_.each(t,(e=>this.views.add(new q({...this.options,model:e}))))}}),P=wp.Backbone.View.extend({el:"#edd-order-overview-summary",render(){return this.views.add(new S(this.options)),this.views.add(new B(this.options)),this.views.add(new M(this.options)),this.views.add(new O(this.options)),this.views.add(new F(this.options)),this.views.add(new z(this.options)),this.views.add(new R(this.options)),this}});var V=n(1669),L=n(1669);const U=function(e){e.tooltip({content:function(){return V(this).prop("title")},tooltipClass:"edd-ui-tooltip",position:{my:"bottom",at:"top-10",collision:"flipfit"},hide:{duration:200},show:{duration:200}})};L(document).ready((function(e){U(e(".edd-help-tip"))}));var $=n(4342),Q=n.n($);const W=Backbone.Model.extend({defaults:{id:0,objectId:0,objectType:"",typeId:0,type:"",description:"",subtotal:0,tax:0,total:0,dateCreated:"",dateModified:"",uuid:""},getAmount(){return this.get("subtotal")},getTax(){return this.get("tax")},getTotal(){return this.get("subtotal")+this.get("tax")},updateTax(){const e=this.get("state"),t=e.get("hasTax");if("none"===t||""===t.country||""===t.rate)return;const{number:n}=e.get("formatters"),s=t.rate/100;e.get("adjustments").getByType("fee").forEach((e=>{if(!1===e.get("isTaxable"))return;const t=e.getAmount(),o=n.unformat(t*s);e.set("tax",o)}))}}),J=W.extend({defaults:{...W.prototype.defaults,type:"discount"},idAttribute:"typeId",getAmount(){let e=0;const t=this.get("state");if(!1===t.get("isAdding"))return W.prototype.getAmount.apply(this,arguments);const{models:n}=t.get("items"),{number:s}=t.get("formatters");return n.forEach((t=>{const n=t.get("adjustments").findWhere({typeId:this.get("typeId")});void 0!==n&&(e+=s.unformat(s.format(n.get("subtotal"))))})),e},getTotal(){return this.getAmount()}}),H=Backbone.Collection.extend({comparator:"type",initialize(){this.getByType=this.getByType.bind(this)},model(e,t){let n;return n="discount"===e.type?new J(e,t):new W(e,t),n},modelId:e=>`${e.type}-${e.typeId}-${e.description}`,has(e){return void 0!==this.findWhere({typeId:e.get("typeId")})},getByType(e){return this.where({type:e})}}),Z=Backbone.Model.extend({defaults:{id:0,orderId:0,productId:0,productName:"",priceId:null,cartIndex:0,type:"download",status:"",statusLabel:"",quantity:1,amount:0,subtotal:0,discount:0,tax:0,total:0,dateCreated:"",dateModified:"",uuid:"",amountManual:0,taxManual:0,subtotalManual:0,_isAdjustingManually:!1,adjustments:new H},getSubtotal(e=!1){const t=this.get("state"),n=this.get("subtotal");return!1===t.get("isAdding")?n:!0===t.hasInclusiveTax()&&!1===e?n-this.getTax():n},getDiscountAmount(){let e=0;const t=this.get("adjustments").getByType("discount");return 0===t.length?this.get("discount"):(t.forEach((t=>{e+=+t.get("subtotal")})),e)},getTax(){const e=this.get("state"),t=this.get("tax");if(!1===e.get("isAdding"))return t;const{number:n}=e.get("formatters");return n.unformat(n.format(t))},getTotal(){const e=this.get("state");return!1===e.get("isAdding")?this.get("total"):!0===e.hasInclusiveTax()?this.get("subtotal")-this.getDiscountAmount():this.get("subtotal")-this.getDiscountAmount()+this.getTax()},getAmounts({country:e="",region:t="",products:n=[],discountIds:s=[]}){const{nonces:{edd_admin_order_get_item_amounts:o}}=window.eddAdminOrderOverview,{productId:d,priceId:a,quantity:r,amount:i,tax:u,subtotal:c}=_.clone(this.attributes),l=document.getElementById("customer_id")?document.getElementById("customer_id").value:0;return wp.ajax.send("edd-admin-order-get-item-amounts",{data:{nonce:o,productId:d,priceId:a,quantity:r,amount:i,tax:u,subtotal:c,country:e,region:t,customerId:l,products:_.uniq([...n,{id:d,quantity:r,options:{price_id:a}}],(function({id:e,options:{price_id:t}}){return`${e}_${t}`})),discounts:_.uniq(s)}})},setAmounts({amount:e=0,discount:t=0,tax:n=0,subtotal:s=0,total:o=0}){!0===this.get("_isAdjustingManually")?this.set({discount:t}):this.set({amount:e,discount:t,tax:n,subtotal:s,total:o})}});var G=n(1669);const K=j.extend({el:"#edd-admin-order-add-item-dialog",template:wp.template("edd-admin-order-form-add-order-item"),initialize(){j.prototype.initialize.apply(this,arguments),this.addEvents({"change #download":"onChangeDownload","change #quantity":"onChangeQuantity","change #auto-calculate":"onAutoCalculateToggle","keyup #amount":"onChangeAmount","keyup #tax":"onChangeTax","keyup #subtotal":"onChangeSubtotal","click #set-address":"onSetAddress","submit form":"onAdd"});const{state:e}=this.options,t=Q()();this.model=new Z({id:t,orderId:t,state:e,error:!1}),this.listenTo(this.model,"change",this.render),this.listenTo(e,"change:isFetching",this.render),this.listenTo(e.get("items"),"add",this.closeDialog)},prepare(){const{model:e,options:t}=this,{state:n}=t,{number:s}=n.get("formatters"),o=e.get("quantity");let d=s.format(e.get("amount")*o),a=s.format(e.get("tax")*o),r=s.format(e.get("subtotal")*o);!0===e.get("_isAdjustingManually")&&(d=e.get("amountManual"),a=e.get("taxManual"),r=e.get("subtotalManual"));const i=!1===n.get("isFetching")&&!0===n.get("items").has(e),u=e.get("_isAdjustingManually"),c=e.get("error"),l=T.prototype.prepare.apply(this,arguments);return{...l,amountManual:d,taxManual:a,subtotalManual:r,state:{...l.state,isAdjustingManually:u,isDuplicate:i,error:c}}},onChangeDownload(e){const{target:{options:t,selectedIndex:n}}=e,{model:s,options:o}=this,{state:d}=o,{number:a}=d.get("formatters"),r=t[n];let i=r.value,u=null;const c=i.split("_");i=parseInt(c[0]),c[1]&&(u=parseInt(c[1])),d.set("isFetching",!0),s.set({productId:i,priceId:u,productName:r.text,error:!1}),s.getAmounts({country:d.getTaxCountry(),region:d.getTaxRegion(),products:d.get("items").map((e=>({id:e.get("productId"),quantity:e.get("quantity"),options:{price_id:e.get("priceId")}}))),discountIds:d.get("adjustments").pluck("typeId")}).fail((({message:e})=>{d.set("isFetching",!1),s.set({error:e,productId:0,priceId:null,productName:""})})).then((e=>{const{amount:t,tax:n,subtotal:o,total:r}=e;s.set({amount:t,tax:n,subtotal:o,total:r,amountManual:a.format(t),taxManual:a.format(n),subtotalManual:a.format(o)}),d.set("isFetching",!1)}))},onChangeQuantity(e){this.model.set("quantity",parseInt(e.target.value))},onChangeAmount(e){this.model.set("amountManual",e.target.value)},onChangeTax(e){this.model.set("taxManual",e.target.value)},onChangeSubtotal(e){this.model.set("subtotalManual",e.target.value)},onAutoCalculateToggle(e){e.preventDefault(),this.model.set({_isAdjustingManually:!e.target.checked})},onSetAddress(e){e.preventDefault(),this.closeDialog();const t=G('[href="#edd_general_address"]');t&&(t.trigger("click"),G("#edd_order_address_country").trigger("focus"))},onAdd(e){e.preventDefault();const{model:t,options:n}=this,{state:s}=n,{number:o}=s.get("formatters");if(s.set("isFetching",!0),!0===t.get("_isAdjustingManually"))t.set({amount:o.unformat(t.get("amountManual")),tax:o.unformat(t.get("taxManual")),subtotal:o.unformat(t.get("subtotalManual"))});else{const e=t.get("quantity");t.set({tax:t.get("tax")*e,subtotal:t.get("subtotal")*e})}const d=s.get("items");d.add(t,{silent:!0}),d.updateAmounts().fail((({message:e})=>{d.remove(t,{silent:!0}),s.set("isFetching",!1),t.set("error",e)})).done((()=>{this.stopListening(t),d.trigger("add",t),s.set("isFetching",!1)}))}}),X=j.extend({el:"#edd-admin-order-add-discount-dialog",template:wp.template("edd-admin-order-form-add-order-discount"),events:{"submit form":"onAdd","change #discount":"onChangeDiscount"},initialize(){j.prototype.initialize.apply(this,arguments);const{state:e}=this.options;this.model=new J({id:Q()(),typeId:Q()(),state:e}),this.listenTo(this.model,"change",this.render),this.listenTo(e.get("adjustments"),"add",this.closeDialog)},prepare(){const{model:e,options:t}=this,{state:n}=t,s=n.get("adjustments").has(e);return{...T.prototype.prepare.apply(this,arguments),_isDuplicate:s}},onChangeDiscount(e){const{target:{selectedIndex:t,options:n}}=e,{model:s}=this;e.preventDefault();const o=n[t],d=o.dataset;if(""===o.value)return s.set(J.prototype.defaults);s.set({typeId:parseInt(o.value),description:d.code})},onAdd(e){e.preventDefault();const{model:t,options:n}=this,{state:s}=n;s.set("isFetching",!0);const o=s.get("items"),d=s.get("adjustments");d.add(t,{silent:!0}),o.updateAmounts().done((()=>{this.stopListening(t),d.trigger("add",t),s.set("isFetching",!1)}))}});var Y=n(1669);const ee=j.extend({el:"#edd-admin-order-add-adjustment-dialog",template:wp.template("edd-admin-order-form-add-order-adjustment"),initialize(){j.prototype.initialize.apply(this,arguments),this.addEvents({"change #object_type":"onChangeObjectType",'change [name="type"]':"onChangeType","keyup #amount":"onChangeAmount","change #no-tax":"onHasTaxToggle","click #set-address":"onSetAddress","keyup #description":"onChangeDescription","submit form":"onAdd"});const{state:e}=this.options;this.model=new W({id:Q()(),objectId:Q()(),typeId:Q()(),objectType:"order",type:"fee",amountManual:"",isTaxed:!0,state:e}),this.listenTo(this.model,"change",this.render),this.listenTo(e.get("adjustments"),"add",this.closeDialog)},prepare(){const{model:e,options:t}=this,{state:n}=t;return{...T.prototype.prepare.apply(this,arguments),orderItems:n.get("items").models.map((e=>({id:e.get("id"),productName:e.get("productName")})))}},onChangeObjectType(e){const{target:{options:t,selectedIndex:n}}=e,s=t[n],o=s.value;let d=this.model.get("objectId");"order_item"===o?(d=s.dataset.orderItemId,this.model.set({objectId:d,objectType:o})):this.model.set({objectType:o,objectId:d})},onChangeType(e){const t=e.target.value;this.model.set("type",t),"credit"===t&&(this.model.set("objectId",0),this.model.set("objectType","order"))},onChangeAmount(e){const{target:t}=e;e.preventDefault();const{state:n}=this.options,{number:s}=n.get("formatters"),o=t.value,d=s.unformat(o);let a=0;const r=n.get("hasTax");!0===this.model.get("isTaxed")&&"fee"===this.model.get("type")&&"none"!==r&&""!==r.country&&""!==r.rate&&(a=d*(r.rate/100)),this.model.set({amountManual:o,subtotal:d,total:d,tax:s.unformat(s.format(a))})},onHasTaxToggle(e){e.preventDefault();const t=e.target.checked,n={isTaxed:t};!1===t&&(n.tax=0),this.model.set(n)},onSetAddress(e){e.preventDefault(),this.closeDialog();const t=Y('[href="#edd_general_address"]');t&&(t.trigger("click"),Y("#edd_order_address_country").trigger("focus"))},onChangeDescription(e){this.model.set("description",e.target.value)},onAdd(e){e.preventDefault();const{model:t,options:n}=this,{state:s}=n,o=s.get("adjustments"),d=s.get("items");if("order_item"===t.get("objectType")){const e=d.findWhere({id:t.get("objectId")});e.get("adjustments").add(t),e.trigger("change"),t.set("objectType","order_item")}else t.set("objectType","order");o.add(t),this.stopListening(t)}});var te=n(1669);const ne=wp.Backbone.View.extend({el:"#edd-order-overview-actions",template:wp.template("edd-admin-order-actions"),events:{"click #add-item":"onAddOrderItem","click #add-discount":"onAddOrderDiscount","click #add-adjustment":"onAddOrderAdjustment"},render(){return wp.Backbone.View.prototype.render.apply(this,arguments),U(te(".edd-help-tip")),this},onAddOrderItem(e){e.preventDefault(),new K(this.options).openDialog().render()},onAddOrderDiscount(e){e.preventDefault(),new X(this.options).openDialog().render()},onAddOrderAdjustment(e){e.preventDefault(),new ee(this.options).openDialog().render()}});var se=n(1669);const oe=wp.Backbone.View.extend({el:"#edd-order-overview",events:{"click .toggle-row":"onToggleRow"},render(){return this.views.add(new P(this.options)),document.getElementById("edd-order-overview-actions")&&this.views.add(new ne(this.options)),this},onToggleRow(e){e.preventDefault(),se(e.target).closest("tr").toggleClass("is-expanded")}});var de=n(1669);const ae=Backbone.Collection.extend({model:Z,preinitialize(e,t){this.options=t},has(e){return this.filter((t=>t.get("productId")+"_"+t.get("priceId")==e.get("productId")+"_"+e.get("priceId"))).length>0},updateAmounts(){const{options:e}=this,{state:t}=e,n=t.get("items"),s=new Backbone.Collection(t.get("adjustments").getByType("discount")),o={country:t.getTaxCountry(),region:t.getTaxRegion(),products:n.map((e=>({id:e.get("productId"),quantity:e.get("quantity"),options:{price_id:e.get("priceId")}}))),discountIds:s.pluck("typeId")},d=[];return n.models.forEach((e=>{const t=e.getAmounts(o);t.done((({adjustments:t})=>{const n=t.map((t=>new J({...t,id:Q()(),objectId:e.get("id")}))),s=e.get("adjustments").filter((e=>["fee","credit"].includes(e.type)));e.set("adjustments",new H([...n,...s]))})).done((t=>e.setAmounts(t))),d.push(t)})),de.when.apply(de,d)}}),re=Backbone.Model.extend({defaults:{id:0,number:"",total:0,dateCreated:"",dateCreatedi18n:""}}),ie=Backbone.Collection.extend({model:re}),ue=Backbone.Model.extend({defaults:{isAdding:!1,isFetching:!1,hasQuantity:!1,hasTax:!1,items:[],adjustments:[],refunds:[],formatters:{currency:new d,number:new o}},getTaxCountry(){return!1!==this.get("hasTax")?this.get("hasTax").country:""},getTaxRegion(){return!1!==this.get("hasTax")?this.get("hasTax").region:""},getSubtotal(e=!1){if(!1===this.get("isAdding"))return this.get("order").subtotal;const{models:t}=this.get("items");return t.reduce(((t,n)=>t+ +n.getSubtotal(e)),0)},getDiscount(){return!1===this.get("isAdding")?this.get("order").discount:this.get("adjustments").getByType("discount").reduce(((e,t)=>e+ +t.getAmount()),0)},getTax(){if(!1===this.get("isAdding"))return this.get("order").tax;const e=this.get("items").models,t=this.getFeesTax();return e.reduce(((e,t)=>e+ +t.getTax()),t)},getFeesTax(){return!1===this.get("isAdding")?this.get("order").tax:this.get("adjustments").getByType("fee").reduce(((e,t)=>e+ +t.getTax()),0)},getTotal(){if(!1===this.get("isAdding"))return this.get("order").total;const{models:e}=this.get("adjustments"),t=e.reduce(((e,t)=>["discount","credit"].includes(t.get("type"))?e-+t.getAmount():e+ +t.get("subtotal")),this.getSubtotal(!0));return!0===this.hasInclusiveTax()?t+this.getFeesTax():t+this.getTax()},hasNewTaxRate(){const e=this.get("hasTax");if(!1===e)return!1;const t=this.previous("hasTax");return!_.isEqual(e,t)},hasInclusiveTax(){return this.get("hasTax").inclusive}});var ce=n(1669);const le=new o;function me(){let e=0,t=0,n=0,s=!1,o=ce("#edd-refund-order-dialog .edd-order-item-refund-input"),d=ce("#edd-refund-order-dialog .edd-order-item-refund-input.readonly");o.prop("readonly",!0),ce("#edd-refund-order-dialog .edd-order-item-refund-quantity").each((function(){if(!parseInt(ce(this).val()))return;const s=ce(this).closest(".refunditem");if(!s.find(".edd-order-item-refund-checkbox").prop("checked"))return void s.removeClass("refunded");let o=0,d=le.unformat(s.find(".edd-order-item-refund-subtotal").val());s.find(".edd-order-item-refund-tax").length&&(o=le.unformat(s.find(".edd-order-item-refund-tax").val()));let a=d+o;s.find(".column-total span").text(le.format(a)),s.data("credit")&&(d*=-1,o*=-1,a*=-1),s.data("orderItem")&&(e+=d),t+=o,n+=a})),parseFloat(n)>0&&(s=!0),ce("#edd-refund-submit-subtotal-amount").text(le.format(e)),ce("#edd-refund-submit-tax-amount").text(le.format(t)),ce("#edd-refund-submit-total-amount").text(le.format(n)),ce("#edd-submit-refund-submit").attr("disabled",!s),o.prop("readonly",!1),d.prop("readonly",!0)}let pe;ce(document.body).on("click",".edd-refund-order",(function(e){e.preventDefault(),ce(this);var t={action:"edd_generate_refund_form",order_id:ce('input[name="edd_payment_id"]').val()};ce.ajax({type:"POST",data:t,url:ajaxurl,success:function(e){let t="";return t=e.success?e.html:e.message,ce("#edd-refund-order-dialog").dialog({position:{my:"top center",at:"center center-25%"},width:"75%",modal:!0,resizable:!1,draggable:!1,classes:{"ui-dialog":"edd-dialog"},closeText:edd_vars.closeText,open:function(e,n){ce(this).html(t)},close:function(e,t){ce(this).html(""),ce(this).hasClass("did-refund")&&location.reload()}}),!1}}).fail((function(e){return ce("#edd-refund-order-dialog").dialog({position:{my:"top center",at:"center center-25%"},width:"75%",modal:!0,resizable:!1,draggable:!1}).html(e.message),!1}))})),ce(document.body).on("click",".ui-widget-overlay",(function(e){ce("#edd-refund-order-dialog").dialog("close")})),ce(document.body).on("change","#edd-refund-order-dialog #cb-select-all-1",(function(){const e=ce(".edd-order-item-refund-checkbox"),t=ce(this).prop("checked");e.each((function(){ce(this).prop("checked",t).trigger("change")}))})),ce(document.body).on("change",".edd-order-item-refund-checkbox",(function(){const e=ce(this).parent().parent(),t=e.find(".edd-order-item-refund-quantity");t.length&&(ce(this).prop("checked")?t.trigger("change"):(e.find(".edd-order-item-refund-input").prop("disabled",!0),me()))})),ce(document.body).on("change","#edd-refund-order-dialog .edd-order-item-refund-input",(function(){let e=ce(this).closest(".refunditem"),t=e.find(".edd-order-item-refund-quantity"),n=parseInt(t.val());if(n>0?e.addClass("refunded"):e.removeClass("refunded"),ce(this).hasClass("edd-order-item-refund-quantity")){e.find(".edd-order-item-refund-input:not(.edd-order-item-refund-quantity)").prop("disabled",0===n),n>0&&t.prop("disabled",!1);let s=e.find(".edd-order-item-refund-subtotal"),o=e.find(".edd-order-item-refund-tax"),d=le.unformat(s.data("original")),a=o.length?le.unformat(o.data("original")):0,r=parseInt(t.data("max")),i=d/r*n,u=o.length?a/r*n:0;i>parseFloat(s.data("max"))&&(i=s.data("max")),o.length&&u>parseFloat(o.data("max"))&&(u=o.data("max")),s.val(le.format(i)),o.length&&o.val(le.format(u))}me()})),ce(document.body).on("click","#edd-submit-refund-submit",(function(e){e.preventDefault(),ce(".edd-submit-refund-message").removeClass("success").removeClass("fail"),ce(this).removeClass("button-primary").attr("disabled",!0).addClass("updating-message"),ce("#edd-submit-refund-status").hide();var t={action:"edd_process_refund_form",data:ce("#edd-submit-refund-form").serialize(),order_id:ce('input[name="edd_payment_id"]').val()};ce.ajax({type:"POST",data:t,url:ajaxurl,success:function(e){const t=ce(".edd-submit-refund-message"),n=ce(".edd-submit-refund-url");e.success?(t.text(e.data.message).addClass("success"),n.attr("href",e.data.refund_url).show(),ce("#edd-submit-refund-status").show(),n.focus(),ce("#edd-refund-order-dialog").addClass("did-refund")):(t.html(e.data).addClass("fail"),n.hide(),ce("#edd-submit-refund-status").show(),ce("#edd-submit-refund-submit").attr("disabled",!1).removeClass("updating-message").addClass("button-primary"))}}).fail((function(e){const t=ce(".edd-submit-refund-message"),n=ce(".edd-submit-refund-url"),s=e.responseJSON;return t.text(s.data).addClass("fail"),n.hide(),ce("#edd-submit-refund-status").show(),ce("#edd-submit-refund-submit").attr("disabled",!1).removeClass("updating-message").addClass("button-primary"),!1}))})),ce(document.body).on("click",".refund-items .toggle-row",(function(){ce(this).closest("tr").toggleClass("is-expanded")})),(()=>{if(!window.eddAdminOrderOverview)return;const{isAdding:e,isRefund:t,hasTax:n,hasQuantity:s,hasDiscounts:a,order:r,items:i,adjustments:u,refunds:c}=window.eddAdminOrderOverview,l=new d({currency:r.currency,currencySymbol:r.currencySymbol}),m=new ue({isAdding:"1"===e,isRefund:"1"===t,hasTax:"0"!==n&&n,hasQuantity:"1"===s,hasDiscounts:"1"===a,formatters:{currency:l,number:new o},order:r});m.set({items:new ae(null,{state:m}),adjustments:new H(null,{state:m}),refunds:new ie(null,{state:m})}),pe=new oe({state:m}),i.forEach((e=>{const t=new H(e.adjustments),n=new Z({...e,adjustments:t,state:m});m.get("items").add(n)})),u.forEach((e=>{m.get("adjustments").add({state:m,...e})})),c.forEach((e=>{m.get("refunds").add({state:m,...e})}))})();const ge=pe;var he=n(1669);const fe=function(e){!function(t){t(e)}(he)};var ye=n(1669);let _e={addresses:{0:{address:"",address2:"",city:"",region:"",postal_code:"",country:""}}};fe((()=>{function e(e,t,n){const s={action:"edd_get_shop_states",country:e.val(),nonce:e.data("nonce"),field_name:t,field_id:n};return ye.post(ajaxurl,s)}function t(e){const t=ye("#edd_order_address_region");ye("#edd_order_address_region_chosen").remove(),"nostates"===e?t.replaceWith('<input type="text" name="edd_order_address[region]" id="edd_order_address_region" value="" class="wide-fat" style="max-width: none; width: 100%;" />'):(t.replaceWith(e),ye("#edd_order_address_region").chosen(x(ye("#edd_order_address_region"))))}function n(){e(ye(this),"edd_order_address[region]","edd_order_address_region").done(t)}(()=>{const{state:e}=ge.options;if(!1===e.get("hasTax"))return;if(!1===e.get("isAdding"))return;const t=document.getElementById("edd_order_address_country"),n=document.getElementById("edd_order_address_region");function s(){const t=ye("#edd_order_address_country").val(),n=ye("#edd_order_address_region").val(),s=document.getElementById("customer_id")?document.getElementById("customer_id").value:0,o=document.getElementById("edd_get_tax_rate_nonce").value;wp.ajax.send("edd_get_tax_rate",{data:{nonce:o,country:t,region:n,customerId:s},success(s){let{tax_rate:o}=s;o*=100,e.set("hasTax",{...e.get("hasTax"),country:t,region:n,rate:o})},error(){e.set("hasTax","none")}})}t&&n&&(ye("#edd_order_address_country").on("change",_.debounce(s,250)),ye("#edd-order-address").on("change","#edd_order_address_region",s),ye("#edd-order-address").on("keyup","#edd_order_address_region",_.debounce(s,250)))})(),ye(".edd-payment-change-customer-input").on("change",(function(){const e={action:"edd_customer_addresses",customer_id:ye(this).val(),nonce:ye("#edd_add_order_nonce").val()};return ye.post(ajaxurl,e,(function(e){const{success:t,data:n}=e;t?(_e={..._e,...n,addresses:{..._e.addresses,...n.addresses}},n.html?(ye(".customer-address-select-wrap").show(),ye(".customer-address-select-wrap .edd-form-group__control").html(n.html)):ye(".customer-address-select-wrap").hide()):ye(".customer-address-select-wrap").hide()}),"json"),!1})),ye(document.body).on("change",".customer-address-select-wrap .add-order-customer-address-select",(function(){const s=ye(this).val(),o=_e.addresses[s];return ye('#edd-add-order-form input[name="edd_order_address[address]"]').val(o.address),ye('#edd-add-order-form input[name="edd_order_address[address2]"]').val(o.address2),ye('#edd-add-order-form input[name="edd_order_address[postal_code]"]').val(o.postal_code),ye('#edd-add-order-form input[name="edd_order_address[city]"]').val(o.city),ye('#edd-add-order-form input[name="edd_order_address[address_id]"]').val(s),ye("#edd_order_address_country").off("change",n),ye("#edd_order_address_country").val(o.country).trigger("change").trigger("chosen:updated"),e(ye("#edd_order_address_country"),"edd_order_address[region]","edd_order_address_region").done(t).done((e=>{ye("#edd_order_address_region").val(o.region).trigger("change").trigger("chosen:updated")})),ye("#edd_order_address_country").on("change",n),!1})),ye("#edd_order_address_country").on("change",n)}));var be=n(1669);fe((()=>{be(".edd-payment-change-customer-input").on("change",(function(){const e={action:"edd_customer_details",customer_id:be(this).val(),nonce:be("#edd_customer_details_nonce").val()};""!==e.customer_id&&(be(".customer-details").css("display","none"),be("#customer-avatar").html('<span class="spinner is-active"></span>'),be.post(ajaxurl,e,(function(e){const{success:t,data:n}=e;t?(be(".customer-details").css("display","flex"),be(".customer-details-wrap").css("display","flex"),be("#customer-avatar").html(n.avatar),be(".customer-name").html(n.name),be(".customer-since span").html(n.date_created_i18n),be(".customer-record a").prop("href",n._links.self)):be(".customer-details-wrap").css("display","none")}),"json"))})),be(".edd-payment-change-customer-input").trigger("change"),be(".edd-order-customer__actions button").on("click",(function(e){e.preventDefault();var t=be(this).hasClass("edd-payment-new-customer"),n=be(this).hasClass("edd-payment-new-customer-cancel");be(this).addClass("active").siblings().removeClass("active"),t?(be(".order-customer-info").hide(),be(".new-customer").show()):n&&(be(".order-customer-info").show(),be(".new-customer").hide()),t=be("#edd-new-customer"),be(".new-customer").is(":visible")?t.val(1):t.val(0)}))}));var ve=n(1669);fe((()=>{const e=ve("#edd-resend-receipt");if(!e.attr("href"))return;const t=".edd-order-resend-receipt-email",n=new URLSearchParams(e.attr("href"));ve(document.body).on("change",t,(function(){n.set("email",ve(this).val()),e.attr("href",decodeURIComponent(n.toString()))})),ve(t).trigger("change"),e.on("click",(function(){return confirm(edd_vars.resend_receipt)}))}));var xe=n(1669);fe((()=>{window.eddAdminOrderOverview&&(ge.render(),(()=>{const e=ge.options.state.get("items"),t=document.getElementById("edd-add-order-no-items-error"),n=document.getElementById("edd-add-order-customer-error"),s=document.getElementById("customer_id"),o=document.getElementById("edd_new_customer_email");function d(d){let a=!1;t&&(0===e.length?(t.style.display="block",a=!0):t.style.display="none"),n&&("0"===s.value&&""===o.value?(n.style.display="block",a=!0):n.style.display="none",!0===a&&d.preventDefault())}["edd-add-order-form","edd-edit-order-form"].forEach((e=>{const t=document.getElementById(e);t&&t.addEventListener("submit",d)})),e.on("add",(function(){t.style.display="none"})),xe(s).on("change",(e=>{"0"!==e.target.value&&(n.style.display="none")})),o&&o.addEventListener("input",(e=>{""!==e.target.value&&(n.style.display="none")}))})()),0!==xe(".edit-post-editor-regions__header").length&&xe("div.update-nag, div#update-nag").insertAfter(xe(".edit-post-editor-regions__header"))}))})()})();