!function(e){var d={};function t(r){if(d[r])return d[r].exports;var n=d[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=d,t.d=function(e,d,r){t.o(e,d)||Object.defineProperty(e,d,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,d){if(1&d&&(e=t(e)),8&d)return e;if(4&d&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&d&&"string"!=typeof e)for(var n in e)t.d(r,n,function(d){return e[d]}.bind(null,n));return r},t.n=function(e){var d=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(d,"a",d),d},t.o=function(e,d){return Object.prototype.hasOwnProperty.call(e,d)},t.p="",t(t.s=22)}({0:function(e,d,t){"use strict";t.d(d,"a",function(){return n});const r={disable_search_threshold:13,search_contains:!0,inherit_select_classes:!0,single_backstroke_delete:!1,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option,no_results_text:edd_vars.no_results_text},n=e=>{let d=r;return e.data("search-type")&&delete d.disable_search_threshold,d}},22:function(e,d,t){"use strict";t.r(d);var r=t(0);(()=>{const e=document.querySelector(".edd-override");if(!e)return;const d=document.querySelector('input[name="edd-order-download-is-overrideable"]');$(document).on("edd-admin-add-order-download",function(t){_.each(document.querySelectorAll(".overridable input"),e=>e.addEventListener("keyup",a.update_totals)),a.update_totals(),e.disabled=1==d.value}),e.addEventListener("click",function(){this.disabled=!0,d.value=1,_.each(document.querySelectorAll(".overridable input"),e=>e.readOnly=!1);const e=document.createElement("input");e.name="edd_add_order_override",e.value=!0,e.type="hidden",document.getElementById("edd-add-order-form").appendChild(e)})})();const n={};var o={init:function(){this.add_order_item(),this.add_adjustment(),this.remove(),this.fetch_addresses(),this.select_address(),this.recalculate_total(),this.validate(),this.filters()},add_order_item:function(){const e=$(".edd-add-order-item-button");$("#edd-order-items").on("click","h3 .edd-metabox-title-action",function(e){e.preventDefault(),$("#edd-order-items").children(".edd-add-download-to-purchase").slideToggle()}),e.prop("disabled","disabled"),$(".edd-order-add-download-select").on("change",function(){e.removeAttr("disabled")}),e.on("click",function(e){e.preventDefault();const d=$(".edd-order-add-download-select"),t=$(".edd-add-download-to-purchase .spinner"),r={action:"edd_add_order_item",nonce:$("#edd_add_order_nonce").val(),country:$(".edd-order-address-country").val(),region:$(".edd-order-address-region").val(),download:d.val(),quantity:$(".edd-add-order-quantity").val(),editable:$('input[name="edd-order-download-is-overrideable"]').val()};t.css("visibility","visible"),$.post(ajaxurl,r,function(e){const{success:d,data:r}=e;d&&($(".orderitems .no-items").hide(),$(".orderitems tbody").append(r.html),o.update_totals(),o.reindex(),t.css("visibility","hidden"),$(document).trigger("edd-admin-add-order-download",e))},"json")})},add_adjustment:function(){$("#edd-order-adjustments").on("click","h3 .edd-metabox-title-action",function(e){e.preventDefault(),$("#edd-order-adjustments").children(".edd-add-adjustment-to-purchase").slideToggle()}),$(".edd-order-add-adjustment-select").on("change",function(){const e=$(this).val();$(".edd-add-adjustment-to-purchase li.fee, .edd-add-adjustment-to-purchase li.discount, .edd-add-adjustment-to-purchase li.fee, .edd-add-adjustment-to-purchase li.credit").hide(),$("."+e,".edd-add-adjustment-to-purchase").show()}),$(".edd-add-order-adjustment-button").on("click",function(e){e.preventDefault();const d={action:"edd_add_adjustment_to_order",nonce:$("#edd_add_order_nonce").val(),type:$(".edd-order-add-adjustment-select").val(),adjustment_data:{fee:$(".edd-order-add-fee-select").val(),discount:$(".edd-order-add-discount-select").val(),credit:{description:$(".edd-add-order-credit-description").val(),amount:$(".edd-add-order-credit-amount").val()}}},t=$(".edd-add-adjustment-to-purchase .spinner");t.css("visibility","visible"),$.post(ajaxurl,d,function(e){const{success:d,data:r}=e;d&&($(".orderadjustments .no-items").hide(),$(".orderadjustments tbody").append(r.html),o.update_totals(),o.reindex(),t.css("visibility","hidden"))},"json")})},remove:function(){$(document.body).on("click",".orderitems .remove-item, .orderadjustments .remove-item",function(e){e.preventDefault();const d=$(this),t=d.parents("tbody");return d.parents("tr").remove(),1===$("tr",t).length&&$(".no-items",t).show(),o.update_totals(),o.reindex(),!1})},fetch_addresses:function(){$(".edd-payment-change-customer-input").on("change",function(){const e={action:"edd_customer_addresses",customer_id:$(this).val(),nonce:$("#edd_add_order_nonce").val()};return $.post(ajaxurl,e,function(e){const{success:d,data:t}=e;d?(n.customer_address_ajax_result=t,t.html?($(".customer-address-select-wrap").html(t.html).show(),$(".customer-address-select-wrap select").each(function(){const e=$(this);e.chosen(Object(r.a)(e))})):$(".customer-address-select-wrap").html("").hide()):$(".customer-address-select-wrap").html("").hide()},"json"),!1})},select_address:function(){$(document.body).on("change",".customer-address-select-wrap .add-order-customer-address-select",function(){const e=$(this).val(),d=$("#edd-add-order-form select#edd_order_address_country"),t=n.customer_address_ajax_result.addresses[e];$('#edd-add-order-form input[name="edd_order_address[address]"]').val(t.address),$('#edd-add-order-form input[name="edd_order_address[address2]"]').val(t.address2),$('#edd-add-order-form input[name="edd_order_address[postal_code]"]').val(t.postal_code),$('#edd-add-order-form input[name="edd_order_address[city]"]').val(t.city),d.val(t.country).trigger("chosen:updated"),$('#edd-add-order-form input[name="edd_order_address[address_id]"]').val(e);const r={action:"edd_get_shop_states",country:d.val(),nonce:$(".add-order-customer-address-select").data("nonce"),field_name:"edd_order_address_region"};return $.post(ajaxurl,r,function(e){$("select#edd_order_address_region").find("option:gt(0)").remove(),"nostates"!==e&&$(e).find("option:gt(0)").appendTo("select#edd_order_address_region"),$("select#edd_order_address_region").trigger("chosen:updated"),$("select#edd_order_address_region").val(t.region).trigger("chosen:updated")}),!1}),$(".edd-order-address-country").on("change",function(){const e=$(this),d={action:"edd_get_shop_states",country:e.val(),nonce:e.data("nonce"),field_name:"edd-order-address-country"};return $.post(ajaxurl,d,function(e){$("select.edd-order-address-region").find("option:gt(0)").remove(),"nostates"!==e&&$(e).find("option:gt(0)").appendTo("select.edd-order-address-region"),$("select.edd-order-address-region").trigger("chosen:updated")}).done(function(e){o.recalculate_taxes()}),!1}),$(".edd-order-address-region").on("change",function(){o.recalculate_taxes()})},reindex:function(){let e=0;$(".orderitems tbody tr:not(.no-items), .orderadjustments tbody tr:not(.no-items)").each(function(){$(this).attr("data-key",e),$(this).find("input").each(function(){let d=$(this).attr("name");d&&(d=d.replace(/\[(\d+)\]/,"["+parseInt(e)+"]"),$(this).attr("name",d))}),e++})},recalculate_taxes:function(){$("#publishing-action .spinner").css("visibility","visible");const e={action:"edd_add_order_recalculate_taxes",country:$(".edd-order-address-country").val(),region:$(".edd-order-address-region").val(),nonce:$("#edd_add_order_nonce").val()};$.post(ajaxurl,e,function(e){const{success:d,data:t}=e;if(d&&""!==t.tax_rate){const e=parseFloat(t.tax_rate);$(".orderitems tbody tr:not(.no-items)").each(function(){const d=parseFloat($(".amount .value",this).text())*($(".quantity .value",this).length>0?parseFloat($(".column-quantity .value",this).text()):1);let r=0;if(t.prices_include_tax){const t=parseFloat(d/(1+e));r=parseFloat(d-t)}else r=d*e;const n=edd_vars.currency,o=edd_vars.currency_decimals,a=d+r;$(".tax .value",this).text(r.toLocaleString(n,{style:"decimal",currency:n,minimumFractionDigits:o,maximumFractionDigits:o})),$(".total .value",this).text(a.toLocaleString(n,{style:"decimal",currency:n,minimumFractionDigits:o,maximumFractionDigits:o}))})}},"json").done(function(){$("#publishing-action .spinner").css("visibility","hidden"),o.update_totals()})},recalculate_total:function(){$("#edd-add-order").on("click","#edd-order-recalc-total",function(){o.update_totals()})},update_totals:function(){let e=0,d=0,t=0,r=0,n=0;$(".orderitems tbody tr:not(.no-items)").each(function(){let d,t,o=$(this),a=1,s=0;d=parseFloat(o.find(".amount input").val()),o.find(".quantity").length&&(a=parseFloat(o.find(".quantity input").val())),e+=d*a,o.find(".tax").length&&(s=parseFloat(o.find(".tax input").val()),isNaN(s)||edd_vars.taxes_included||(d+=s,r+=s)),n+=t=d*a}),$(".orderadjustments tbody tr:not(.no-items)").each(function(){let e,o=$(this),a=0;switch(e=o.data("adjustment")){case"credit":a=parseFloat(o.find("input.credit-amount",o).val()),t+=a,n-=a;break;case"discount":a=parseFloat(o.find("input.discount-amount",o).val()),"percent"===o.find("input.discount-type").val()?$(".orderitems tbody tr:not(.no-items)").each(function(){let e=$(this).find(".amount .value").text(),t=1;$(this).find(".quantity").length&&(t=parseFloat($(this).find(".quantity").text()));const o=parseFloat((e*=t)/100*a);if($(this).find(".tax").length){const e=parseFloat($(this).find(".tax .value").text()),d=parseFloat(e/100*a);r-=d,n-=d}d+=o,n-=o}):(t+=a,n-=a)}}),isNaN(n)&&(n=0),isNaN(e)&&(e=0),isNaN(r)&&(r=0),isNaN(d)&&(d=0),isNaN(t)&&(t=0),$(" .edd-order-subtotal .value").html(e.toFixed(edd_vars.currency_decimals)),$(" .edd-order-discounts .value").html(d.toFixed(edd_vars.currency_decimals)),$(" .edd-order-adjustments .value").html(t.toFixed(edd_vars.currency_decimals)),$(" .edd-order-taxes .value").html(r.toFixed(edd_vars.currency_decimals)),$(" .edd-order-total .value ").html(n.toFixed(edd_vars.currency_decimals))},validate:function(){$("#edd-add-order-form").on("submit",function(){if($("#publishing-action .spinner").css("visibility","visible"),$(".orderitems tr.no-items").is(":visible")?$("#edd-add-order-no-items-error").slideDown():$("#edd-add-order-no-items-error").slideUp(),$(".order-customer-info").is(":visible")?$("#edd-add-order-customer-error").slideDown():$("#edd-add-order-customer-error").slideUp(),$(".notice").is(":visible"))return $("#publishing-action .spinner").css("visibility","hidden"),!1})},filters:function(){$(".edd_countries_filter").on("change",function(){const e=$(this),d={action:"edd_get_shop_states",country:e.val(),nonce:e.data("nonce"),field_name:"edd_regions_filter"};return $.post(ajaxurl,d,function(e){$("select.edd_regions_filter").find("option:gt(0)").remove(),"nostates"!==e&&$(e).find("option:gt(0)").appendTo("select.edd_regions_filter"),$("select.edd_regions_filter").trigger("chosen:updated")}),!1})}};jQuery(document).ready(function(e){o.init()});var a=d.default=o}});