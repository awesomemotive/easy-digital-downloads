(()=>{"use strict";var e={311:e=>{e.exports=jQuery}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}(()=>{const e=Backbone.Model.extend({defaults:{id:"",country:"",region:"",global:!0,amount:0,status:"active",unsaved:!1,selected:!1},formattedAmount:function(){let e=0;return this.get("amount")&&(e=parseFloat(this.get("amount")).toFixed(2)),`${e}%`}}),t=Backbone.Collection.extend({model:e,initialize:function(){this.showAll=!1,this.selected=[]}}),n=wp.Backbone.View.extend({template:wp.template("edd-admin-tax-rates-table-meta"),events:{'change [type="checkbox"]':"selectAll"},selectAll:function(e){const t=e.target.checked;_.each(this.collection.models,(e=>{e.set("selected",t),this.collection.selected.push(e.cid)}))}}),o=wp.Backbone.View.extend({tagName:"tr",className:"edd-tax-rate-row edd-tax-rate-row--is-empty",template:wp.template("edd-admin-tax-rates-table-row-empty")}),s=wp.Backbone.View.extend({tagName:"tr",className:function(){return"edd-tax-rate-row edd-tax-rate-row--"+this.model.get("status")},template:wp.template("edd-admin-tax-rates-table-row"),events:{"click .remove":"removeRow","click .activate":"activateRow","click .deactivate":"deactivateRow",'change [type="checkbox"]':"selectRow"},initialize:function(){this.listenTo(this.model,"change",this.render)},render:function(){this.$el.html(this.template({...this.model.toJSON(),formattedAmount:this.model.formattedAmount()})),this.$el.attr("class",_.result(this,"className"))},removeRow:function(e){e.preventDefault(),this.collection.remove(this.model)},activateRow:function(e){e.preventDefault();const{i18n:t}=eddTaxRates;if(this.collection.where({region:this.model.get("region"),country:this.model.get("country"),global:""===this.model.get("region"),status:"active"}).length>0){const e=""===this.model.get("region")?"":": "+this.model.get("region"),i=this.model.get("country")+e;alert(t.duplicateRate.replace("%s",`"${i}"`))}else this.model.set("status","active")},deactivateRow:function(e){e.preventDefault(),this.model.set("status","inactive")},selectRow:function(e){e.target.checked?this.collection.selected.push(this.model.cid):this.collection.selected=_.reject(this.collection.selected,(e=>e===this.model.cid))}}),a=wp.Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"filtered change",this.filtered)},render:function(){if(this.views.remove(),0===this.collection.models.length)return this.views.add(new o);_.each(this.collection.models,(e=>{this.views.add(new s({collection:this.collection,model:e}))}))},filtered:function(){this.collection.where({status:"inactive"}).length!==this.collection.models.length||this.collection.showAll?this.render():this.views.add(new o)}});var l=i(311);const c={disable_search_threshold:13,search_contains:!0,inherit_select_classes:!0,single_backstroke_delete:!1,placeholder_text_single:edd_vars.one_option,placeholder_text_multiple:edd_vars.one_or_more_option,no_results_text:edd_vars.no_results_text},d=e=>{!e instanceof l&&(e=l(e));let t=c;return e.data("search-type")&&delete t.disable_search_threshold,{...t,width:e.css("width")}};var r=i(311);const h=wp.Backbone.View.extend({initialize:function(e){_.extend(this,e)},render:function(){this.global||("nostates"===this.states?this.setElement('<input type="text" id="tax_rate_region" />'):(this.$el.html(this.states),this.$el.find("select").each((function(){const e=r(this);e.chosen(d(e))}))))}});var u=i(311);const m=wp.Backbone.View.extend({tagName:"tfoot",className:"add-new",template:wp.template("edd-admin-tax-rates-table-add"),events:{"click button":"addTaxRate",keypress:"maybeAddTaxRate","change #tax_rate_country":"setCountry","keyup #tax_rate_region":"setRegion","change #tax_rate_region":"setRegion",'change input[type="checkbox"]':"setGlobal","keyup #tax_rate_amount":"setAmount","change #tax_rate_amount":"setAmount"},initialize:function(){this.model=new e({global:!0,unsaved:!0}),this.listenTo(this.model,"change:country",this.updateRegion),this.listenTo(this.model,"change:global",this.updateRegion)},render:function(){return wp.Backbone.View.prototype.render.apply(this,arguments),this.$el.find("select").each((function(){const e=u(this);e.chosen(d(e))})),this},updateRegion:function(){const e=this,t={action:"edd_get_shop_states",country:this.model.get("country"),nonce:eddTaxRates.nonce,field_name:"tax_rate_region"};u.post(ajaxurl,t,(function(t){e.views.set("#tax_rate_region_wrapper",new h({states:t,global:e.model.get("global")}))}))},setCountry:function(e){this.model.set("country",e.target.options[e.target.selectedIndex].value)},setRegion:function(e){let t=!1;t=e.target.value?e.target.value:e.target.options[e.target.selectedIndex].value,this.model.set("region",t)},setGlobal:function(e){this.model.set("global",e.target.checked),this.model.set("region","")},setAmount:function(e){this.model.set("amount",e.target.value)},maybeAddTaxRate:function(e){13===e.keyCode&&this.addTaxRate(e)},addTaxRate:function(e){e.preventDefault();const{i18n:t}=eddTaxRates;if(this.model.get("country"))if(this.collection.where({region:this.model.get("region"),country:this.model.get("country"),global:""===this.model.get("region"),status:"active"}).length>0){const e=""===this.model.get("region")?"":": "+this.model.get("region"),i=this.model.get("country")+e;alert(t.duplicateRate.replace("%s",`"${i}"`))}else this.model.get("amount")<=0?alert(t.emptyTax):(this.collection.add(_.extend(this.model.attributes,{id:this.model.cid})),this.render(),this.initialize());else alert(t.emptyCountry)}}),g=wp.Backbone.View.extend({tagName:"table",className:"wp-list-table widefat fixed tax-rates",id:"edd_tax_rates",render:function(){this.views.add(new n({tagName:"thead",collection:this.collection})),this.views.add(new a({collection:this.collection})),this.views.add(new m({collection:this.collection})),this.views.add(new n({tagName:"tfoot",collection:this.collection})),this.collection.trigger("filtered")}}),w=wp.Backbone.View.extend({template:wp.template("edd-admin-tax-rates-table-bulk-actions"),events:{"click .edd-admin-tax-rates-table-filter":"filter","change .edd-admin-tax-rates-table-hide input":"showHide"},filter:function(e){e.preventDefault();const t=document.getElementById("edd-admin-tax-rates-table-bulk-actions");_.each(this.collection.selected,(e=>{this.collection.get({cid:e}).set("status",t.value)})),this.collection.trigger("filtered")},showHide:function(e){this.collection.showAll=e.target.checked,document.getElementById("edd_tax_rates").classList.toggle("has-inactive",this.collection.showAll),this.collection.trigger("filtered")}}),p=wp.Backbone.View.extend({el:"#edd-admin-tax-rates",initialize:function(){this.listenTo(this.collection,"add change",this.makeDirty),document.querySelector(".edd-settings-form #submit").addEventListener("click",this.makeClean)},render:function(){this.views.add(new w({collection:this.collection})),this.views.add(new g({collection:this.collection}))},makeDirty:function(){window.onbeforeunload=this.confirmUnload},makeClean:function(){window.onbeforeunload=null},confirmUnload:function(e){return e.preventDefault(),""}});var f,x=i(311);f=()=>{const e=document.getElementById("edd-tax-disabled-notice");e&&(e.classList.add("notice"),e.classList.add("notice-warning"));const i=new p({collection:new t}),n=[];_.each(eddTaxRates.rates,(e=>n.push({id:e.id,country:e.name,region:e.description,global:"country"===e.scope,amount:e.amount,status:e.status}))),i.collection.set(n,{silent:!0}),i.render()},function(e){e(f)}(x)})()})();