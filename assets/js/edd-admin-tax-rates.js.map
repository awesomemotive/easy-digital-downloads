{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./assets/js/admin/settings/tax-rates/collections/tax-rates.js","webpack:///./assets/js/admin/settings/tax-rates/index.js","webpack:///./assets/js/admin/settings/tax-rates/models/tax-rate.js","webpack:///./assets/js/admin/settings/tax-rates/views/bulk-actions.js","webpack:///./assets/js/admin/settings/tax-rates/views/manager.js","webpack:///./assets/js/admin/settings/tax-rates/views/region-field.js","webpack:///./assets/js/admin/settings/tax-rates/views/table-add.js","webpack:///./assets/js/admin/settings/tax-rates/views/table-meta.js","webpack:///./assets/js/admin/settings/tax-rates/views/table-row-empty.js","webpack:///./assets/js/admin/settings/tax-rates/views/table-row.js","webpack:///./assets/js/admin/settings/tax-rates/views/table-rows.js","webpack:///./assets/js/admin/settings/tax-rates/views/table.js","webpack:///./assets/js/utils/chosen.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;;AAEA;AACA;AACA;AAC8C;;AAE9C;AACA;AACA;AACA;AACA;AACA,QAAQ,2DAAO;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF,CAAC;;AAEc,uEAAQ,EAAC;;;;;;;;;;;;;ACvBxB;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AAC2C;AACO;AACT;;AAEzC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,qBAAqB,yDAAO;AAC5B,kBAAkB,iEAAQ;AAC1B,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA,CAAC;;;;;;;;;;;;;AC7CD;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,YAAY,SAAS;AACrB,EAAE;AACF,CAAC;;AAEc,sEAAO,EAAC;;;;;;;;;;;;;ACjCvB;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,IAAI;;AAEJ;AACA,GAAG;;AAEH;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;;AAEA;AACA,EAAE;AACF,CAAC;;AAEc,0EAAW,EAAC;;;;;;;;;;;;;ACtD3B;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AAC+B;AACa;;AAE5C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,sBAAsB,wDAAW;AACjC;AACA,GAAG;;AAEH,sBAAsB,iDAAK;AAC3B;AACA,GAAG;AACH,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA,EAAE;AACF,CAAC;;AAEc,sEAAO,EAAC;;;;;;;;;;;;;AChEvB;AAAA;AAAA;;AAEA;AACA;AACA;AACgD;;AAEhD;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,eAAe,qEAAa;AAC5B,IAAI;AACJ;AACA,EAAE;AACF,CAAC;;AAEc,0EAAW,EAAC;;;;;;;;;;;;;ACrC3B;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AAC8C;AACO;AACL;;AAEhD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA,mBAAmB,2DAAO;AAC1B;AACA;AACA,GAAG;;AAEH;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,qEAAa;AAC3B,GAAG;AACH,EAAE;;AAEF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mDAAmD,8DAAW;AAC9D;AACA;AACA,IAAI;AACJ,GAAG;AACH,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,EAAE;AACF,CAAC;;AAEc,uEAAQ,EAAC;;;;;;;;;;;;;ACrJxB;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH,EAAE;AACF,CAAC;;AAEc,wEAAS,EAAC;;;;;;;;;;;;;AChCzB;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,CAAC;;AAEc,4EAAa,EAAC;;;;;;;;;;;;;AChB7B;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;;AAEA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA,EAAE;AACF,CAAC;;AAEc,uEAAQ,EAAC;;;;;;;;;;;;;AClGxB;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACiD;AACX;;AAEtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8BAA8B,2DAAa;AAC3C;;AAEA;AACA;AACA,uBAAuB,qDAAQ;AAC/B;AACA;AACA,IAAI;AACJ,GAAG;AACH,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,uBAAuB,2DAAa;;AAEpC;AACA,GAAG;AACH;AACA;AACA,EAAE;AACF,CAAC;;AAEc,wEAAS,EAAC;;;;;;;;;;;;;AChEzB;AAAA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACwC;AACA;AACF;;AAEtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,sBAAsB,sDAAS;AAC/B;AACA;AACA,GAAG;;AAEH,sBAAsB,sDAAS;AAC/B;AACA,GAAG;;AAEH,sBAAsB,qDAAQ;AAC9B;AACA,GAAG;;AAEH,sBAAsB,sDAAS;AAC/B;AACA;AACA,GAAG;;AAEH;AACA;AACA,EAAE;AACF,CAAC;;AAEc,oEAAK,EAAC;;;;;;;;;;;;;ACjDrB;AAAA;AAAA;AAAA;;AAEO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY,OAAO;AACnB;AACO;AACP;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"assets/js/edd-admin-tax-rates.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./assets/js/admin/settings/tax-rates/index.js\");\n","/* global Backbone */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport TaxRate from './../models/tax-rate.js';\r\n\r\n/**\r\n * A collection of multiple tax rates.\r\n */\r\nconst TaxRates = Backbone.Collection.extend( {\r\n\t// Map the model.\r\n\tmodel: TaxRate,\r\n\r\n\t/**\r\n\t * Set initial state.\r\n\t */\r\n\tinitialize: function() {\r\n\t\tthis.showAll = false;\r\n\t\tthis.selected = [];\r\n\t},\r\n} );\r\n\r\nexport default TaxRates;\r\n","/* global _, eddTaxRates */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport TaxRate from './models/tax-rate.js';\r\nimport TaxRates from './collections/tax-rates.js';\r\nimport Manager from './views/manager.js';\r\n\r\n/**\r\n * DOM ready.\r\n */\r\ndocument.addEventListener( 'DOMContentLoaded', () => {\r\n\t// Show notice if taxes are not enabled.\r\n\tconst noticeEl = document.getElementById( 'edd-tax-disabled-notice' );\r\n\r\n\tif ( noticeEl ) {\r\n\t\tnoticeEl.classList.add( 'notice' );\r\n\t\tnoticeEl.classList.add( 'notice-warning' );\r\n\t}\r\n\r\n\t// Start manager with a blank collection.\r\n\tconst manager = new Manager( {\r\n\t\tcollection: new TaxRates(),\r\n\t} );\r\n\r\n\tconst rates = [];\r\n\r\n\t// Normalize rate data.\r\n\t_.each( eddTaxRates.rates, ( rate ) => rates.push( {\r\n\t\tid: rate.id,\r\n\t\tcountry: rate.name,\r\n\t\tregion: rate.description,\r\n\t\tglobal: 'country' === rate.scope,\r\n\t\tamount: rate.amount,\r\n\t\tstatus: rate.status,\r\n\t} ) );\r\n\r\n\t// Add initial rates.\r\n\tmanager.collection.set( rates, {\r\n\t\tsilent: true,\r\n\t} );\r\n\r\n\t// Render manager.\r\n\tmanager.render();\r\n} );\r\n","/* global Backbone */\r\n\r\n/**\r\n * Model a tax rate.\r\n */\r\nconst TaxRate = Backbone.Model.extend( {\r\n\tdefaults: {\r\n\t\tid: '',\r\n\t\tcountry: '',\r\n\t\tregion: '',\r\n\t\tglobal: true,\r\n\t\tamount: 0,\r\n\t\tstatus: 'active',\r\n\t\tunsaved: false,\r\n\t\tselected: false,\r\n\t},\r\n\r\n\t/**\r\n\t * Format a rate amount (adds a %)\r\n\t *\r\n\t * @todo This should support dynamic decimal types.\r\n\t */\r\n\tformattedAmount: function() {\r\n\t\tlet amount = 0;\r\n\r\n\t\tif ( this.get( 'amount' ) ) {\r\n\t\t\tamount = parseFloat( this.get( 'amount' ) ).toFixed( 2 );\r\n\t\t}\r\n\r\n\t\treturn `${ amount }%`;\r\n\t},\r\n} );\r\n\r\nexport default TaxRate;\r\n","/* global wp, _ */\r\n\r\n/**\r\n * Apply bulk actions.\r\n */\r\nconst BulkActions = wp.Backbone.View.extend( {\r\n\t// See https://codex.wordpress.org/Javascript_Reference/wp.template\r\n\ttemplate: wp.template( 'edd-admin-tax-rates-table-bulk-actions' ),\r\n\r\n\t// Watch events.\r\n\tevents: {\r\n\t\t'click .edd-admin-tax-rates-table-filter': 'filter',\r\n\t\t'change .edd-admin-tax-rates-table-hide input': 'showHide',\r\n\t},\r\n\r\n\t/**\r\n\t * Bulk actions for selected items.\r\n\t *\r\n\t * Currently only supports changing the status.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tfilter: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// @hack - need to access the DOM directly here because the dropdown is not tied to the button event.\r\n\t\tconst status = document.getElementById( 'edd-admin-tax-rates-table-bulk-actions' );\r\n\r\n\t\t_.each( this.collection.selected, ( cid ) => {\r\n\t\t\tconst model = this.collection.get( {\r\n\t\t\t\tcid: cid,\r\n\t\t\t} );\r\n\r\n\t\t\tmodel.set( 'status', status.value );\r\n\t\t} );\r\n\r\n\t\tthis.collection.trigger( 'filtered' );\r\n\t},\r\n\r\n\t/**\r\n\t * Toggle show active/inactive rates.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tshowHide: function( event ) {\r\n\t\tthis.collection.showAll = event.target.checked;\r\n\r\n\t\t// @hack -- shouldn't access this table directly.\r\n\t\tdocument.getElementById( 'edd_tax_rates' ).classList.toggle( 'has-inactive', this.collection.showAll );\r\n\r\n\t\tthis.collection.trigger( 'filtered' );\r\n\t},\r\n} );\r\n\r\nexport default BulkActions;\r\n","/* global wp */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport Table from './table.js';\r\nimport BulkActions from './bulk-actions.js';\r\n\r\n/**\r\n * Manage tax rates.\r\n */\r\nconst Manager = wp.Backbone.View.extend( {\r\n\t// Append to this element.\r\n\tel: '#edd-admin-tax-rates',\r\n\r\n\t/**\r\n\t * Set bind changes to collection.\r\n\t */\r\n\tinitialize: function() {\r\n\t\tthis.listenTo( this.collection, 'add change', this.makeDirty );\r\n\r\n\t\t// Clear unload confirmation when submitting parent form.\r\n\t\tdocument.querySelector( '.edd-settings-form #submit' ).addEventListener( 'click', this.makeClean );\r\n\t},\r\n\r\n\t/**\r\n\t * Output the manager.\r\n\t */\r\n\trender: function() {\r\n\t\tthis.views.add( new BulkActions( {\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\r\n\t\tthis.views.add( new Table( {\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\t},\r\n\r\n\t/**\r\n\t * Collection has changed so warn the user before exiting.\r\n\t */\r\n\tmakeDirty: function() {\r\n\t\twindow.onbeforeunload = this.confirmUnload;\r\n\t},\r\n\r\n\t/**\r\n\t * When submitting the main form remove the dirty check.\r\n\t */\r\n\tmakeClean: function() {\r\n\t\twindow.onbeforeunload = null;\r\n\t},\r\n\r\n\t/**\r\n\t * Confirm page unload.\r\n\t *\r\n\t * @param {Object} event Close event.\r\n\t */\r\n\tconfirmUnload: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\treturn '';\r\n\t},\r\n} );\r\n\r\nexport default Manager;\r\n","/* global wp, _ */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport { getChosenVars } from 'utils/chosen.js';\r\n\r\nconst RegionField = wp.Backbone.View.extend( {\r\n\t/**\r\n\t * Bind passed arguments.\r\n\t *\r\n\t * @param {Object} options Extra options passed.\r\n\t */\r\n\tinitialize: function( options ) {\r\n\t\t_.extend( this, options );\r\n\t},\r\n\r\n\t/**\r\n\t * Create a list of options.\r\n\t */\r\n\trender: function() {\r\n\t\tif ( this.global ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( 'nostates' === this.states ) {\r\n\t\t\tthis.setElement( '<input type=\"text\" id=\"tax_rate_region\" />' );\r\n\t\t} else {\r\n\t\t\tthis.$el.html( this.states );\r\n\t\t\tthis.$el.find( 'select' ).each( function() {\r\n\t\t\t\tconst el = $( this );\r\n\t\t\t\tel.chosen( getChosenVars( el ) );\r\n\t\t\t} );\r\n\t\t}\r\n\t},\r\n} );\r\n\r\nexport default RegionField;\r\n","/* global wp */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport TaxRate from './../models/tax-rate.js';\r\nimport RegionField from './../views/region-field.js';\r\nimport { getChosenVars } from 'utils/chosen.js';\r\n\r\n/**\r\n * Add a new rate \"form\".\r\n */\r\nconst TableAdd = wp.Backbone.View.extend( {\r\n\t// Use <tfoot>\r\n\ttagName: 'tfoot',\r\n\r\n\t// Set class.\r\n\tclassName: 'add-new',\r\n\r\n\t// See https://codex.wordpress.org/Javascript_Reference/wp.template\r\n\ttemplate: wp.template( 'edd-admin-tax-rates-table-add' ),\r\n\r\n\t// Watch events.\r\n\tevents: {\r\n\t\t'click button': 'addTaxRate',\r\n\r\n\t\t'change #tax_rate_country': 'setCountry',\r\n\r\n\t\t// Can be select or input.\r\n\t\t'keyup #tax_rate_region': 'setRegion',\r\n\t\t'change #tax_rate_region': 'setRegion',\r\n\r\n\t\t'change input[type=\"checkbox\"]': 'setGlobal',\r\n\r\n\t\t// Can be click increase or keyboard.\r\n\t\t'keyup #tax_rate_amount': 'setAmount',\r\n\t\t'change #tax_rate_amount': 'setAmount',\r\n\t},\r\n\r\n\t/**\r\n\t * Set initial state and bind changes to model.\r\n\t */\r\n\tinitialize: function() {\r\n\t\tthis.model = new TaxRate( {\r\n\t\t\tglobal: true,\r\n\t\t\tunsaved: true,\r\n\t\t} );\r\n\r\n\t\tthis.listenTo( this.model, 'change:country', this.updateRegion );\r\n\t\tthis.listenTo( this.model, 'change:global', this.updateRegion );\r\n\t},\r\n\r\n\t/**\r\n\t * Render. Only overwritten so we can reinit chosen once cleared.\r\n\t */\r\n\trender: function() {\r\n\t\tthis.$el.html( this.template() );\r\n\t\tthis.$el.find( 'select' ).each( function() {\r\n\t\t\tconst el = $( this );\r\n\t\t\tel.chosen( getChosenVars( el ) );\r\n\t\t} );\r\n\t},\r\n\r\n\t/**\r\n\t * Show a list of states or an input field.\r\n\t */\r\n\tupdateRegion: function() {\r\n\t\tconst self = this;\r\n\r\n\t\tconst data = {\r\n\t\t\taction: 'edd_get_shop_states',\r\n\t\t\tcountry: this.model.get( 'country' ),\r\n\t\t\tnonce: eddTaxRates.nonce,\r\n\t\t\tfield_name: 'tax_rate_region',\r\n\t\t};\r\n\r\n\t\t$.post( ajaxurl, data, function( response ) {\r\n\t\t\tself.views.set( '#tax_rate_region_wrapper', new RegionField( {\r\n\t\t\t\tstates: response,\r\n\t\t\t\tglobal: self.model.get( 'global' ),\r\n\t\t\t} ) );\r\n\t\t} );\r\n\t},\r\n\r\n\t/**\r\n\t * Set a country value.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tsetCountry: function( event ) {\r\n\t\tthis.model.set( 'country', event.target.options[ event.target.selectedIndex ].value );\r\n\t},\r\n\r\n\t/**\r\n\t * Set a region value.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tsetRegion: function( event ) {\r\n\t\tlet value = false;\r\n\r\n\t\tif ( event.target.value ) {\r\n\t\t\tvalue = event.target.value;\r\n\t\t} else {\r\n\t\t\tvalue = event.target.options[ event.target.selectedIndex ].value;\r\n\t\t}\r\n\r\n\t\tthis.model.set( 'region', value );\r\n\t},\r\n\r\n\t/**\r\n\t * Set a global scope.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tsetGlobal: function( event ) {\r\n\t\tthis.model.set( 'global', event.target.checked );\r\n\t},\r\n\r\n\t/**\r\n\t * Set an amount value.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tsetAmount: function( event ) {\r\n\t\tthis.model.set( 'amount', event.target.value );\r\n\t},\r\n\r\n\t/**\r\n\t * Add a single rate when the \"form\" is submitted.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\taddTaxRate: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Merge cid as ID to make this a unique model.\r\n\t\tthis.collection.add( _.extend(\r\n\t\t\tthis.model.attributes,\r\n\t\t\t{\r\n\t\t\t\tid: this.model.cid,\r\n\t\t\t}\r\n\t\t) );\r\n\r\n\t\tthis.render();\r\n\t\tthis.initialize();\r\n\t},\r\n} );\r\n\r\nexport default TableAdd;\r\n","/* global wp, _ */\r\n\r\n/**\r\n * Output a table header and footer.\r\n */\r\nconst TableMeta = wp.Backbone.View.extend( {\r\n\t// See https://codex.wordpress.org/Javascript_Reference/wp.template\r\n\ttemplate: wp.template( 'edd-admin-tax-rates-table-meta' ),\r\n\r\n\t// Watch events.\r\n\tevents: {\r\n\t\t'change [type=\"checkbox\"]': 'selectAll',\r\n\t},\r\n\r\n\t/**\r\n\t * Select all items in the collection.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tselectAll: function( event ) {\r\n\t\tconst checked = event.target.checked;\r\n\r\n\t\t_.each( this.collection.models, ( model ) => {\r\n\t\t\t// Check individual models.\r\n\t\t\tmodel.set( 'selected', checked );\r\n\r\n\t\t\t// Add to global selection.\r\n\t\t\tthis.collection.selected.push( model.cid );\r\n\t\t} );\r\n\t},\r\n} );\r\n\r\nexport default TableMeta;\r\n","/* global wp */\r\n\r\n/**\r\n * Empty tax rates table.\r\n */\r\nconst TableRowEmpty = wp.Backbone.View.extend( {\r\n\t// Insert as a <tr>\r\n\ttagName: 'tr',\r\n\r\n\t// Set class.\r\n\tclassName: 'edd-tax-rate-row edd-tax-rate-row--is-empty',\r\n\r\n\t// See https://codex.wordpress.org/Javascript_Reference/wp.template\r\n\ttemplate: wp.template( 'edd-admin-tax-rates-table-row-empty' ),\r\n} );\r\n\r\nexport default TableRowEmpty;\r\n","/* global wp, _ */\r\n\r\n/**\r\n * A row inside a table of rates.\r\n */\r\nconst TableRow = wp.Backbone.View.extend( {\r\n\t// Insert as a <tr>\r\n\ttagName: 'tr',\r\n\r\n\t// Set class.\r\n\tclassName: function() {\r\n\t\treturn 'edd-tax-rate-row edd-tax-rate-row--' + this.model.get( 'status' );\r\n\t},\r\n\r\n\t// See https://codex.wordpress.org/Javascript_Reference/wp.template\r\n\ttemplate: wp.template( 'edd-admin-tax-rates-table-row' ),\r\n\r\n\t// Watch events.\r\n\tevents: {\r\n\t\t'click .remove': 'removeRow',\r\n\t\t'click .activate': 'activateRow',\r\n\t\t'click .deactivate': 'deactivateRow',\r\n\t\t'change [type=\"checkbox\"]': 'selectRow',\r\n\t},\r\n\r\n\t/**\r\n\t * Bind model to view.\r\n\t */\r\n\tinitialize: function() {\r\n\t\tthis.listenTo( this.model, 'change', this.render );\r\n\t},\r\n\r\n\t/**\r\n\t * Render\r\n\t */\r\n\trender: function() {\r\n\t\tthis.$el.html( this.template( {\r\n\t\t\t...this.model.toJSON(),\r\n\t\t\tformattedAmount: this.model.formattedAmount(),\r\n\t\t} ) );\r\n\r\n\t\t// Ensure the wrapper class has the new name.\r\n\t\tthis.$el.attr( 'class', _.result( this, 'className' ) );\r\n\t},\r\n\r\n\t/**\r\n\t * Remove a rate (can only be done if it has not been saved to the database).\r\n\t *\r\n\t * Don't use this.model.destroy() to avoid sending a DELETE request.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tremoveRow: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.collection.remove( this.model );\r\n\t},\r\n\r\n\t/**\r\n\t * Activate a rate.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tactivateRow: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.model.set( 'status', 'active' );\r\n\t},\r\n\r\n\t/**\r\n\t * Deactivate a rate.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tdeactivateRow: function( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.model.set( 'status', 'inactive' );\r\n\t},\r\n\r\n\t/**\r\n\t * Select or deselect for bulk actions.\r\n\t *\r\n\t * @param {Object} event Event.\r\n\t */\r\n\tselectRow: function( event ) {\r\n\t\tconst checked = event.target.checked;\r\n\r\n\t\tif ( ! checked ) {\r\n\t\t\tthis.collection.selected = _.reject( this.collection.selected, ( cid ) => {\r\n\t\t\t\treturn cid === this.model.cid;\r\n\t\t\t} );\r\n\t\t} else {\r\n\t\t\tthis.collection.selected.push( this.model.cid );\r\n\t\t}\r\n\t},\r\n} );\r\n\r\nexport default TableRow;\r\n","/* global wp, _ */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport TableRowEmpty from './table-row-empty.js';\r\nimport TableRow from './table-row.js';\r\n\r\n/**\r\n * A bunch of rows inside a table of rates.\r\n */\r\nconst TableRows = wp.Backbone.View.extend( {\r\n\t// Insert as a <tbody>\r\n\ttagName: 'tbody',\r\n\r\n\t/**\r\n\t * Bind events to collection.\r\n\t */\r\n\tinitialize: function() {\r\n\t\tthis.listenTo( this.collection, 'add', this.render );\r\n\t\tthis.listenTo( this.collection, 'remove', this.render );\r\n\t\tthis.listenTo( this.collection, 'filtered change', this.filtered );\r\n\t},\r\n\r\n\t/**\r\n\t * Render a collection of rows.\r\n\t */\r\n\trender: function() {\r\n\t\t// Clear to handle sorting.\r\n\t\tthis.views.remove();\r\n\r\n\t\t// Show empty placeholder.\r\n\t\tif ( 0 === this.collection.models.length ) {\r\n\t\t\treturn this.views.add( new TableRowEmpty() );\r\n\t\t}\r\n\r\n\t\t// Add items.\r\n\t\t_.each( this.collection.models, ( rate ) => {\r\n\t\t\tthis.views.add( new TableRow( {\r\n\t\t\t\tcollection: this.collection,\r\n\t\t\t\tmodel: rate,\r\n\t\t\t} ) );\r\n\t\t} );\r\n\t},\r\n\r\n\t/**\r\n\t * Show an empty state if all items are deactivated.\r\n\t */\r\n\tfiltered: function() {\r\n\t\tconst disabledRates = this.collection.where( {\r\n\t\t\tstatus: 'inactive',\r\n\t\t} );\r\n\r\n\t\t// Check if all rows are invisible, and show the \"No Items\" row if so\r\n\t\tif ( disabledRates.length === this.collection.models.length && ! this.collection.showAll ) {\r\n\t\t\tthis.views.add( new TableRowEmpty() );\r\n\r\n\t\t// Possibly re-render the view\r\n\t\t} else {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t},\r\n} );\r\n\r\nexport default TableRows;\r\n","/* global wp */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport TableMeta from './table-meta.js';\r\nimport TableRows from './table-rows.js';\r\nimport TableAdd from './table-add.js';\r\n\r\n/**\r\n * Manage the tax rate rows in a table.\r\n */\r\nconst Table = wp.Backbone.View.extend( {\r\n\t// Render as a <table> tag.\r\n\ttagName: 'table',\r\n\r\n\t// Set class.\r\n\tclassName: 'wp-list-table widefat fixed tax-rates',\r\n\r\n\t// Set ID.\r\n\tid: 'edd_tax_rates',\r\n\r\n\t/**\r\n\t * Output a table with a header, body, and footer.\r\n\t */\r\n\trender: function() {\r\n\t\tthis.views.add( new TableMeta( {\r\n\t\t\ttagName: 'thead',\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\r\n\t\tthis.views.add( new TableRows( {\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\r\n\t\tthis.views.add( new TableAdd( {\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\r\n\t\tthis.views.add( new TableMeta( {\r\n\t\t\ttagName: 'tfoot',\r\n\t\t\tcollection: this.collection,\r\n\t\t} ) );\r\n\r\n\t\t// Trigger the `filtered` action to show/hide rows accordingly\r\n\t\tthis.collection.trigger( 'filtered' );\r\n\t},\r\n} );\r\n\r\nexport default Table;\r\n","/* global edd_vars */\r\n\r\nexport const chosenVars = {\r\n\tdisable_search_threshold: 13,\r\n\tsearch_contains: true,\r\n\tinherit_select_classes: true,\r\n\tsingle_backstroke_delete: false,\r\n\tplaceholder_text_single: edd_vars.one_option,\r\n\tplaceholder_text_multiple: edd_vars.one_or_more_option,\r\n\tno_results_text: edd_vars.no_results_text,\r\n};\r\n\r\n/**\r\n * Determine the variables used to initialie Chosen on an element.\r\n *\r\n * @param {Object} el select element.\r\n * @return {Object} Variables for Chosen.\r\n */\r\nexport const getChosenVars = ( el ) => {\r\n\tlet inputVars = chosenVars;\r\n\r\n\t// Ensure <select data-search-type=\"download\"> or similar can use search always.\r\n\t// These types of fields start with no options and are updated via AJAX.\r\n\tif ( el.data( 'search-type' ) ) {\r\n\t\tdelete inputVars.disable_search_threshold;\r\n\t}\r\n\r\n\treturn inputVars;\r\n}\r\n"],"sourceRoot":""}