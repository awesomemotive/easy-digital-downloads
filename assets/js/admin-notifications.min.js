document.addEventListener("alpine:init",()=>{Alpine.store("eddNotifications",{isPanelOpen:!1,notificationsLoaded:!1,numberActiveNotifications:0,activeNotifications:[],inactiveNotifications:[],init:function(){const eddNotifications=this,notificationCountBubble=document.querySelector("#edd-notification-button .edd-number");notificationCountBubble&&notificationCountBubble.classList.remove("edd-hidden"),document.addEventListener("keydown",function(e){"Escape"===e.key&&eddNotifications.closePanel()})},openPanel:function(){const panelHeader=document.getElementById("edd-notifications-header");if(this.notificationsLoaded)return this.isPanelOpen=!0,void(panelHeader&&setTimeout(function(){panelHeader.focus()}));this.isPanelOpen=!0,this.apiRequest("/notifications","GET").then(data=>{this.activeNotifications=data.active,this.inactiveNotifications=data.dismissed,this.notificationsLoaded=!0,panelHeader&&panelHeader.focus()}).catch(error=>{console.log("Notification error",error)})},closePanel:function(){if(this.isPanelOpen){this.isPanelOpen=!1;const notificationButton=document.getElementById("edd-notification-button");notificationButton&&notificationButton.focus()}},apiRequest:function(endpoint,method){return fetch(eddNotificationsVars.restBase+endpoint,{method:method,credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":eddNotificationsVars.restNonce}}).then(response=>response.ok?response.text():Promise.reject(response)).then(data=>data?JSON.parse(data):null)},dismiss:function(notification,index){void 0!==this.activeNotifications[index]&&(notification.target.disabled=!0,notification=this.activeNotifications[index],this.apiRequest("/notifications/"+notification.id,"DELETE").then(response=>{this.activeNotifications.splice(index,1),this.numberActiveNotifications=this.activeNotifications.length}).catch(error=>{console.log("Dismiss error",error)}))}})});