{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./assets/js/frontend/checkout/index.js","webpack:///./assets/js/frontend/checkout/utils.js","webpack:///./assets/js/frontend/edd-ajax.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAAA;AACA;AACA;AAC+C;;AAE/C;;AAEA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACO;AACP;AACA;AACA,EAAE;;AAEF;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,IAAI;AACJ,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,qBAAqB,mEAAiB;AACtC;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;;;;;;;;;;;;;ACtZA;AAAA;AAAA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc;AACd,eAAe;AACf,iCAAiC,OAAO;AACxC;AACA;AACA;AACA,sBAAsB,OAAO;AAC7B,4BAA4B,OAAO;AACnC;AACA;AACA;;;;;;;;;;;;;AChCA;AAAA;AAAA;;AAEA;AACA;AACA;AAC+C;;AAE/C;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;;AAEN;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,MAAM;;AAEN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP;;AAEA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH,GAAG;;AAEH;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAAe;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;;AAEN;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAM;;AAEN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA,GAAG;;AAEH,GAAG;;AAEH;AACA,EAAE;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA,EAAE;;AAEF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ;AACA,KAAK,mEAAiB;AACtB;AACA,IAAI;AACJ,GAAG;AACH,GAAG,mEAAiB;AACpB;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG,mEAAiB;AACpB;AACA,EAAE;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,EAAE;AACF;AACA;;AAEA;;AAEA,oBAAoB,2EAA2E;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"assets/js/edd-ajax.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./assets/js/frontend/edd-ajax.js\");\n","/**\r\n * Internal dependencies.\r\n */\r\nimport { getCreditCardIcon } from './utils.js';\r\n\r\n/* global edd_global_vars */\r\n\r\nlet ajax_tax_count = 0;\r\n\r\n/**\r\n * Recalulate taxes.\r\n *\r\n * @param {string} state State to calculate taxes for.\r\n * @return {Promise}\r\n */\r\nexport function recalculate_taxes( state ) {\r\n\tif ( '1' != edd_global_vars.taxes_enabled ) {\r\n\t\treturn;\r\n\t} // Taxes not enabled\r\n\r\n\tconst $edd_cc_address = jQuery( '#edd_cc_address' );\r\n\r\n\tconst billing_country = $edd_cc_address.find( '#billing_country' ).val(),\r\n\t\tcard_address = $edd_cc_address.find( '#card_address' ).val(),\r\n\t\tcard_address_2 = $edd_cc_address.find( '#card_address_2' ).val(),\r\n\t\tcard_city = $edd_cc_address.find( '#card_city' ).val(),\r\n\t\tcard_state = $edd_cc_address.find( '#card_state' ).val(),\r\n\t\tcard_zip = $edd_cc_address.find( '#card_zip' ).val();\r\n\r\n\tif ( ! state ) {\r\n\t\tstate = card_state;\r\n\t}\r\n\r\n\tconst postData = {\r\n\t\taction: 'edd_recalculate_taxes',\r\n\t\tcard_address: card_address,\r\n\t\tcard_address_2: card_address_2,\r\n\t\tcard_city: card_city,\r\n\t\tcard_zip: card_zip,\r\n\t\tstate: state,\r\n\t\tbilling_country: billing_country,\r\n\t\tnonce: jQuery( '#edd-checkout-address-fields-nonce' ).val(),\r\n\t};\r\n\r\n\tjQuery( '#edd_purchase_submit [type=submit]' ).after( '<span class=\"edd-loading-ajax edd-recalculate-taxes-loading edd-loading\"></span>' );\r\n\r\n\tconst current_ajax_count = ++ajax_tax_count;\r\n\r\n\treturn jQuery.ajax( {\r\n\t\ttype: 'POST',\r\n\t\tdata: postData,\r\n\t\tdataType: 'json',\r\n\t\turl: edd_global_vars.ajaxurl,\r\n\t\txhrFields: {\r\n\t\t\twithCredentials: true,\r\n\t\t},\r\n\t\tsuccess: function( tax_response ) {\r\n\t\t\t// Only update tax info if this response is the most recent ajax call.\r\n\t\t\t// Avoids bug with form autocomplete firing multiple ajax calls at the same time and not\r\n\t\t\t// being able to predict the call response order.\r\n\t\t\tif ( current_ajax_count === ajax_tax_count ) {\r\n\t\t\t\tjQuery( '#edd_checkout_cart_form' ).replaceWith( tax_response.html );\r\n\t\t\t\tjQuery( '.edd_cart_amount' ).html( tax_response.total );\r\n\t\t\t\tconst tax_data = new Object();\r\n\t\t\t\ttax_data.postdata = postData;\r\n\t\t\t\ttax_data.response = tax_response;\r\n\t\t\t\tjQuery( 'body' ).trigger( 'edd_taxes_recalculated', [ tax_data ] );\r\n\t\t\t}\r\n\t\t\tjQuery( '.edd-recalculate-taxes-loading' ).remove();\r\n\t\t},\r\n\t} ).fail( function( data ) {\r\n\t\tif ( window.console && window.console.log ) {\r\n\t\t\tconsole.log( data );\r\n\t\t\tif ( current_ajax_count === ajax_tax_count ) {\r\n\t\t\t\tjQuery( 'body' ).trigger( 'edd_taxes_recalculated', [ tax_data ] );\r\n\t\t\t}\r\n\t\t}\r\n\t} );\r\n}\r\n\r\n// Backwards compatibility. Assign function to global namespace.\r\nwindow.recalculate_taxes = recalculate_taxes;\r\n\r\nwindow.EDD_Checkout = ( function( $ ) {\r\n\t'use strict';\r\n\r\n\tlet $body,\r\n\t\t$form,\r\n\t\t$edd_cart_amount,\r\n\t\tbefore_discount,\r\n\t\t$checkout_form_wrap;\r\n\r\n\tfunction init() {\r\n\t\t$body = $( document.body );\r\n\t\t$form = $( '#edd_purchase_form' );\r\n\t\t$edd_cart_amount = $( '.edd_cart_amount' );\r\n\t\tbefore_discount = $edd_cart_amount.text();\r\n\t\t$checkout_form_wrap = $( '#edd_checkout_form_wrap' );\r\n\r\n\t\t$body.on( 'edd_gateway_loaded', function( e ) {\r\n\t\t\tedd_format_card_number( $form );\r\n\t\t} );\r\n\r\n\t\t$body.on( 'keyup change', '.edd-do-validate .card-number', function() {\r\n\t\t\tedd_validate_card( $( this ) );\r\n\t\t} );\r\n\r\n\t\t$body.on( 'blur change', '.card-name', function() {\r\n\t\t\tconst name_field = $( this );\r\n\r\n\t\t\tname_field.validateCreditCard( function( result ) {\r\n\t\t\t\tif ( result.card_type != null ) {\r\n\t\t\t\t\tname_field.removeClass( 'valid' ).addClass( 'error' );\r\n\t\t\t\t\t$( '#edd-purchase-button' ).attr( 'disabled', 'disabled' );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tname_field.removeClass( 'error' ).addClass( 'valid' );\r\n\t\t\t\t\t$( '#edd-purchase-button' ).removeAttr( 'disabled' );\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t} );\r\n\r\n\t\t// Make sure a gateway is selected\r\n\t\t$body.on( 'submit', '#edd_payment_mode', function() {\r\n\t\t\tconst gateway = $( '#edd-gateway option:selected' ).val();\r\n\t\t\tif ( gateway == 0 ) {\r\n\t\t\t\talert( edd_global_vars.no_gateway );\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Add a class to the currently selected gateway on click\r\n\t\t$body.on( 'click', '#edd_payment_mode_select input', function() {\r\n\t\t\t$( '#edd_payment_mode_select label.edd-gateway-option-selected' ).removeClass( 'edd-gateway-option-selected' );\r\n\t\t\t$( '#edd_payment_mode_select input:checked' ).parent().addClass( 'edd-gateway-option-selected' );\r\n\t\t} );\r\n\r\n\t\t// Validate and apply a discount\r\n\t\t$checkout_form_wrap.on( 'click', '.edd-apply-discount', apply_discount );\r\n\r\n\t\t// Prevent the checkout form from submitting when hitting Enter in the discount field\r\n\t\t$checkout_form_wrap.on( 'keypress', '#edd-discount', function( event ) {\r\n\t\t\tif ( event.keyCode == '13' ) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Apply the discount when hitting Enter in the discount field instead\r\n\t\t$checkout_form_wrap.on( 'keyup', '#edd-discount', function( event ) {\r\n\t\t\tif ( event.keyCode == '13' ) {\r\n\t\t\t\t$checkout_form_wrap.find( '.edd-apply-discount' ).trigger( 'click' );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\t// Remove a discount\r\n\t\t$body.on( 'click', '.edd_discount_remove', remove_discount );\r\n\r\n\t\t// When discount link is clicked, hide the link, then show the discount input and set focus.\r\n\t\t$body.on( 'click', '.edd_discount_link', function( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\t$( '.edd_discount_link' ).parent().hide();\r\n\t\t\t$( '#edd-discount-code-wrap' ).show().find( '#edd-discount' ).focus();\r\n\t\t} );\r\n\r\n\t\t// Hide / show discount fields for browsers without javascript enabled\r\n\t\t$body.find( '#edd-discount-code-wrap' ).hide();\r\n\t\t$body.find( '#edd_show_discount' ).show();\r\n\r\n\t\t// Update the checkout when item quantities are updated\r\n\t\t$body.on( 'change', '.edd-item-quantity', update_item_quantities );\r\n\r\n\t\t$body.on( 'click', '.edd-amazon-logout #Logout', function( e ) {\r\n\t\t\te.preventDefault();\r\n\t\t\tamazon.Login.logout();\r\n\t\t\twindow.location = edd_amazon.checkoutUri;\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction edd_validate_card( field ) {\r\n\t\tconst card_field = field;\r\n\t\tcard_field.validateCreditCard( function( result ) {\r\n\t\t\tconst $card_type = $( '.card-type' );\r\n\r\n\t\t\tif ( result.card_type == null ) {\r\n\t\t\t\t$card_type.removeClass().addClass( 'off card-type' );\r\n\t\t\t\tcard_field.removeClass( 'valid' );\r\n\t\t\t\tcard_field.addClass( 'error' );\r\n\t\t\t} else {\r\n\t\t\t\t$card_type.removeClass( 'off' );\r\n\t\t\t\t$card_type.html( getCreditCardIcon( result.card_type.name ) );\r\n\t\t\t\t$card_type.addClass( result.card_type.name );\r\n\t\t\t\tif ( result.length_valid && result.luhn_valid ) {\r\n\t\t\t\t\tcard_field.addClass( 'valid' );\r\n\t\t\t\t\tcard_field.removeClass( 'error' );\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcard_field.removeClass( 'valid' );\r\n\t\t\t\t\tcard_field.addClass( 'error' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} );\r\n\t}\r\n\r\n\tfunction edd_format_card_number( form ) {\r\n\t\tconst card_number = form.find( '.card-number' ),\r\n\t\t\tcard_cvc = form.find( '.card-cvc' ),\r\n\t\t\tcard_expiry = form.find( '.card-expiry' );\r\n\r\n\t\tif ( card_number.length && 'function' === typeof card_number.payment ) {\r\n\t\t\tcard_number.payment( 'formatCardNumber' );\r\n\t\t\tcard_cvc.payment( 'formatCardCVC' );\r\n\t\t\tcard_expiry.payment( 'formatCardExpiry' );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction apply_discount( event ) {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tconst $this = $( this ),\r\n\t\t\tdiscount_code = $( '#edd-discount' ).val(),\r\n\t\t\tedd_discount_loader = $( '#edd-discount-loader' );\r\n\r\n\t\tif ( discount_code == '' || discount_code == edd_global_vars.enter_discount ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst postData = {\r\n\t\t\taction: 'edd_apply_discount',\r\n\t\t\tcode: discount_code,\r\n\t\t\tform: $( '#edd_purchase_form' ).serialize(),\r\n\t\t};\r\n\r\n\t\t$( '#edd-discount-error-wrap' ).html( '' ).hide();\r\n\t\tedd_discount_loader.show();\r\n\r\n\t\t$.ajax( {\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: 'json',\r\n\t\t\turl: edd_global_vars.ajaxurl,\r\n\t\t\txhrFields: {\r\n\t\t\t\twithCredentials: true,\r\n\t\t\t},\r\n\t\t\tsuccess: function( discount_response ) {\r\n\t\t\t\tif ( discount_response ) {\r\n\t\t\t\t\tif ( discount_response.msg == 'valid' ) {\r\n\t\t\t\t\t\t$( '.edd_cart_discount' ).html( discount_response.html );\r\n\t\t\t\t\t\t$( '.edd_cart_discount_row' ).show();\r\n\r\n\t\t\t\t\t\t$( '.edd_cart_amount' ).each( function() {\r\n\t\t\t\t\t\t\t// Format discounted amount for display.\r\n\t\t\t\t\t\t\t$( this ).text( discount_response.total );\r\n\t\t\t\t\t\t\t// Set data attribute to new (unformatted) discounted amount.'\r\n\t\t\t\t\t\t\t$( this ).data( 'total', discount_response.total_plain );\r\n\t\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t\t$( '#edd-discount', $checkout_form_wrap ).val( '' );\r\n\r\n\t\t\t\t\t\trecalculate_taxes();\r\n\r\n\t\t\t\t\t\tconst inputs = $( '#edd_cc_fields .edd-input, #edd_cc_fields .edd-select,#edd_cc_address .edd-input, #edd_cc_address .edd-select,#edd_payment_mode_select .edd-input, #edd_payment_mode_select .edd-select' );\r\n\r\n\t\t\t\t\t\tif ( '0.00' == discount_response.total_plain ) {\r\n\t\t\t\t\t\t\t$( '#edd_cc_fields,#edd_cc_address,#edd_payment_mode_select' ).slideUp();\r\n\t\t\t\t\t\t\tinputs.removeAttr( 'required' );\r\n\t\t\t\t\t\t\t$( 'input[name=\"edd-gateway\"]' ).val( 'manual' );\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif ( ! inputs.is( '.card-address-2' ) ) {\r\n\t\t\t\t\t\t\t\tinputs.attr( 'required', 'required' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t$( '#edd_cc_fields,#edd_cc_address' ).slideDown();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$body.trigger( 'edd_discount_applied', [ discount_response ] );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$( '#edd-discount-error-wrap' ).html( '<span class=\"edd_error\">' + discount_response.msg + '</span>' );\r\n\t\t\t\t\t\t$( '#edd-discount-error-wrap' ).show();\r\n\t\t\t\t\t\t$body.trigger( 'edd_discount_invalid', [ discount_response ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\t\t\tconsole.log( discount_response );\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$body.trigger( 'edd_discount_failed', [ discount_response ] );\r\n\t\t\t\t}\r\n\t\t\t\tedd_discount_loader.hide();\r\n\t\t\t},\r\n\t\t} ).fail( function( data ) {\r\n\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\tconsole.log( data );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction remove_discount( event ) {\r\n\t\tconst $this = $( this ),\r\n\t\t\tpostData = {\r\n\t\t\t\taction: 'edd_remove_discount',\r\n\t\t\t\tcode: $this.data( 'code' ),\r\n\t\t\t};\r\n\r\n\t\t$.ajax( {\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: 'json',\r\n\t\t\turl: edd_global_vars.ajaxurl,\r\n\t\t\txhrFields: {\r\n\t\t\t\twithCredentials: true,\r\n\t\t\t},\r\n\t\t\tsuccess: function( discount_response ) {\r\n\t\t\t\tconst zero = '0' + edd_global_vars.decimal_separator + '00';\r\n\r\n\t\t\t\t$( '.edd_cart_amount' ).each( function() {\r\n\t\t\t\t\tif ( edd_global_vars.currency_sign + zero == $( this ).text() || zero + edd_global_vars.currency_sign == $( this ).text() ) {\r\n\t\t\t\t\t\t// We're removing a 100% discount code so we need to force the payment gateway to reload\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Format discounted amount for display.\r\n\t\t\t\t\t$( this ).text( discount_response.total );\r\n\t\t\t\t\t// Set data attribute to new (unformatted) discounted amount.'\r\n\t\t\t\t\t$( this ).data( 'total', discount_response.total_plain );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t$( '.edd_cart_discount' ).html( discount_response.html );\r\n\r\n\t\t\t\tif ( ! discount_response.discounts ) {\r\n\t\t\t\t\t$( '.edd_cart_discount_row' ).hide();\r\n\t\t\t\t}\r\n\r\n\t\t\t\trecalculate_taxes();\r\n\r\n\t\t\t\t$( '#edd_cc_fields,#edd_cc_address' ).slideDown();\r\n\r\n\t\t\t\t$body.trigger( 'edd_discount_removed', [ discount_response ] );\r\n\t\t\t},\r\n\t\t} ).fail( function( data ) {\r\n\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\tconsole.log( data );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction update_item_quantities( event ) {\r\n\t\tconst $this = $( this ),\r\n\t\t\tquantity = $this.val(),\r\n\t\t\tkey = $this.data( 'key' ),\r\n\t\t\tdownload_id = $this.closest( '.edd_cart_item' ).data( 'download-id' ),\r\n\t\t\toptions = $this.parent().find( 'input[name=\"edd-cart-download-' + key + '-options\"]' ).val();\r\n\r\n\t\tconst edd_cc_address = $( '#edd_cc_address' );\r\n\t\tconst billing_country = edd_cc_address.find( '#billing_country' ).val(),\r\n\t\t\tcard_state = edd_cc_address.find( '#card_state' ).val();\r\n\r\n\t\tconst postData = {\r\n\t\t\taction: 'edd_update_quantity',\r\n\t\t\tquantity: quantity,\r\n\t\t\tdownload_id: download_id,\r\n\t\t\toptions: options,\r\n\t\t\tbilling_country: billing_country,\r\n\t\t\tcard_state: card_state,\r\n\t\t};\r\n\r\n\t\t//edd_discount_loader.show();\r\n\r\n\t\t$.ajax( {\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: postData,\r\n\t\t\tdataType: 'json',\r\n\t\t\turl: edd_global_vars.ajaxurl,\r\n\t\t\txhrFields: {\r\n\t\t\t\twithCredentials: true,\r\n\t\t\t},\r\n\t\t\tsuccess: function( response ) {\r\n\t\t\t\t$( '.edd_cart_subtotal_amount' ).each( function() {\r\n\t\t\t\t\t$( this ).text( response.subtotal );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t$( '.edd_cart_tax_amount' ).each( function() {\r\n\t\t\t\t\t$( this ).text( response.taxes );\r\n\t\t\t\t} );\r\n\r\n\t\t\t\t$( '.edd_cart_amount' ).each( function() {\r\n\t\t\t\t\t$( this ).text( response.total );\r\n\t\t\t\t\t$body.trigger( 'edd_quantity_updated', [ response ] );\r\n\t\t\t\t} );\r\n\t\t\t},\r\n\t\t} ).fail( function( data ) {\r\n\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\tconsole.log( data );\r\n\t\t\t}\r\n\t\t} );\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Expose some functions or variables to window.EDD_Checkout object\r\n\treturn {\r\n\t\tinit: init,\r\n\t\trecalculate_taxes: recalculate_taxes,\r\n\t};\r\n}( window.jQuery ) );\r\n\r\n// init on document.ready\r\nwindow.jQuery( document ).ready( EDD_Checkout.init );\r\n","/**\r\n * Generate markup for a credit card icon based on a passed type.\r\n *\r\n * @param {string} type Credit card type.\r\n * @return HTML markup.\r\n */\r\nexport const getCreditCardIcon = ( type ) => {\r\n\tlet width;\r\n\tlet name = type;\r\n\r\n\tswitch ( type ) {\r\n\t\tcase 'amex':\r\n\t\t\tname = 'americanexpress';\r\n\t\t\twidth = 32;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\twidth = 50;\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn `\r\n    <svg\r\n      width=${ width }\r\n      height=${ 32 }\r\n      class=\"payment-icon icon-${ name }\"\r\n      role=\"img\"\r\n    >\r\n      <use\r\n        href=\"#icon-${ name }\"\r\n        xlink:href=\"#icon-${ name }\">\r\n      </use>\r\n    </svg>`;\r\n};\r\n","/* global edd_scripts, edd_global_vars */\r\n\r\n/**\r\n * Internal dependencies.\r\n */\r\nimport { recalculate_taxes } from './checkout';\r\n\r\njQuery( document ).ready( function( $ ) {\r\n\t// Hide unneeded elements. These are things that are required in case JS breaks or isn't present\r\n\t$( '.edd-no-js' ).hide();\r\n\t$( 'a.edd-add-to-cart' ).addClass( 'edd-has-js' );\r\n\r\n\t// Send Remove from Cart requests\r\n\t$( document.body ).on( 'click.eddRemoveFromCart', '.edd-remove-from-cart', function( event ) {\r\n\t\tconst $this = $( this ),\r\n\t\t\titem = $this.data( 'cart-item' ),\r\n\t\t\taction = $this.data( 'action' ),\r\n\t\t\tid = $this.data( 'download-id' ),\r\n\t\t\tnonce = $this.data( 'nonce' ),\r\n\t\t\tdata = {\r\n\t\t\t\taction: action,\r\n\t\t\t\tcart_item: item,\r\n\t\t\t\tnonce: nonce,\r\n\t\t\t};\r\n\r\n\t\t $.ajax( {\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: data,\r\n\t\t\tdataType: 'json',\r\n\t\t\turl: edd_scripts.ajaxurl,\r\n\t\t\txhrFields: {\r\n\t\t\t\twithCredentials: true,\r\n\t\t\t},\r\n\t\t\tsuccess: function( response ) {\r\n\t\t\t\tif ( response.removed ) {\r\n\t\t\t\t\tif ( ( parseInt( edd_scripts.position_in_cart, 10 ) === parseInt( item, 10 ) ) || edd_scripts.has_purchase_links ) {\r\n\t\t\t\t\t\twindow.location = window.location;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Remove the selected cart item\r\n\t\t\t\t\t$( '.edd-cart' ).each( function() {\r\n\t\t\t\t\t\t$( this ).find( \"[data-cart-item='\" + item + \"']\" ).parent().remove();\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t//Reset the data-cart-item attributes to match their new values in the EDD session cart array\r\n\t\t\t\t\t$( '.edd-cart' ).each( function() {\r\n\t\t\t\t\t\tlet cart_item_counter = 0;\r\n\t\t\t\t\t\t$( this ).find( '[data-cart-item]' ).each( function() {\r\n\t\t\t\t\t\t\t$( this ).attr( 'data-cart-item', cart_item_counter );\r\n\t\t\t\t\t\t\tcart_item_counter = cart_item_counter + 1;\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t// Check to see if the purchase form(s) for this download is present on this page\r\n\t\t\t\t\tif ( $( '[id^=edd_purchase_' + id + ']' ).length ) {\r\n\t\t\t\t\t\t$( '[id^=edd_purchase_' + id + '] .edd_go_to_checkout' ).hide();\r\n\t\t\t\t\t\t$( '[id^=edd_purchase_' + id + '] a.edd-add-to-cart' ).show().removeAttr( 'data-edd-loading' );\r\n\t\t\t\t\t\tif ( edd_scripts.quantities_enabled === '1' ) {\r\n\t\t\t\t\t\t\t$( '[id^=edd_purchase_' + id + '] .edd_download_quantity_wrapper' ).show();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( 'span.edd-cart-quantity' ).text( response.cart_quantity );\r\n\t\t\t\t\t$( document.body ).trigger( 'edd_quantity_updated', [ response.cart_quantity ] );\r\n\t\t\t\t\tif ( edd_scripts.taxes_enabled ) {\r\n\t\t\t\t\t\t$( '.cart_item.edd_subtotal span' ).html( response.subtotal );\r\n\t\t\t\t\t\t$( '.cart_item.edd_cart_tax span' ).html( response.tax );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( '.cart_item.edd_total span' ).html( response.total );\r\n\r\n\t\t\t\t\tif ( response.cart_quantity === 0 ) {\r\n\t\t\t\t\t\t$( '.cart_item.edd_subtotal,.edd-cart-number-of-items,.cart_item.edd_checkout,.cart_item.edd_cart_tax,.cart_item.edd_total' ).hide();\r\n\t\t\t\t\t\t$( '.edd-cart' ).each( function() {\r\n\t\t\t\t\t\t\tconst cart_wrapper = $( this ).parent();\r\n\t\t\t\t\t\t\tif ( cart_wrapper ) {\r\n\t\t\t\t\t\t\t\tcart_wrapper.addClass( 'cart-empty' );\r\n\t\t\t\t\t\t\t\tcart_wrapper.removeClass( 'cart-not-empty' );\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t$( this ).append( '<li class=\"cart_item empty\">' + edd_scripts.empty_cart_message + '</li>' );\r\n\t\t\t\t\t\t} );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( document.body ).trigger( 'edd_cart_item_removed', [ response ] );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t} ).fail( function( response ) {\r\n\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\tconsole.log( response );\r\n\t\t\t}\r\n\t\t} ).done( function( response ) {\r\n\r\n\t\t} );\r\n\r\n\t\treturn false;\r\n\t} );\r\n\r\n\t// Send Add to Cart request\r\n\t$( document.body ).on( 'click.eddAddToCart', '.edd-add-to-cart', function( e ) {\r\n\t\te.preventDefault();\r\n\r\n\t\tvar $this = $( this ),\r\n\t\t\tform = $this.closest( 'form' );\r\n\r\n\t\t// Disable button, preventing rapid additions to cart during ajax request\r\n\t\t$this.prop( 'disabled', true );\r\n\r\n\t\tconst $spinner = $this.find( '.edd-loading' );\r\n\t\tconst container = $this.closest( 'div' );\r\n\r\n\t\t// Show the spinner\r\n\t\t$this.attr( 'data-edd-loading', '' );\r\n\r\n\t\tvar form = $this.parents( 'form' ).last();\r\n\t\tconst download = $this.data( 'download-id' );\r\n\t\tconst variable_price = $this.data( 'variable-price' );\r\n\t\tconst price_mode = $this.data( 'price-mode' );\r\n\t\tconst nonce = $this.data( 'nonce' );\r\n\t\tconst item_price_ids = [];\r\n\t\tlet free_items = true;\r\n\r\n\t\tif ( variable_price === 'yes' ) {\r\n\t\t\tif ( form.find( '.edd_price_option_' + download + '[type=\"hidden\"]' ).length > 0 ) {\r\n\t\t\t\titem_price_ids[ 0 ] = $( '.edd_price_option_' + download, form ).val();\r\n\t\t\t\tif ( form.find( '.edd-submit' ).data( 'price' ) && form.find( '.edd-submit' ).data( 'price' ) > 0 ) {\r\n\t\t\t\t\tfree_items = false;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif ( ! form.find( '.edd_price_option_' + download + ':checked', form ).length ) {\r\n\t\t\t\t\t // hide the spinner\r\n\t\t\t\t\t$this.removeAttr( 'data-edd-loading' );\r\n\t\t\t\t\talert( edd_scripts.select_option );\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t$this.prop( 'disabled', false );\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tform.find( '.edd_price_option_' + download + ':checked', form ).each( function( index ) {\r\n\t\t\t\t\titem_price_ids[ index ] = $( this ).val();\r\n\r\n\t\t\t\t\t// If we're still only at free items, check if this one is free also\r\n\t\t\t\t\tif ( true === free_items ) {\r\n\t\t\t\t\t\tconst item_price = $( this ).data( 'price' );\r\n\t\t\t\t\t\tif ( item_price && item_price > 0 ) {\r\n\t\t\t\t\t\t\t// We now have a paid item, we can't use add_to_cart\r\n\t\t\t\t\t\t\tfree_items = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\titem_price_ids[ 0 ] = download;\r\n\t\t\tif ( $this.data( 'price' ) && $this.data( 'price' ) > 0 ) {\r\n\t\t\t\tfree_items = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If we've got nothing but free items being added, change to add_to_cart\r\n\t\tif ( free_items ) {\r\n\t\t\tform.find( '.edd_action_input' ).val( 'add_to_cart' );\r\n\t\t}\r\n\r\n\t\tif ( 'straight_to_gateway' === form.find( '.edd_action_input' ).val() ) {\r\n\t\t\tform.submit();\r\n\t\t\treturn true; // Submit the form\r\n\t\t}\r\n\r\n\t\tconst action = $this.data( 'action' );\r\n\t\tconst data = {\r\n\t\t\taction: action,\r\n\t\t\tdownload_id: download,\r\n\t\t\tprice_ids: item_price_ids,\r\n\t\t\tpost_data: $( form ).serialize(),\r\n\t\t\tnonce: nonce,\r\n\t\t};\r\n\r\n\t\t$.ajax( {\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: data,\r\n\t\t\tdataType: 'json',\r\n\t\t\turl: edd_scripts.ajaxurl,\r\n\t\t\txhrFields: {\r\n\t\t\t\twithCredentials: true,\r\n\t\t\t},\r\n\t\t\tsuccess: function( response ) {\r\n\t\t\t\tconst store_redirect = edd_scripts.redirect_to_checkout === '1';\r\n\t\t\t\tconst item_redirect = form.find( '#edd_redirect_to_checkout' ).val() === '1';\r\n\r\n\t\t\t\tif ( ( store_redirect && item_redirect ) || ( ! store_redirect && item_redirect ) ) {\r\n\t\t\t\t\twindow.location = edd_scripts.checkout_page;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Add the new item to the cart widget\r\n\t\t\t\t\tif ( edd_scripts.taxes_enabled === '1' ) {\r\n\t\t\t\t\t\t$( '.cart_item.edd_subtotal' ).show();\r\n\t\t\t\t\t\t$( '.cart_item.edd_cart_tax' ).show();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( '.cart_item.edd_total' ).show();\r\n\t\t\t\t\t$( '.cart_item.edd_checkout' ).show();\r\n\r\n\t\t\t\t\tif ( $( '.cart_item.empty' ).length ) {\r\n\t\t\t\t\t\t$( '.cart_item.empty' ).hide();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( '.widget_edd_cart_widget .edd-cart' ).each( function( cart ) {\r\n\t\t\t\t\t\tconst target = $( this ).find( '.edd-cart-meta:first' );\r\n\t\t\t\t\t\t$( response.cart_item ).insertBefore( target );\r\n\r\n\t\t\t\t\t\tconst cart_wrapper = $( this ).parent();\r\n\t\t\t\t\t\tif ( cart_wrapper ) {\r\n\t\t\t\t\t\t\tcart_wrapper.addClass( 'cart-not-empty' );\r\n\t\t\t\t\t\t\tcart_wrapper.removeClass( 'cart-empty' );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t// Update the totals\r\n\t\t\t\t\tif ( edd_scripts.taxes_enabled === '1' ) {\r\n\t\t\t\t\t\t$( '.edd-cart-meta.edd_subtotal span' ).html( response.subtotal );\r\n\t\t\t\t\t\t$( '.edd-cart-meta.edd_cart_tax span' ).html( response.tax );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t$( '.edd-cart-meta.edd_total span' ).html( response.total );\r\n\r\n\t\t\t\t\t// Update the cart quantity\r\n\t\t\t\t\tconst items_added = $( '.edd-cart-item-title', response.cart_item ).length;\r\n\r\n\t\t\t\t\t$( 'span.edd-cart-quantity' ).each( function() {\r\n\t\t\t\t\t\t$( this ).text( response.cart_quantity );\r\n\t\t\t\t\t\t$( document.body ).trigger( 'edd_quantity_updated', [ response.cart_quantity ] );\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t\t// Show the \"number of items in cart\" message\r\n\t\t\t\t\tif ( $( '.edd-cart-number-of-items' ).css( 'display' ) === 'none' ) {\r\n\t\t\t\t\t\t$( '.edd-cart-number-of-items' ).show( 'slow' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( variable_price === 'no' || price_mode !== 'multi' ) {\r\n\t\t\t\t\t\t// Switch purchase to checkout if a single price item or variable priced with radio buttons\r\n\t\t\t\t\t\t$( 'a.edd-add-to-cart', container ).toggle();\r\n\t\t\t\t\t\t$( '.edd_go_to_checkout', container ).css( 'display', 'inline-block' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( price_mode === 'multi' ) {\r\n\t\t\t\t\t\t// remove spinner for multi\r\n\t\t\t\t\t\t$this.removeAttr( 'data-edd-loading' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Update all buttons for same download\r\n\t\t\t\t\tif ( $( '.edd_download_purchase_form' ).length && ( variable_price === 'no' || ! form.find( '.edd_price_option_' + download ).is( 'input:hidden' ) ) ) {\r\n\t\t\t\t\t\tconst parent_form = $( '.edd_download_purchase_form *[data-download-id=\"' + download + '\"]' ).parents( 'form' );\r\n\t\t\t\t\t\t$( 'a.edd-add-to-cart', parent_form ).hide();\r\n\t\t\t\t\t\tif ( price_mode !== 'multi' ) {\r\n\t\t\t\t\t\t\tparent_form.find( '.edd_download_quantity_wrapper' ).slideUp();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t$( '.edd_go_to_checkout', parent_form ).show().removeAttr( 'data-edd-loading' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( response !== 'incart' ) {\r\n\t\t\t\t\t\t// Show the added message\r\n\t\t\t\t\t\t$( '.edd-cart-added-alert', container ).fadeIn();\r\n\t\t\t\t\t\tsetTimeout( function() {\r\n\t\t\t\t\t\t\t$( '.edd-cart-added-alert', container ).fadeOut();\r\n\t\t\t\t\t\t}, 3000 );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Re-enable the add to cart button\r\n\t\t\t\t\t$this.prop( 'disabled', false );\r\n\r\n\t\t\t\t\t$( document.body ).trigger( 'edd_cart_item_added', [ response ] );\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t} ).fail( function( response ) {\r\n\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\tconsole.log( response );\r\n\t\t\t}\r\n\t\t} ).done( function( response ) {\r\n\r\n\t\t} );\r\n\r\n\t\treturn false;\r\n\t} );\r\n\r\n\t// Show the login form on the checkout page\r\n\t$( '#edd_checkout_form_wrap' ).on( 'click', '.edd_checkout_register_login', function() {\r\n\t\tconst $this = $( this ),\r\n\t\t\tdata = {\r\n\t\t\t\taction: $this.data( 'action' ),\r\n\t\t\t\tnonce: $this.data( 'nonce' ),\r\n\t\t\t};\r\n\r\n\t\t// Show the ajax loader\r\n\t\t$( '.edd-cart-ajax' ).show();\r\n\r\n\t\t$.post( edd_scripts.ajaxurl, data, function( checkout_response ) {\r\n\t\t\t$( '#edd_checkout_login_register' ).html( edd_scripts.loading );\r\n\t\t\t$( '#edd_checkout_login_register' ).html( checkout_response );\r\n\t\t\t// Hide the ajax loader\r\n\t\t\t$( '.edd-cart-ajax' ).hide();\r\n\t\t} );\r\n\t\treturn false;\r\n\t} );\r\n\r\n\t// Process the login form via ajax\r\n\t$( document ).on( 'click', '#edd_purchase_form #edd_login_fields input[type=submit]', function( e ) {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst complete_purchase_val = $( this ).val();\r\n\r\n\t\t$( this ).val( edd_global_vars.purchase_loading );\r\n\r\n\t\t$( this ).after( '<span class=\"edd-loading-ajax edd-loading\"></span>' );\r\n\r\n\t\tconst data = {\r\n\t\t\taction: 'edd_process_checkout_login',\r\n\t\t\tedd_ajax: 1,\r\n\t\t\tedd_user_login: $( '#edd_login_fields #edd_user_login' ).val(),\r\n\t\t\tedd_user_pass: $( '#edd_login_fields #edd_user_pass' ).val(),\r\n\t\t\tedd_login_nonce: $( '#edd_login_nonce' ).val(),\r\n\t\t};\r\n\r\n\t\t$.post( edd_global_vars.ajaxurl, data, function( data ) {\r\n\t\t\tif ( $.trim( data ) === 'success' ) {\r\n\t\t\t\t$( '.edd_errors' ).remove();\r\n\t\t\t\twindow.location = edd_scripts.checkout_page;\r\n\t\t\t} else {\r\n\t\t\t\t$( '#edd_login_fields input[type=submit]' ).val( complete_purchase_val );\r\n\t\t\t\t$( '.edd-loading-ajax' ).remove();\r\n\t\t\t\t$( '.edd_errors' ).remove();\r\n\t\t\t\t$( '#edd-user-login-submit' ).before( data );\r\n\t\t\t}\r\n\t\t} );\r\n\t} );\r\n\r\n\t// Load the fields for the selected payment method\r\n\t$( 'select#edd-gateway, input.edd-gateway' ).change( function( e ) {\r\n\t\tconst payment_mode = $( '#edd-gateway option:selected, input.edd-gateway:checked' ).val();\r\n\r\n\t\tif ( payment_mode === '0' ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tedd_load_gateway( payment_mode );\r\n\r\n\t\treturn false;\r\n\t} );\r\n\r\n\t// Auto load first payment gateway\r\n\tif ( edd_scripts.is_checkout === '1' ) {\r\n\t\tlet chosen_gateway = false;\r\n\t\tlet ajax_needed = false;\r\n\r\n\t\tif ( $( 'select#edd-gateway, input.edd-gateway' ).length ) {\r\n\t\t\tchosen_gateway = $( \"meta[name='edd-chosen-gateway']\" ).attr( 'content' );\r\n\t\t\tajax_needed = true;\r\n\t\t}\r\n\r\n\t\tif ( ! chosen_gateway ) {\r\n\t\t\tchosen_gateway = edd_scripts.default_gateway;\r\n\t\t}\r\n\r\n\t\tif ( ajax_needed ) {\r\n\t\t\t// If we need to ajax in a gateway form, send the requests for the POST.\r\n\t\t\tsetTimeout( function() {\r\n\t\t\t\tedd_load_gateway( chosen_gateway );\r\n\t\t\t}, 200 );\r\n\t\t} else {\r\n\t\t\t// The form is already on page, just trigger that the gateway is loaded so further action can be taken.\r\n\t\t\t$( 'body' ).trigger( 'edd_gateway_loaded', [ chosen_gateway ] );\r\n\t\t}\r\n\t}\r\n\r\n\t// Process checkout\r\n\t$( document ).on( 'click', '#edd_purchase_form #edd_purchase_submit [type=submit]', function( e ) {\r\n\t\tconst eddPurchaseform = document.getElementById( 'edd_purchase_form' );\r\n\r\n\t\tif ( typeof eddPurchaseform.checkValidity === 'function' && false === eddPurchaseform.checkValidity() ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\te.preventDefault();\r\n\r\n\t\tconst complete_purchase_val = $( this ).val();\r\n\r\n\t\t$( this ).val( edd_global_vars.purchase_loading );\r\n\r\n\t\t$( this ).prop( 'disabled', true );\r\n\r\n\t\t$( this ).after( '<span class=\"edd-loading-ajax edd-loading\"></span>' );\r\n\r\n\t\t$.post( edd_global_vars.ajaxurl, $( '#edd_purchase_form' ).serialize() + '&action=edd_process_checkout&edd_ajax=true', function( data ) {\r\n\t\t\tif ( $.trim( data ) === 'success' ) {\r\n\t\t\t\t$( '.edd_errors' ).remove();\r\n\t\t\t\t$( '.edd-error' ).hide();\r\n\t\t\t\t$( eddPurchaseform ).submit();\r\n\t\t\t} else {\r\n\t\t\t\t$( '#edd-purchase-button' ).val( complete_purchase_val );\r\n\t\t\t\t$( '.edd-loading-ajax' ).remove();\r\n\t\t\t\t$( '.edd_errors' ).remove();\r\n\t\t\t\t$( '.edd-error' ).hide();\r\n\t\t\t\t$( edd_global_vars.checkout_error_anchor ).before( data );\r\n\t\t\t\t$( '#edd-purchase-button' ).prop( 'disabled', false );\r\n\r\n\t\t\t\t$( document.body ).trigger( 'edd_checkout_error', [ data ] );\r\n\t\t\t}\r\n\t\t} );\r\n\t} );\r\n\r\n\t// Update state field\r\n\t$( document.body ).on( 'change', '#edd_cc_address input.card_state, #edd_cc_address select, #edd_address_country', update_state_field );\r\n\r\n\tfunction update_state_field() {\r\n\t\tconst $this = $( this );\r\n\t\tlet $form;\r\n\t\tconst is_checkout = typeof edd_global_vars !== 'undefined';\r\n\t\tlet field_name = 'card_state';\r\n\t\tif ( $( this ).attr( 'id' ) === 'edd_address_country' ) {\r\n\t\t\tfield_name = 'edd_address_state';\r\n\t\t}\r\n\r\n\t\tif ( 'card_state' !== $this.attr( 'id' ) ) {\r\n\t\t\tconst nonce = $( this ).data( 'nonce' );\r\n\r\n\t\t\t// If the country field has changed, we need to update the state/province field\r\n\t\t\tconst postData = {\r\n\t\t\t\taction: 'edd_get_shop_states',\r\n\t\t\t\tcountry: $this.val(),\r\n\t\t\t\tfield_name: field_name,\r\n\t\t\t\tnonce: nonce,\r\n\t\t\t};\r\n\r\n\t\t\t$.ajax( {\r\n\t\t\t\ttype: 'POST',\r\n\t\t\t\tdata: postData,\r\n\t\t\t\turl: edd_scripts.ajaxurl,\r\n\t\t\t\txhrFields: {\r\n\t\t\t\t\twithCredentials: true,\r\n\t\t\t\t},\r\n\t\t\t\tsuccess: function( response ) {\r\n\t\t\t\t\tif ( is_checkout ) {\r\n\t\t\t\t\t\t$form = $( '#edd_purchase_form' );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$form = $this.closest( 'form' );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst state_inputs = 'input[name=\"card_state\"], select[name=\"card_state\"], input[name=\"edd_address_state\"], select[name=\"edd_address_state\"]';\r\n\r\n\t\t\t\t\tif ( 'nostates' === $.trim( response ) ) {\r\n\t\t\t\t\t\tconst text_field = '<input type=\"text\" name=\"card_state\" class=\"card-state edd-input required\" value=\"\"/>';\r\n\t\t\t\t\t\t$form.find( state_inputs ).replaceWith( text_field );\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$form.find( state_inputs ).replaceWith( response );\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( is_checkout ) {\r\n\t\t\t\t\t\t$( document.body ).trigger( 'edd_cart_billing_address_updated', [ response ] );\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t} ).fail( function( data ) {\r\n\t\t\t\tif ( window.console && window.console.log ) {\r\n\t\t\t\t\tconsole.log( data );\r\n\t\t\t\t}\r\n\t\t\t} ).done( function( data ) {\r\n\t\t\t\tif ( is_checkout ) {\r\n\t\t\t\t\trecalculate_taxes();\r\n\t\t\t\t}\r\n\t\t\t} );\r\n\t\t} else if ( is_checkout ) {\r\n\t\t\trecalculate_taxes();\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Backwards compatibility. Assign function to global namespace.\r\n\twindow.update_state_field = update_state_field;\r\n\r\n\t// If is_checkout, recalculate sales tax on postalCode change.\r\n\t$( document.body ).on( 'change', '#edd_cc_address input[name=card_zip]', function() {\r\n\t\tif ( typeof edd_global_vars !== 'undefined' ) {\r\n\t\t\trecalculate_taxes();\r\n\t\t}\r\n\t} );\r\n} );\r\n\r\n// Load a payment gateway\r\nfunction edd_load_gateway( payment_mode ) {\r\n\t// Show the ajax loader\r\n\tjQuery( '.edd-cart-ajax' ).show();\r\n\tjQuery( '#edd_purchase_form_wrap' ).html( '<span class=\"edd-loading-ajax edd-loading\"></span>' );\r\n\r\n\tconst nonce = jQuery( '#edd-gateway-' + payment_mode ).data( payment_mode + '-nonce' );\r\n\tlet url = edd_scripts.ajaxurl;\r\n\r\n\tif ( url.indexOf( '?' ) > 0 ) {\r\n\t\turl = url + '&';\r\n\t} else {\r\n\t\turl = url + '?';\r\n\t}\r\n\r\n\turl = url + 'payment-mode=' + payment_mode;\r\n\r\n\tjQuery.post( url, { action: 'edd_load_gateway', edd_payment_mode: payment_mode, nonce: nonce },\r\n\t\tfunction( response ) {\r\n\t\t\tjQuery( '#edd_purchase_form_wrap' ).html( response );\r\n\t\t\tjQuery( '.edd-no-js' ).hide();\r\n\t\t\tjQuery( 'body' ).trigger( 'edd_gateway_loaded', [ payment_mode ] );\r\n\t\t}\r\n\t);\r\n}\r\n\r\n// Backwards compatibility. Assign function to global namespace.\r\nwindow.edd_load_gateway = edd_load_gateway;\r\n"],"sourceRoot":""}