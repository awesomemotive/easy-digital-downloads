jQuery(document).ready(function(e){function r(t){if("1"!=edd_global_vars.taxes_enabled)return;var n=e("#edd_cc_address");if(!t){t=n.find("#card_state").val()}var r={action:"edd_recalculate_taxes",nonce:edd_global_vars.checkout_nonce,country:n.find("#billing_country").val(),state:t};e.ajax({type:"POST",data:r,dataType:"json",url:edd_global_vars.ajaxurl,success:function(t){e("#edd_checkout_cart").replaceWith(t.html);e(".edd_cart_amount").html(t.total);var n=new Object;n.postdata=r;n.response=t;e("body").trigger("edd_taxes_recalculated",[n])}}).fail(function(e){console.log(e)})}var t=e("body"),n=e(".edd_cart_amount");t.on("change","#edd_cc_address input.card_state, #edd_cc_address select",function(){var t=e(this);if("card_state"!=t.attr("id")){var n={action:"edd_get_shop_states",country:t.val(),field_name:"card_state"};e.ajax({type:"POST",data:n,url:edd_global_vars.ajaxurl,success:function(e){if("nostates"==e){var n='<input type="text" name="card_state" class="cart-state edd-input required" value=""/>';t.parent().next().find("input,select").replaceWith(n)}else{t.parent().next().find("input,select").replaceWith(e)}}}).fail(function(e){console.log(e)}).done(function(e){r()})}else{r()}return false});t.on("focusout",".edd-do-validate .card-number",function(){var t=e(this);t.validateCreditCard(function(n){var r=e(".card-type");if(n.card_type==null){r.addClass("off");t.removeClass("valid");t.addClass("error")}else{r.removeClass("off");r.addClass(n.card_type.name);if(n.length_valid&&n.luhn_valid){t.addClass("valid");t.removeClass("error")}else{t.removeClass("valid");t.addClass("error")}}})});t.on("submit","#edd_payment_mode",function(){var t=e("#edd-gateway option:selected").val();if(t==0){alert(edd_global_vars.no_gateway);return false}});var i=n.text(),s=e("#edd_checkout_form_wrap");s.on("focusout","#edd-discount",function(t){var n=e(this),i=n.val(),o=e("#edd-discount-loader");if(i==""||i==edd_global_vars.enter_discount){return false}var u={action:"edd_apply_discount",code:i,nonce:edd_global_vars.checkout_nonce};o.show();e.ajax({type:"POST",data:u,dataType:"json",url:edd_global_vars.ajaxurl,success:function(t){if(t){if(t.msg=="valid"){e(".edd_cart_discount").html(t.html);e(".edd_cart_discount_row").show();e(".edd_cart_amount").each(function(){e(this).text(t.total)});e("#edd-discount",s).val("");r();e("body").trigger("edd_discount_applied",[t])}else{alert(t.msg)}}else{console.log(t)}o.hide()}}).fail(function(e){console.log(e)});return false});t.on("click",".edd_discount_remove",function(t){var n=e(this),i={action:"edd_remove_discount",code:n.data("code")};e.ajax({type:"POST",data:i,dataType:"json",url:edd_global_vars.ajaxurl,success:function(t){e(".edd_cart_discount").html(t.html);if(!t.discounts){e(".edd_cart_discount_row").hide()}e(".edd_cart_amount").each(function(){e(this).text(t.total)});r();e("body").trigger("edd_discount_removed",[t])}}).fail(function(e){console.log(e)});return false});t.on("click",".edd_discount_link",function(t){t.preventDefault();e(".edd_discount_link").parent().hide();e("#edd-discount-code-wrap").show()});t.find("#edd-discount-code-wrap").hide();t.find("#edd_show_discount").show()})