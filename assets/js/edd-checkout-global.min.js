jQuery(document).ready(function(a){var f=a("body"),c=a(".edd_cart_amount");f.on("change","#edd_cc_address input.card_state, #edd_cc_address select",function(){var h=a(this);if("card_state"!=h.attr("id")){var g={action:"edd_get_shop_states",country:h.val(),field_name:"card_state"};a.ajax({type:"POST",data:g,url:edd_global_vars.ajaxurl,success:function(i){if("nostates"==i){var j='<input type="text" name="card_state" class="cart-state edd-input required" value=""/>';h.parent().next().find("input,select").replaceWith(j)}else{h.parent().next().find("input,select").replaceWith(i)}}}).fail(function(i){console.log(i)}).done(function(i){d()})}else{d()}return false});function d(g){if("1"!=edd_global_vars.taxes_enabled){return}var h=a("#edd_cc_address");if(!g){g=h.find("#card_state").val()}var i={action:"edd_recalculate_taxes",nonce:edd_global_vars.checkout_nonce,country:h.find("#billing_country").val(),state:g};a.ajax({type:"POST",data:i,dataType:"json",url:edd_global_vars.ajaxurl,success:function(j){a("#edd_checkout_cart").replaceWith(j.html);a(".edd_cart_amount").html(j.total)}}).fail(function(j){console.log(j)})}f.on("focusout",".edd-do-validate .card-number",function(){var g=a(this);g.validateCreditCard(function(i){var h=a(".card-type");if(i.card_type==null){h.addClass("off");g.removeClass("valid");g.addClass("error")}else{h.removeClass("off");h.addClass(i.card_type.name);if(i.length_valid&&i.luhn_valid){g.addClass("valid");g.removeClass("error")}else{g.removeClass("valid");g.addClass("error")}}})});f.on("submit","#edd_payment_mode",function(){var g=a("#edd-gateway option:selected").val();if(g==0){alert(edd_global_vars.no_gateway);return false}});var b=c.text(),e=a("#edd_checkout_form_wrap");e.on("change","#edd-email",function(g){a("#edd-discount").val("")});e.on("focusout","#edd-discount",function(i){var g=a(this),k=g.val(),h=a("#edd-email").val();edd_user=a("#edd_user_login").val(),edd_discount_loader=a("#edd-discount-loader");if(k==""||k==edd_global_vars.enter_discount){return false}if(h==""&&h!="undefined"){alert(edd_global_vars.no_email);return false}if(h=="undefined"&&edd_user==""){alert(edd_global_vars.no_username);return false}var j={action:"edd_apply_discount",code:k,email:h,user:edd_user,nonce:edd_global_vars.checkout_nonce};$edd_discount_loader.show();a.ajax({type:"POST",data:j,dataType:"json",url:edd_global_vars.ajaxurl,success:function(l){if(l){if(l.msg=="valid"){a(".edd_cart_discount").html(l.html);a(".edd_cart_discount_row").show();c.text(l.total)}else{alert(l.msg)}}else{console.log(l)}$edd_discount_loader.hide()}}).fail(function(l){console.log(l)});return false})});
