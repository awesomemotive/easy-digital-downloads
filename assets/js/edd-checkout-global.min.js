jQuery(document).ready(function(e){function i(t){if("1"!=edd_global_vars.taxes_enabled)return;var n=e("#edd_cc_address");if(!t){t=n.find("#card_state").val()}var r={action:"edd_recalculate_taxes",billing_country:n.find("#billing_country").val(),state:t};e.ajax({type:"POST",data:r,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:true},success:function(t){e("#edd_checkout_cart").replaceWith(t.html);e(".edd_cart_amount").html(t.total);var n=new Object;n.postdata=r;n.response=t;e("body").trigger("edd_taxes_recalculated",[n])}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}})}function s(t){var n=t;n.validateCreditCard(function(t){var r=e(".card-type");if(t.card_type==null){r.removeClass().addClass("off card-type");n.removeClass("valid");n.addClass("error")}else{r.removeClass("off");r.addClass(t.card_type.name);if(t.length_valid&&t.luhn_valid){n.addClass("valid");n.removeClass("error")}else{n.removeClass("valid");n.addClass("error")}}})}var t=e("body"),n=e("#edd_purchase_form"),r=e(".edd_cart_amount");t.on("change","#edd_cc_address input.card_state, #edd_cc_address select",function(){var t=e(this);if("card_state"!=t.attr("id")){var r={action:"edd_get_shop_states",country:t.val(),field_name:"card_state"};e.ajax({type:"POST",data:r,url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:true},success:function(t){if("nostates"==t){var r='<input type="text" name="card_state" class="cart-state edd-input required" value=""/>';n.find('input[name="card_state"], select[name="card_state"]').replaceWith(r)}else{n.find('input[name="card_state"], select[name="card_state"]').replaceWith(t)}e("body").trigger("edd_cart_billing_address_updated",[t])}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}}).done(function(e){i()})}else{i()}return false});t.on("keyup",".edd-do-validate .card-number",function(){s(e(this))});t.on("submit","#edd_payment_mode",function(){var t=e("#edd-gateway option:selected").val();if(t==0){alert(edd_global_vars.no_gateway);return false}});t.on("click","#edd_payment_mode_select input",function(){e("#edd_payment_mode_select label.edd-gateway-option-selected").removeClass("edd-gateway-option-selected");e("#edd_payment_mode_select input:checked").parent().addClass("edd-gateway-option-selected")});var o=r.text(),u=e("#edd_checkout_form_wrap");u.on("click",".edd-apply-discount",function(t){t.preventDefault();var n=e(this),r=e("#edd-discount").val(),s=e("#edd-discount-loader");if(r==""||r==edd_global_vars.enter_discount){return false}var o={action:"edd_apply_discount",code:r};e("#edd-discount-error-wrap").html("").hide();s.show();e.ajax({type:"POST",data:o,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:true},success:function(t){if(t){if(t.msg=="valid"){e(".edd_cart_discount").html(t.html);e(".edd_cart_discount_row").show();e(".edd_cart_amount").each(function(){e(this).text(t.total)});e("#edd-discount",u).val("");i();if("0.00"==t.total_plain){e("#edd_cc_fields,#edd_cc_address").slideUp();e('input[name="edd-gateway"]').val("manual")}else{e("#edd_cc_fields,#edd_cc_address").slideDown()}e("body").trigger("edd_discount_applied",[t])}else{e("#edd-discount-error-wrap").html('<span class="edd_error">'+t.msg+"</span>");e("#edd-discount-error-wrap").show();e("body").trigger("edd_discount_invalid",[t])}}else{if(window.console&&window.console.log){console.log(t)}e("body").trigger("edd_discount_failed",[t])}s.hide()}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}});return false});u.on("keypress","#edd-discount",function(e){if(e.keyCode=="13"){return false}});u.on("keyup","#edd-discount",function(e){if(e.keyCode=="13"){u.find(".edd-apply-discount").trigger("click")}});t.on("click",".edd_discount_remove",function(t){var n=e(this),r={action:"edd_remove_discount",code:n.data("code")};e.ajax({type:"POST",data:r,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:true},success:function(t){e(".edd_cart_amount").each(function(){if(edd_global_vars.currency_sign+"0.00"==e(this).text()||"0.00"+edd_global_vars.currency_sign==e(this).text()){window.location.reload()}e(this).text(t.total)});e(".edd_cart_discount").html(t.html);if(!t.discounts){e(".edd_cart_discount_row").hide()}i();e("#edd_cc_fields,#edd_cc_address").slideDown();e("body").trigger("edd_discount_removed",[t])}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}});return false});t.on("click",".edd_discount_link",function(t){t.preventDefault();e(".edd_discount_link").parent().hide();e("#edd-discount-code-wrap").show().find("#edd-discount").focus()});t.find("#edd-discount-code-wrap").hide();t.find("#edd_show_discount").show();e("#edd_checkout_cart").on("change",".edd-item-quantity",function(t){var n=e(this),r=n.val(),i=n.data("key"),s=n.closest("tr.edd_cart_item").data("download-id"),o=n.parent().find('input[name="edd-cart-download-'+i+'-options"]').val();var u={action:"edd_update_quantity",quantity:r,download_id:s,options:o};e.ajax({type:"POST",data:u,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:true},success:function(t){console.log(t);e(".edd_cart_subtotal_amount").each(function(){e(this).text(t.subtotal)});e(".edd_cart_tax_amount").each(function(){e(this).text(t.taxes)});e(".edd_cart_amount").each(function(){e(this).text(t.total);e("body").trigger("edd_quantity_updated",[t])})}}).fail(function(e){if(window.console&&window.console.log){console.log(e)}});return false})})