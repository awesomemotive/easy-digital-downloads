jQuery(document).ready(function(e){function d(d){if("1"==edd_global_vars.taxes_enabled){var t=e("#edd_cc_address");d||(d=t.find("#card_state").val());var a={action:"edd_recalculate_taxes",billing_country:t.find("#billing_country").val(),state:d};e.ajax({type:"POST",data:a,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){e("#edd_checkout_cart_form").replaceWith(d.html),e(".edd_cart_amount").html(d.total);var t=new Object;t.postdata=a,t.response=d,e("body").trigger("edd_taxes_recalculated",[t])}}).fail(function(e){window.console&&window.console.log&&console.log(e)})}}function t(d){var t=d;t.validateCreditCard(function(d){var a=e(".card-type");null==d.card_type?(a.removeClass().addClass("off card-type"),t.removeClass("valid"),t.addClass("error")):(a.removeClass("off"),a.addClass(d.card_type.name),d.length_valid&&d.luhn_valid?(t.addClass("valid"),t.removeClass("error")):(t.removeClass("valid"),t.addClass("error")))})}var a=e("body"),o=e("#edd_purchase_form"),n=e(".edd_cart_amount");a.on("change","#edd_cc_address input.card_state, #edd_cc_address select",function(){var t=e(this);if("card_state"!=t.attr("id")){var a={action:"edd_get_shop_states",country:t.val(),field_name:"card_state"};e.ajax({type:"POST",data:a,url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){if("nostates"==d){var t='<input type="text" name="card_state" class="cart-state edd-input required" value=""/>';o.find('input[name="card_state"], select[name="card_state"]').replaceWith(t)}else o.find('input[name="card_state"], select[name="card_state"]').replaceWith(d);e("body").trigger("edd_cart_billing_address_updated",[d])}}).fail(function(e){window.console&&window.console.log&&console.log(e)}).done(function(){d()})}else d();return!1}),a.on("keyup change",".edd-do-validate .card-number",function(){t(e(this))}),a.on("submit","#edd_payment_mode",function(){var d=e("#edd-gateway option:selected").val();return 0==d?(alert(edd_global_vars.no_gateway),!1):void 0}),a.on("click","#edd_payment_mode_select input",function(){e("#edd_payment_mode_select label.edd-gateway-option-selected").removeClass("edd-gateway-option-selected"),e("#edd_payment_mode_select input:checked").parent().addClass("edd-gateway-option-selected")});var s=(n.text(),e("#edd_checkout_form_wrap"));s.on("click",".edd-apply-discount",function(t){t.preventDefault();var a=(e(this),e("#edd-discount").val()),o=e("#edd-discount-loader");if(""==a||a==edd_global_vars.enter_discount)return!1;var n={action:"edd_apply_discount",code:a,form:e("#edd_purchase_form").serialize()};return e("#edd-discount-error-wrap").html("").hide(),o.show(),e.ajax({type:"POST",data:n,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(t){t?"valid"==t.msg?(e(".edd_cart_discount").html(t.html),e(".edd_cart_discount_row").show(),e(".edd_cart_amount").each(function(){e(this).text(t.total)}),e("#edd-discount",s).val(""),d(),"0.00"==t.total_plain?(e("#edd_cc_fields,#edd_cc_address").slideUp(),e('input[name="edd-gateway"]').val("manual")):e("#edd_cc_fields,#edd_cc_address").slideDown(),e("body").trigger("edd_discount_applied",[t])):(e("#edd-discount-error-wrap").html('<span class="edd_error">'+t.msg+"</span>"),e("#edd-discount-error-wrap").show(),e("body").trigger("edd_discount_invalid",[t])):(window.console&&window.console.log&&console.log(t),e("body").trigger("edd_discount_failed",[t])),o.hide()}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1}),s.on("keypress","#edd-discount",function(e){return"13"==e.keyCode?!1:void 0}),s.on("keyup","#edd-discount",function(e){"13"==e.keyCode&&s.find(".edd-apply-discount").trigger("click")}),a.on("click",".edd_discount_remove",function(){var t=e(this),a={action:"edd_remove_discount",code:t.data("code")};return e.ajax({type:"POST",data:a,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(t){e(".edd_cart_amount").each(function(){(edd_global_vars.currency_sign+"0.00"==e(this).text()||"0.00"+edd_global_vars.currency_sign==e(this).text())&&window.location.reload(),e(this).text(t.total)}),e(".edd_cart_discount").html(t.html),t.discounts||e(".edd_cart_discount_row").hide(),d(),e("#edd_cc_fields,#edd_cc_address").slideDown(),e("body").trigger("edd_discount_removed",[t])}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1}),a.on("click",".edd_discount_link",function(d){d.preventDefault(),e(".edd_discount_link").parent().hide(),e("#edd-discount-code-wrap").show().find("#edd-discount").focus()}),a.find("#edd-discount-code-wrap").hide(),a.find("#edd_show_discount").show(),e(document).on("change",".edd-item-quantity",function(){var d=e(this),t=d.val(),a=d.data("key"),o=d.closest("tr.edd_cart_item").data("download-id"),n=d.parent().find('input[name="edd-cart-download-'+a+'-options"]').val(),s={action:"edd_update_quantity",quantity:t,download_id:o,options:n};return e.ajax({type:"POST",data:s,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){console.log(d),e(".edd_cart_subtotal_amount").each(function(){e(this).text(d.subtotal)}),e(".edd_cart_tax_amount").each(function(){e(this).text(d.taxes)}),e(".edd_cart_amount").each(function(){e(this).text(d.total),e("body").trigger("edd_quantity_updated",[d])})}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1})});