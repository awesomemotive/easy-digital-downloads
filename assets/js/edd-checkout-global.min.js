function recalculate_taxes(e){if("1"==edd_global_vars.taxes_enabled){var d=jQuery("#edd_cc_address");e||(e=d.find("#card_state").val());var a={action:"edd_recalculate_taxes",billing_country:d.find("#billing_country").val(),state:e,card_zip:d.find("input[name=card_zip]").val()},t=++ajax_tax_count;jQuery.ajax({type:"POST",data:a,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(e){if(t===ajax_tax_count){jQuery("#edd_checkout_cart_form").replaceWith(e.html),jQuery(".edd_cart_amount").html(e.total);var d=new Object;d.postdata=a,d.response=e,jQuery("body").trigger("edd_taxes_recalculated",[d])}}}).fail(function(e){window.console&&window.console.log&&(console.log(e),t===ajax_tax_count&&jQuery("body").trigger("edd_taxes_recalculated",[tax_data]))})}}window.EDD_Checkout=function(e){"use strict";function d(){c=e(document.body),r=e("#edd_purchase_form"),l=e(".edd_cart_amount"),s=l.text(),_=e("#edd_checkout_form_wrap"),c.on("edd_gateway_loaded",function(e){t(r)}),c.on("keyup change",".edd-do-validate .card-number",function(){a(e(this))}),c.on("blur change",".card-name",function(){var d=e(this);d.validateCreditCard(function(a){null!=a.card_type?(d.removeClass("valid").addClass("error"),e("#edd-purchase-button").attr("disabled","disabled")):(d.removeClass("error").addClass("valid"),e("#edd-purchase-button").removeAttr("disabled"))})}),c.on("submit","#edd_payment_mode",function(){var d=e("#edd-gateway option:selected").val();return 0==d?(alert(edd_global_vars.no_gateway),!1):void 0}),c.on("click","#edd_payment_mode_select input",function(){e("#edd_payment_mode_select label.edd-gateway-option-selected").removeClass("edd-gateway-option-selected"),e("#edd_payment_mode_select input:checked").parent().addClass("edd-gateway-option-selected")}),_.on("click",".edd-apply-discount",o),_.on("keypress","#edd-discount",function(e){return"13"==e.keyCode?!1:void 0}),_.on("keyup","#edd-discount",function(e){"13"==e.keyCode&&_.find(".edd-apply-discount").trigger("click")}),c.on("click",".edd_discount_remove",n),c.on("click",".edd_discount_link",function(d){d.preventDefault(),e(".edd_discount_link").parent().hide(),e("#edd-discount-code-wrap").show().find("#edd-discount").focus()}),c.find("#edd-discount-code-wrap").hide(),c.find("#edd_show_discount").show(),c.on("change",".edd-item-quantity",i),c.on("click",".edd-amazon-logout #Logout",function(e){e.preventDefault(),amazon.Login.logout(),window.location=edd_amazon.checkoutUri})}function a(d){var a=d;a.validateCreditCard(function(d){var t=e(".card-type");null==d.card_type?(t.removeClass().addClass("off card-type"),a.removeClass("valid"),a.addClass("error")):(t.removeClass("off"),t.addClass(d.card_type.name),d.length_valid&&d.luhn_valid?(a.addClass("valid"),a.removeClass("error")):(a.removeClass("valid"),a.addClass("error")))})}function t(e){var d=e.find(".card-number"),a=e.find(".card-cvc"),t=e.find(".card-expiry");d.length&&"function"==typeof d.payment&&(d.payment("formatCardNumber"),a.payment("formatCardCVC"),t.payment("formatCardExpiry"))}function o(d){d.preventDefault();var a=(e(this),e("#edd-discount").val()),t=e("#edd-discount-loader");if(""==a||a==edd_global_vars.enter_discount)return!1;var o={action:"edd_apply_discount",code:a,form:e("#edd_purchase_form").serialize()};return e("#edd-discount-error-wrap").html("").hide(),t.show(),e.ajax({type:"POST",data:o,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){if(d)if("valid"==d.msg){e(".edd_cart_discount").html(d.html),e(".edd_cart_discount_row").show(),e(".edd_cart_amount").each(function(){e(this).text(d.total),e(this).data("total",d.total_plain)}),e("#edd-discount",_).val(""),recalculate_taxes();var a=e("#edd_cc_fields .edd-input, #edd_cc_fields .edd-select,#edd_cc_address .edd-input, #edd_cc_address .edd-select,#edd_payment_mode_select .edd-input, #edd_payment_mode_select .edd-select");"0.00"==d.total_plain?(e("#edd_cc_fields,#edd_cc_address,#edd_payment_mode_select").slideUp(),a.removeAttr("required"),e('input[name="edd-gateway"]').val("manual")):(a.is(".card-address-2")||a.attr("required","required"),e("#edd_cc_fields,#edd_cc_address").slideDown()),c.trigger("edd_discount_applied",[d])}else e("#edd-discount-error-wrap").html('<span class="edd_error">'+d.msg+"</span>"),e("#edd-discount-error-wrap").show(),c.trigger("edd_discount_invalid",[d]);else window.console&&window.console.log&&console.log(d),c.trigger("edd_discount_failed",[d]);t.hide()}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1}function n(d){var a=e(this),t={action:"edd_remove_discount",code:a.data("code")};return e.ajax({type:"POST",data:t,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){var a="0"+edd_global_vars.decimal_separator+"00";e(".edd_cart_amount").each(function(){(edd_global_vars.currency_sign+a==e(this).text()||a+edd_global_vars.currency_sign==e(this).text())&&window.location.reload(),e(this).text(d.total),e(this).data("total",d.total_plain)}),e(".edd_cart_discount").html(d.html),d.discounts||e(".edd_cart_discount_row").hide(),recalculate_taxes(),e("#edd_cc_fields,#edd_cc_address").slideDown(),c.trigger("edd_discount_removed",[d])}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1}function i(d){var a=e(this),t=a.val(),o=a.data("key"),n=a.closest(".edd_cart_item").data("download-id"),i=a.parent().find('input[name="edd-cart-download-'+o+'-options"]').val(),r=e("#edd_cc_address"),l=r.find("#billing_country").val(),s=r.find("#card_state").val(),_={action:"edd_update_quantity",quantity:t,download_id:n,options:i,billing_country:l,card_state:s};return e.ajax({type:"POST",data:_,dataType:"json",url:edd_global_vars.ajaxurl,xhrFields:{withCredentials:!0},success:function(d){e(".edd_cart_subtotal_amount").each(function(){e(this).text(d.subtotal)}),e(".edd_cart_tax_amount").each(function(){e(this).text(d.taxes)}),e(".edd_cart_amount").each(function(){e(this).text(d.total),c.trigger("edd_quantity_updated",[d])})}}).fail(function(e){window.console&&window.console.log&&console.log(e)}),!1}var c,r,l,s,_;return{init:d,recalculate_taxes:recalculate_taxes}}(window.jQuery),window.jQuery(document).ready(EDD_Checkout.init);var ajax_tax_count=0;